import{j as H,f as J,h as u,D as K,Q as U,R as N,S as s,Z as W,ac as X,q as o,y as m,a8 as p,u as t,ag as Y,O as D,ad as x}from"./vendor-DfCbaU-T.js";import{$ as y,T as g,x as _,U as ee}from"./main-Btr01hqQ.js";import{V as ae,r as f,p as te}from"./VForm-D0fBkA3g.js";import{u as le,i as R}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as B,a as n}from"./VRow-CRn_xzm0.js";import{V as oe}from"./VCard-BmPLTxO3.js";import{V as se}from"./VCardText-H2SttjXr.js";import{V as re}from"./VAlert-R8JWKysv.js";import{V as E}from"./VTextField-pVQuWnMO.js";import{V as C}from"./VSelect-DhbvR9Z1.js";import{V as ue}from"./VSwitch-Blte16Xl.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";import"./VChip-DOrTqiUh.js";const ne={class:"d-flex align-center justify-space-between mb-2"},ie={class:"d-flex gap-2"},de={class:"d-flex justify-end gap-3"},Se=H({__name:"edit",setup(me){const F=W(),S=X(),w=J(()=>Number(F.params.id)),{withAbort:v}=le(),b={path:"/templates/aidat"},$=u(!1),A=u(!1),c=u(!1),V=u(!1),i=u(""),d=u({}),T=u([]),h=u([]),k=u([]),l=u({name:"",amount:null,due_day:15,account_id:null,scope:"all",apartment_ids:[],is_active:!0}),M=u(null),j=[f()],z=[f()],O=[f(),te()],q=[f(),e=>{const a=Number(e);return!Number.isInteger(a)||a<1||a>28?"Vade gunu 1 ile 28 arasinda olmalidir.":!0}],I=[f()],L=[e=>l.value.scope!=="selected"||Array.isArray(e)&&e.length>0?!0:"En az bir daire seçiniz."],P=async()=>{$.value=!0;try{const e=await v(a=>y("/templates/aidat/meta",{signal:a}));T.value=e.data.accounts,h.value=e.data.apartments,k.value=e.data.scopes}catch(e){if(R(e))return;i.value=g(e,"Form verileri alınamadı.")}finally{$.value=!1}},Q=async()=>{A.value=!0,i.value="";try{const e=await v(a=>y(`/templates/aidat/${w.value}`,{signal:a}));l.value={name:e.data.name,amount:e.data.amount,due_day:e.data.due_day,account_id:e.data.account?.id??null,scope:e.data.scope,apartment_ids:e.data.apartment_ids??[],is_active:e.data.is_active}}catch(e){if(R(e))return;i.value=g(e,"Aidat şablonu alınamadı.")}finally{A.value=!1}},Z=async()=>{if((await M.value?.validate())?.valid){c.value=!0,i.value="",d.value={};try{await v(a=>y(`/templates/aidat/${w.value}`,{method:"PUT",body:{name:l.value.name,amount:l.value.amount,due_day:l.value.due_day,account_id:l.value.account_id,scope:l.value.scope,apartment_ids:l.value.scope==="selected"?l.value.apartment_ids:[],is_active:l.value.is_active},signal:a})),await S.push(b)}catch(a){if(R(a))return;i.value=g(a,"Aidat şablonu güncellenemedi."),d.value=ee(a)}finally{c.value=!1}}},G=async()=>{V.value=!0,i.value="";try{await v(e=>y(`/templates/aidat/${w.value}`,{method:"DELETE",signal:e})),await S.push(b)}catch(e){if(R(e))return;i.value=g(e,"Aidat şablonu silinemedi.")}finally{V.value=!1}};return K(async()=>{await Promise.allSettled([P(),Q()])}),(e,a)=>(U(),N(B,null,{default:s(()=>[o(n,{cols:"12"},{default:s(()=>[m("div",ne,[a[9]||(a[9]=m("div",null,[m("h4",{class:"text-h4 mb-1"}," Aidat Şablonu Düzenle "),m("p",{class:"text-medium-emphasis mb-0"}," Şablon bilgilerini güncelleyin ")],-1)),m("div",ie,[o(_,{variant:"outlined",to:b},{default:s(()=>[...a[7]||(a[7]=[p(" Listeye Don ",-1)])]),_:1}),o(_,{color:"error",variant:"outlined",loading:t(V),disabled:t(V),onClick:G},{default:s(()=>[...a[8]||(a[8]=[p(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),o(n,{cols:"12"},{default:s(()=>[o(oe,{loading:t($)||t(A)||t(c)},{default:s(()=>[o(se,null,{default:s(()=>[o(ae,{ref_key:"formRef",ref:M,onSubmit:Y(Z,["prevent"])},{default:s(()=>[o(B,null,{default:s(()=>[t(i)?(U(),N(n,{key:0,cols:"12"},{default:s(()=>[o(re,{type:"error",variant:"tonal"},{default:s(()=>[p(D(t(i)),1)]),_:1})]),_:1})):x("",!0),o(n,{cols:"12",md:"6"},{default:s(()=>[o(E,{modelValue:t(l).name,"onUpdate:modelValue":a[0]||(a[0]=r=>t(l).name=r),label:e.$t("common.templateName"),rules:j,"error-messages":t(d).name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),o(n,{cols:"12",md:"6"},{default:s(()=>[o(C,{modelValue:t(l).account_id,"onUpdate:modelValue":a[1]||(a[1]=r=>t(l).account_id=r),items:t(T),"item-title":"label","item-value":"id",label:e.$t("common.account"),rules:z,"error-messages":t(d).account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),o(n,{cols:"12",md:"4"},{default:s(()=>[o(E,{modelValue:t(l).amount,"onUpdate:modelValue":a[2]||(a[2]=r=>t(l).amount=r),type:"number",min:"0.01",step:"0.01",label:e.$t("common.amount"),rules:O,"error-messages":t(d).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),o(n,{cols:"12",md:"4"},{default:s(()=>[o(E,{modelValue:t(l).due_day,"onUpdate:modelValue":a[3]||(a[3]=r=>t(l).due_day=r),type:"number",min:"1",max:"28",label:e.$t("common.dueDay"),rules:q,"error-messages":t(d).due_day??[]},null,8,["modelValue","label","error-messages"])]),_:1}),o(n,{cols:"12",md:"4"},{default:s(()=>[o(C,{modelValue:t(l).scope,"onUpdate:modelValue":a[4]||(a[4]=r=>t(l).scope=r),items:t(k),"item-title":"label","item-value":"value",label:e.$t("common.scope"),rules:I,"error-messages":t(d).scope??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(l).scope==="selected"?(U(),N(n,{key:1,cols:"12"},{default:s(()=>[o(C,{modelValue:t(l).apartment_ids,"onUpdate:modelValue":a[5]||(a[5]=r=>t(l).apartment_ids=r),items:t(h),"item-title":"label","item-value":"id",label:e.$t("common.apartments"),multiple:"",chips:"","closable-chips":"",rules:L,"error-messages":t(d).apartment_ids??[]},null,8,["modelValue","items","label","error-messages"])]),_:1})):x("",!0),o(n,{cols:"12"},{default:s(()=>[o(ue,{modelValue:t(l).is_active,"onUpdate:modelValue":a[6]||(a[6]=r=>t(l).is_active=r),label:e.$t("common.active"),color:"primary"},null,8,["modelValue","label"])]),_:1}),o(n,{cols:"12"},{default:s(()=>[m("div",de,[o(_,{variant:"outlined",to:b},{default:s(()=>[p(D(e.$t("common.cancel")),1)]),_:1}),o(_,{color:"primary",type:"submit",loading:t(c),disabled:t(c)},{default:s(()=>[p(D(e.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Se as default};
