import{j as ie,f as P,h as m,D as ue,Q as n,R as p,S as e,Z as ne,ac as de,q as t,y as r,a8 as o,u as s,ad as c,O as i,V as A,F as H,x as me,ab as pe,ag as ce,H as fe}from"./vendor-qaEqcc9M.js";import{u as _e,i as R}from"./useAbortOnUnmount-B_TyPYrd.js";import{e as ve,$ as L,T as S,x as F,aC as ye,q as E,U as ge}from"./main-DUODoQpR.js";import{a as M}from"./formatters-BEv4aA23.js";import{V as be,r as Ve}from"./VForm-AfrkaUJk.js";import{V as K,a as d}from"./VRow-dBMGxjTF.js";import{V as O}from"./VAlert-DIbLZTVg.js";import{V as v,a as V,b as x}from"./VCard-DEMyauu_.js";import{V as y}from"./VCardText-lEnvPJxp.js";import{V as G}from"./VChip-CzUAJTHl.js";import{V as g}from"./VDivider-CiCMqi-4.js";import{V as xe}from"./VSelect-BpDYXa0x.js";import{V as ke,a as U,b as $,d as j}from"./VList-BpKoOtV6.js";import{V as he}from"./VAvatar-DfdxhEHH.js";import{V as we}from"./VTextarea-BWwjO-LJ.js";import"./vuetify-CYvz9UpR.js";import"./VTextField-BgtisBQp.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";const Ce={class:"d-flex align-center justify-space-between mb-2"},ze={class:"d-flex gap-2"},De={class:"d-flex gap-2"},Te={class:"d-flex align-center gap-2 text-sm text-medium-emphasis mb-3"},Ae={class:"text-body-1",style:{"white-space":"pre-wrap"}},Re={key:0,class:"text-center text-medium-emphasis py-6"},Le={class:"d-flex gap-3"},Se={class:"text-sm"},Ee={class:"flex-grow-1"},Ie={class:"d-flex align-center gap-2 mb-1"},Be={class:"text-body-1 font-weight-medium"},Fe={class:"text-sm text-medium-emphasis"},Me={class:"text-body-2 mb-0",style:{"white-space":"pre-wrap"}},Oe={class:"d-flex justify-end"},rt=ie({__name:"[id]",setup(Ue){const{withAbort:k}=_e(),Q=ne(),Z=de(),N=ve(),h=P(()=>Number(Q.params.id)),I=P(()=>N.hasRole("admin")||N.hasRole("super-admin")),w=m(!1),C=m(!1),z=m(!1),D=m(!1),_=m(""),T=m(""),B=m({}),l=m(null),b=m(""),Y=m(null),J=[Ve()],W={open:"Acik",in_progress:"Isleniyor",resolved:"Cozuldu",closed:"Kapali"},X={open:"warning",in_progress:"info",resolved:"success",closed:"secondary"},ee={low:"Dusuk",medium:"Orta",high:"Yuksek"},te={low:"success",medium:"warning",high:"error"},ae=[{title:"Acik",value:"open"},{title:"Isleniyor",value:"in_progress"},{title:"Cozuldu",value:"resolved"},{title:"Kapali",value:"closed"}],q=async()=>{w.value=!0,_.value="";try{const u=await k(a=>L(`/support-tickets/${h.value}`,{signal:a}));l.value=u.data}catch(u){if(R(u))return;_.value=S(u,"Destek talebi alinamadi.")}finally{w.value=!1}},se=async()=>{if((await Y.value?.validate())?.valid){C.value=!0,T.value="",B.value={};try{await k(a=>L(`/support-tickets/${h.value}/reply`,{method:"POST",body:{message:b.value},signal:a})),b.value="",await q()}catch(a){if(R(a))return;T.value=S(a,"Cevap gonderilemedi."),B.value=ge(a)}finally{C.value=!1}}},le=async u=>{z.value=!0;try{await k(a=>L(`/support-tickets/${h.value}/status`,{method:"PUT",body:{status:u},signal:a})),l.value&&(l.value.status=u)}catch(a){if(R(a))return;_.value=S(a,"Durum guncellenemedi.")}finally{z.value=!1}},re=async()=>{D.value=!0;try{await k(u=>L(`/support-tickets/${h.value}`,{method:"DELETE",signal:u})),await Z.push("/support-tickets")}catch(u){if(R(u))return;_.value=S(u,"Destek talebi silinemedi.")}finally{D.value=!1}};return ue(q),(u,a)=>(n(),p(K,null,{default:e(()=>[t(d,{cols:"12"},{default:e(()=>[r("div",Ce,[a[3]||(a[3]=r("div",null,[r("h4",{class:"text-h4 mb-1"}," Destek Talebi Detayi "),r("p",{class:"text-medium-emphasis mb-0"}," Talep detayini goruntuleyin ve cevap yapin ")],-1)),r("div",ze,[t(F,{variant:"outlined",to:"/support-tickets"},{default:e(()=>[...a[1]||(a[1]=[o(" Listeye Don ",-1)])]),_:1}),s(I)&&s(l)?(n(),p(F,{key:0,color:"error",variant:"outlined",loading:s(D),disabled:s(D),onClick:re},{default:e(()=>[...a[2]||(a[2]=[o(" Sil ",-1)])]),_:1},8,["loading","disabled"])):c("",!0)])])]),_:1}),s(_)?(n(),p(d,{key:0,cols:"12"},{default:e(()=>[t(O,{type:"error",variant:"tonal"},{default:e(()=>[o(i(s(_)),1)]),_:1})]),_:1})):c("",!0),s(w)?(n(),p(d,{key:1,cols:"12"},{default:e(()=>[t(v,null,{default:e(()=>[t(y,{class:"text-center py-8"},{default:e(()=>[t(ye,{indeterminate:""})]),_:1})]),_:1})]),_:1})):c("",!0),s(l)&&!s(w)?(n(),A(H,{key:2},[t(d,{cols:"12",md:"8"},{default:e(()=>[t(v,null,{default:e(()=>[t(V,null,{append:e(()=>[r("div",De,[t(G,{size:"small",color:te[s(l).priority],variant:"tonal"},{default:e(()=>[o(i(ee[s(l).priority]),1)]),_:1},8,["color"]),t(G,{size:"small",color:X[s(l).status],variant:"tonal"},{default:e(()=>[o(i(W[s(l).status]),1)]),_:1},8,["color"])])]),default:e(()=>[t(x,null,{default:e(()=>[o(i(s(l).subject),1)]),_:1})]),_:1}),t(g),t(y,null,{default:e(()=>[r("div",Te,[t(E,{icon:"ri-user-line",size:"16"}),r("span",null,i(s(l).created_by?.name??"-"),1),a[4]||(a[4]=r("span",null,"Â·",-1)),r("span",null,i(s(M)(s(l).created_at)),1)]),r("p",Ae,i(s(l).message),1)]),_:1})]),_:1})]),_:1}),t(d,{cols:"12",md:"4"},{default:e(()=>[s(I)?(n(),p(v,{key:0},{default:e(()=>[t(V,null,{default:e(()=>[t(x,{class:"text-base"},{default:e(()=>[...a[5]||(a[5]=[o(" Yonetim ",-1)])]),_:1})]),_:1}),t(g),t(y,null,{default:e(()=>[t(xe,{"model-value":s(l).status,items:ae,label:"Durum Degistir",loading:s(z),disabled:s(z),"onUpdate:modelValue":le},null,8,["model-value","loading","disabled"])]),_:1})]),_:1})):c("",!0),t(v,{class:me(s(I)?"mt-4":"")},{default:e(()=>[t(V,null,{default:e(()=>[t(x,{class:"text-base"},{default:e(()=>[...a[6]||(a[6]=[o(" Bilgiler ",-1)])]),_:1})]),_:1}),t(g),t(y,null,{default:e(()=>[t(ke,{density:"compact"},{default:e(()=>[t(U,null,{prepend:e(()=>[t(E,{icon:"ri-user-line",size:"18",class:"me-2"})]),default:e(()=>[t($,{class:"text-sm"},{default:e(()=>[...a[7]||(a[7]=[o(" Olusturan ",-1)])]),_:1}),t(j,null,{default:e(()=>[o(i(s(l).created_by?.name??"-"),1)]),_:1})]),_:1}),t(U,null,{prepend:e(()=>[t(E,{icon:"ri-calendar-line",size:"18",class:"me-2"})]),default:e(()=>[t($,{class:"text-sm"},{default:e(()=>[...a[8]||(a[8]=[o(" Tarih ",-1)])]),_:1}),t(j,null,{default:e(()=>[o(i(s(M)(s(l).created_at)),1)]),_:1})]),_:1}),t(U,null,{prepend:e(()=>[t(E,{icon:"ri-chat-3-line",size:"18",class:"me-2"})]),default:e(()=>[t($,{class:"text-sm"},{default:e(()=>[...a[9]||(a[9]=[o(" Cevap Sayisi ",-1)])]),_:1}),t(j,null,{default:e(()=>[o(i(s(l).replies.length),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["class"])]),_:1}),t(d,{cols:"12"},{default:e(()=>[t(v,null,{default:e(()=>[t(V,null,{default:e(()=>[t(x,{class:"text-base"},{default:e(()=>[o(" Cevaplar ("+i(s(l).replies.length)+") ",1)]),_:1})]),_:1}),t(g),t(y,null,{default:e(()=>[s(l).replies.length===0?(n(),A("div",Re," Henuz cevap yok. ")):c("",!0),(n(!0),A(H,null,pe(s(l).replies,(f,oe)=>(n(),A("div",{key:f.id},[oe>0?(n(),p(g,{key:0,class:"my-4"})):c("",!0),r("div",Le,[t(he,{size:"36",color:"primary",variant:"tonal"},{default:e(()=>[r("span",Se,i(f.user?.name?.charAt(0)?.toUpperCase()??"?"),1)]),_:2},1024),r("div",Ee,[r("div",Ie,[r("span",Be,i(f.user?.name??"-"),1),r("span",Fe,i(s(M)(f.created_at)),1)]),r("p",Me,i(f.message),1)])])]))),128))]),_:1})]),_:1})]),_:1}),s(l).status!=="closed"?(n(),p(d,{key:0,cols:"12"},{default:e(()=>[t(v,null,{default:e(()=>[t(V,null,{default:e(()=>[t(x,{class:"text-base"},{default:e(()=>[...a[10]||(a[10]=[o(" Cevap Yaz ",-1)])]),_:1})]),_:1}),t(g),t(y,null,{default:e(()=>[t(be,{ref_key:"replyFormRef",ref:Y,onSubmit:ce(se,["prevent"])},{default:e(()=>[t(K,null,{default:e(()=>[s(T)?(n(),p(d,{key:0,cols:"12"},{default:e(()=>[t(O,{type:"error",variant:"tonal"},{default:e(()=>[o(i(s(T)),1)]),_:1})]),_:1})):c("",!0),t(d,{cols:"12"},{default:e(()=>[t(we,{modelValue:s(b),"onUpdate:modelValue":a[0]||(a[0]=f=>fe(b)?b.value=f:null),label:"Mesajiniz",rows:"4",rules:J,"error-messages":s(B).message??[]},null,8,["modelValue","error-messages"])]),_:1}),t(d,{cols:"12"},{default:e(()=>[r("div",Oe,[t(F,{color:"primary",type:"submit",loading:s(C),disabled:s(C),"prepend-icon":"ri-send-plane-line"},{default:e(()=>[...a[11]||(a[11]=[o(" Gonder ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})):(n(),p(d,{key:1,cols:"12"},{default:e(()=>[t(O,{type:"info",variant:"tonal"},{default:e(()=>[...a[12]||(a[12]=[o(" Bu talep kapatilmistir. Yeni cevap yazilamaz. ",-1)])]),_:1})]),_:1}))],64)):c("",!0)]),_:1}))}});export{rt as default};
