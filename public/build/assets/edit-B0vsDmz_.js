import{j as se,f as oe,h as n,D as ie,Q as V,R as I,S as r,Z as ne,ac as ue,q as a,y as i,a8 as v,u as l,O as C,ad as N,ag as z,V as U,F as de,ab as me}from"./vendor-DfCbaU-T.js";import{$ as b,T as w,x as k,p as pe,U as M}from"./main-OjHNd2U9.js";import{a as fe}from"./formatters-BEv4aA23.js";import{V as O,r as c,e as ve,a as ce,m as ge,b as _e}from"./VForm-CtC6ldpE.js";import{V as A,a as u}from"./VRow-Ba58lXtG.js";import{V as ye}from"./VAlert-DafHPFjN.js";import{V as j,a as Ve}from"./VCard-9RfFlHpT.js";import{V as q}from"./VCardText-YweTyZzP.js";import{V as f}from"./VTextField-CMxHKe9w.js";import{V as B}from"./VSelect-CMe3Xagq.js";import{V as be}from"./VTable-ByowNMkP.js";import{V as we}from"./VChip-CnrRRXXG.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VList-B1ov9hmg.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";const ke={class:"d-flex align-center justify-space-between mb-2"},Re={class:"d-flex gap-2"},xe={class:"d-flex justify-end"},Te={class:"text-right"},De={key:0},Qe=se({__name:"edit",setup(Se){const P=ne(),G=ue(),g=oe(()=>Number(P.params.id)),R=n(!1),_=n(!1),x=n(!1),T=n(!1),D=n(null),d=n(""),p=n({}),y=n({}),$=n([]),S=n([]),F=n([]),E=n([]),s=n({name:"",email:"",phone:"",tc_kimlik:"",password:"",password_confirmation:"",role:"owner"}),K=n(null),m=n({apartment_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),L=n(null),Q=[c()],Y=[c(),ve()],Z=[o=>typeof o!="string"||o.length===0?!0:ce(11)(o)],H=[o=>typeof o!="string"||o.length===0?!0:ge(8)(o)],J=[o=>s.value.password?c("Sifre tekrar zorunludur.")(o):!0,o=>s.value.password?_e(()=>s.value.password,"Sifreler eslesmiyor.")(o):!0],W=[c()],X=[c()],ee=[c()],h=async()=>{R.value=!0,d.value="";try{const o=await b(`/users/${g.value}`),e=o.data;s.value={name:e.name,email:e.email??"",phone:e.phone??"",tc_kimlik:e.tc_kimlik??"",password:"",password_confirmation:"",role:e.role??"owner"},E.value=e.apartments,F.value=o.meta.available_apartments,$.value=o.meta.roles,S.value=o.meta.relation_types,S.value.some(t=>t.value===m.value.relation_type)||(m.value.relation_type=S.value[0]?.value??"owner")}catch(o){d.value=w(o,"Kullanici detayi alinamadi.")}finally{R.value=!1}},le=async()=>{if(!(await K.value?.validate())?.valid)return;_.value=!0,d.value="",p.value={};const e={name:s.value.name,email:s.value.email,phone:s.value.phone||null,tc_kimlik:s.value.tc_kimlik||null,role:s.value.role};s.value.password&&(e.password=s.value.password,e.password_confirmation=s.value.password_confirmation);try{await b(`/users/${g.value}`,{method:"PUT",body:e}),await h()}catch(t){d.value=w(t,"Kullanici guncellenemedi."),p.value=M(t)}finally{_.value=!1}},ae=async()=>{x.value=!0,d.value="";try{await b(`/users/${g.value}`,{method:"DELETE"}),await G.push("/management/users")}catch(o){d.value=w(o,"Kullanici silinemedi.")}finally{x.value=!1}},te=async()=>{if((await L.value?.validate())?.valid){T.value=!0,d.value="",y.value={};try{await b(`/users/${g.value}/apartments`,{method:"POST",body:{apartment_id:m.value.apartment_id,relation_type:m.value.relation_type,start_date:m.value.start_date||null}}),m.value.apartment_id=null,await h()}catch(e){d.value=w(e,"Daire iliskisi eklenemedi."),y.value=M(e)}finally{T.value=!1}}},re=async o=>{D.value=o,d.value="";try{await b(`/users/${g.value}/apartments/${o}`,{method:"DELETE"}),await h()}catch(e){d.value=w(e,"Daire iliskisi kaldirilamadi.")}finally{D.value=null}};return ie(h),(o,e)=>(V(),I(A,null,{default:r(()=>[a(u,{cols:"12"},{default:r(()=>[i("div",ke,[e[12]||(e[12]=i("div",null,[i("h4",{class:"text-h4 mb-1"}," Kullanici Duzenle "),i("p",{class:"text-medium-emphasis mb-0"}," Kullanici bilgileri ve daire iliskileri ")],-1)),i("div",Re,[a(k,{variant:"outlined",to:"/management/users"},{default:r(()=>[...e[10]||(e[10]=[v(" Listeye Don ",-1)])]),_:1}),a(k,{color:"error",variant:"outlined",loading:l(x),disabled:l(x),onClick:ae},{default:r(()=>[...e[11]||(e[11]=[v(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),l(d)?(V(),I(u,{key:0,cols:"12"},{default:r(()=>[a(ye,{type:"error",variant:"tonal"},{default:r(()=>[v(C(l(d)),1)]),_:1})]),_:1})):N("",!0),a(u,{cols:"12"},{default:r(()=>[a(j,{loading:l(R)||l(_)},{default:r(()=>[a(q,null,{default:r(()=>[a(O,{ref_key:"formRef",ref:K,onSubmit:z(le,["prevent"])},{default:r(()=>[a(A,null,{default:r(()=>[a(u,{cols:"12",md:"6"},{default:r(()=>[a(f,{modelValue:l(s).name,"onUpdate:modelValue":e[0]||(e[0]=t=>l(s).name=t),label:"Ad Soyad",rules:Q,"error-messages":l(p).name??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:r(()=>[a(f,{modelValue:l(s).email,"onUpdate:modelValue":e[1]||(e[1]=t=>l(s).email=t),type:"email",label:"E-posta",rules:Y,"error-messages":l(p).email??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:r(()=>[a(f,{modelValue:l(s).phone,"onUpdate:modelValue":e[2]||(e[2]=t=>l(s).phone=t),label:"Telefon","error-messages":l(p).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"6"},{default:r(()=>[a(f,{modelValue:l(s).tc_kimlik,"onUpdate:modelValue":e[3]||(e[3]=t=>l(s).tc_kimlik=t),label:"TC Kimlik",maxlength:"11",rules:Z,"error-messages":l(p).tc_kimlik??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"4"},{default:r(()=>[a(f,{modelValue:l(s).password,"onUpdate:modelValue":e[4]||(e[4]=t=>l(s).password=t),type:"password",label:"Yeni Sifre",rules:H,"error-messages":l(p).password??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"4"},{default:r(()=>[a(f,{modelValue:l(s).password_confirmation,"onUpdate:modelValue":e[5]||(e[5]=t=>l(s).password_confirmation=t),type:"password",label:"Sifre Tekrar",rules:J,"error-messages":l(p).password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"4"},{default:r(()=>[a(B,{modelValue:l(s).role,"onUpdate:modelValue":e[6]||(e[6]=t=>l(s).role=t),items:l($),"item-title":"label","item-value":"value",label:"Rol",rules:W,"error-messages":l(p).role??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(u,{cols:"12"},{default:r(()=>[i("div",xe,[a(k,{color:"primary",type:"submit",loading:l(_),disabled:l(_)},{default:r(()=>[...e[13]||(e[13]=[v(" Guncelle ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1}),a(u,{cols:"12"},{default:r(()=>[a(j,{loading:l(R)},{default:r(()=>[a(Ve,{title:"Bagli Daireler"}),a(q,null,{default:r(()=>[a(O,{ref_key:"apartmentFormRef",ref:L,onSubmit:z(te,["prevent"])},{default:r(()=>[a(A,null,{default:r(()=>[a(u,{cols:"12",md:"5"},{default:r(()=>[a(B,{modelValue:l(m).apartment_id,"onUpdate:modelValue":e[7]||(e[7]=t=>l(m).apartment_id=t),items:l(F),"item-title":"label","item-value":"id",label:"Daire",rules:X,"error-messages":l(y).apartment_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(u,{cols:"12",md:"3"},{default:r(()=>[a(B,{modelValue:l(m).relation_type,"onUpdate:modelValue":e[8]||(e[8]=t=>l(m).relation_type=t),items:l(S),"item-title":"label","item-value":"value",label:"Tur",rules:ee,"error-messages":l(y).relation_type??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(u,{cols:"12",md:"2"},{default:r(()=>[a(f,{modelValue:l(m).start_date,"onUpdate:modelValue":e[9]||(e[9]=t=>l(m).start_date=t),type:"date",label:"Baslangic","error-messages":l(y).start_date??[]},null,8,["modelValue","error-messages"])]),_:1}),a(u,{cols:"12",md:"2",class:"d-flex align-end"},{default:r(()=>[a(k,{color:"primary",type:"submit",block:"",loading:l(T),disabled:l(T)},{default:r(()=>[...e[14]||(e[14]=[v(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(be,{density:"comfortable"},{default:r(()=>[e[16]||(e[16]=i("thead",null,[i("tr",null,[i("th",null,"Daire"),i("th",null,"Tur"),i("th",null,"Baslangic"),i("th",{class:"text-right"}," Islem ")])],-1)),i("tbody",null,[(V(!0),U(de,null,me(l(E),t=>(V(),U("tr",{key:t.id},[i("td",null,C(t.label),1),i("td",null,[a(we,{size:"small",color:t.relation_type==="owner"?"primary":"warning",variant:"tonal"},{default:r(()=>[v(C(t.relation_label),1)]),_:2},1032,["color"])]),i("td",null,C(l(fe)(t.start_date)),1),i("td",Te,[a(k,{icon:"",size:"small",variant:"text",color:"error",loading:l(D)===t.id,disabled:l(D)===t.id,onClick:he=>re(t.id)},{default:r(()=>[a(pe,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),l(E).length===0?(V(),U("tr",De,[...e[15]||(e[15]=[i("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Bagli daire yok. ",-1)])])):N("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Qe as default};
