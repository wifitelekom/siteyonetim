import{j as I,h as m,f as U,D as h,Q as w,R as $,S as t,ac as j,q as s,y as u,a8 as v,u as e,ag as L,O as V,ad as A,v as O,V as Q,F as G}from"./vendor-DfCbaU-T.js";import{e as H,$ as k,T,x as b,U as J}from"./main-Btr01hqQ.js";import{V as K,r as y,e as W,m as X,b as Z}from"./VForm-D0fBkA3g.js";import{V as C,a as i}from"./VRow-CRn_xzm0.js";import{V as ee}from"./VCard-BmPLTxO3.js";import{V as ae}from"./VCardText-H2SttjXr.js";import{V as se}from"./VAlert-R8JWKysv.js";import{V as p}from"./VTextField-pVQuWnMO.js";import{V as le}from"./VTextarea-DCdZ-5SO.js";import{V as re}from"./VSwitch-Blte16Xl.js";import{V as te}from"./VDivider-DEGojtwS.js";import{V as oe}from"./VSelect-DhbvR9Z1.js";import{a as ie}from"./VList-BYpc2SqC.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VSelectionControl-ClrOpdq3.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VChip-DOrTqiUh.js";const ne={class:"d-flex align-center justify-space-between mb-2"},de={class:"text-h6 mb-2"},ue={class:"text-h6 mb-2"},me={class:"d-flex justify-end gap-3"},Ce=I({__name:"create",setup(pe){const S=j(),R=H(),f=m(!1),g=m(!1),_=m(""),n=m({}),x=m([]),l=m({name:"",phone:"",tax_no:"",address:"",is_active:!0,admin_user_id:null,admin_name:"",admin_email:"",admin_password:"",admin_password_confirmation:""}),N=m(null),E=U(()=>R.can("sites.manage")),d=U(()=>!l.value.admin_user_id),c=(r,a)=>d.value?y(a)(r):!0,F=[y()],M=[r=>c(r,"Yönetici adı zorunludur.")],B=[r=>{if(!d.value)return!0;const a=y("Yönetici e-posta zorunludur.")(r);return a!==!0?a:W()(r)}],P=[r=>c(r,"Yönetici şifresi zorunludur."),r=>d.value?X(8)(r):!0],Y=[r=>c(r,"Şifre tekrar zorunludur."),r=>d.value?Z(()=>l.value.admin_password,"Şifreler eşleşmiyor.")(r):!0],q=async()=>{g.value=!0;try{const r=await k("/super/sites/meta");x.value=r.data.available_admins}catch(r){_.value=T(r,"Yönetici listesi alınamadı.")}finally{g.value=!1}},z=async()=>{if((await N.value?.validate())?.valid){f.value=!0,_.value="",n.value={};try{await k("/super/sites",{method:"POST",body:{name:l.value.name,phone:l.value.phone||null,tax_no:l.value.tax_no||null,address:l.value.address||null,is_active:l.value.is_active,admin_user_id:l.value.admin_user_id||null,admin_name:d.value?l.value.admin_name:null,admin_email:d.value?l.value.admin_email:null,admin_password:d.value?l.value.admin_password:null,admin_password_confirmation:d.value?l.value.admin_password_confirmation:null}}),await S.push("/super/sites")}catch(a){_.value=T(a,"Site oluşturulamadı."),n.value=J(a)}finally{f.value=!1}}};return h(async()=>{if(await R.ensureSession(),!E.value){await S.replace("/");return}await q()}),(r,a)=>(w(),$(C,null,{default:t(()=>[s(i,{cols:"12"},{default:t(()=>[u("div",ne,[a[11]||(a[11]=u("div",null,[u("h4",{class:"text-h4 mb-1"}," Yeni Site "),u("p",{class:"text-medium-emphasis mb-0"}," Site ve yönetici bilgilerini girin ")],-1)),s(b,{variant:"outlined",to:"/super/sites"},{default:t(()=>[...a[10]||(a[10]=[v(" Listeye Don ",-1)])]),_:1})])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(ee,{loading:e(f)||e(g)},{default:t(()=>[s(ae,null,{default:t(()=>[s(K,{ref_key:"formRef",ref:N,onSubmit:L(z,["prevent"])},{default:t(()=>[s(C,null,{default:t(()=>[e(_)?(w(),$(i,{key:0,cols:"12"},{default:t(()=>[s(se,{type:"error",variant:"tonal"},{default:t(()=>[v(V(e(_)),1)]),_:1})]),_:1})):A("",!0),s(i,{cols:"12"},{default:t(()=>[u("h6",de,V(r.$t("pages.superSites.siteInfo")),1)]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).name,"onUpdate:modelValue":a[0]||(a[0]=o=>e(l).name=o),label:r.$t("common.siteName"),rules:F,"error-messages":e(n).name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).phone,"onUpdate:modelValue":a[1]||(a[1]=o=>e(l).phone=o),label:"Telefon","error-messages":e(n).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).tax_no,"onUpdate:modelValue":a[2]||(a[2]=o=>e(l).tax_no=o),label:"Vergi No","error-messages":e(n).tax_no??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(le,{modelValue:e(l).address,"onUpdate:modelValue":a[3]||(a[3]=o=>e(l).address=o),label:"Adres",rows:"3","error-messages":e(n).address??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(re,{modelValue:e(l).is_active,"onUpdate:modelValue":a[4]||(a[4]=o=>e(l).is_active=o),label:r.$t("common.active"),color:"primary"},null,8,["modelValue","label"])]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(te)]),_:1}),s(i,{cols:"12"},{default:t(()=>[u("h6",ue,V(r.$t("pages.superSites.adminInfo")),1)]),_:1}),s(i,{cols:"12"},{default:t(()=>[s(oe,{modelValue:e(l).admin_user_id,"onUpdate:modelValue":a[5]||(a[5]=o=>e(l).admin_user_id=o),items:e(x),"item-title":"name","item-value":"id",label:r.$t("pages.superSites.selectExistingAdmin"),clearable:"","error-messages":e(n).admin_user_id??[]},{item:t(({props:o,item:D})=>[s(ie,O(o,{subtitle:D.raw.email||"-"}),null,16,["subtitle"])]),selection:t(({item:o})=>[u("span",null,V(o.raw.name)+" - "+V(o.raw.email||"-"),1)]),_:1},8,["modelValue","items","label","error-messages"])]),_:1}),e(d)?(w(),Q(G,{key:1},[s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).admin_name,"onUpdate:modelValue":a[6]||(a[6]=o=>e(l).admin_name=o),label:r.$t("pages.superSites.adminFullName"),rules:M,"error-messages":e(n).admin_name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).admin_email,"onUpdate:modelValue":a[7]||(a[7]=o=>e(l).admin_email=o),type:"email",label:r.$t("pages.superSites.adminEmail"),rules:B,"error-messages":e(n).admin_email??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).admin_password,"onUpdate:modelValue":a[8]||(a[8]=o=>e(l).admin_password=o),type:"password",label:r.$t("pages.superSites.adminPassword"),rules:P,"error-messages":e(n).admin_password??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:t(()=>[s(p,{modelValue:e(l).admin_password_confirmation,"onUpdate:modelValue":a[9]||(a[9]=o=>e(l).admin_password_confirmation=o),type:"password",label:"Şifre Tekrar",rules:Y,"error-messages":e(n).admin_password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1})],64)):A("",!0),s(i,{cols:"12"},{default:t(()=>[u("div",me,[s(b,{variant:"outlined",to:"/super/sites"},{default:t(()=>[...a[12]||(a[12]=[v(" Iptal ",-1)])]),_:1}),s(b,{color:"primary",type:"submit",loading:e(f),disabled:e(f)},{default:t(()=>[...a[13]||(a[13]=[v(" Siteyi Oluştur ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ce as default};
