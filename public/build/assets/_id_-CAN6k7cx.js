import{j as q,f as Q,h as u,D as Z,Q as V,R as w,S as s,Z as J,ac as W,q as a,y as l,O as r,u as e,a8 as c,ad as T,V as C,F as X,ab as ee,H as te,ag as ae}from"./vendor-DfCbaU-T.js";import{u as se}from"./useAbortOnUnmount-D2zdVzb9.js";import{$ as R,T as D,x as y,V as le,U as oe}from"./main-OjHNd2U9.js";import{a as O,f as b}from"./formatters-BEv4aA23.js";import{e as ie,b as de}from"./statusHelpers-B7BIhNzn.js";import{V as ne,r as h,p as re}from"./VForm-CtC6ldpE.js";import{V as S,a as d}from"./VRow-Ba58lXtG.js";import{V as ue}from"./VAlert-DafHPFjN.js";import{V as A,a as me,d as pe}from"./VCard-9RfFlHpT.js";import{V as N}from"./VCardText-YweTyZzP.js";import{V as fe}from"./VChip-CnrRRXXG.js";import{V as ce}from"./VTable-ByowNMkP.js";import{V as ve}from"./VDialog-BQJ2uzM5.js";import{V as $}from"./VTextField-CMxHKe9w.js";import{V as M}from"./VSelect-CMe3Xagq.js";import{V as Ve}from"./VTextarea-CHmrCRFp.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VList-B1ov9hmg.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";const ye={class:"d-flex align-center justify-space-between mb-2"},xe={class:"text-medium-emphasis mb-0"},_e={class:"d-flex gap-2"},ge={class:"font-weight-medium"},be={class:"font-weight-medium"},he={class:"font-weight-medium"},ke={class:"text-h6"},we={class:"text-h6 text-success"},Te={class:"text-h6 text-error"},Ce={class:"text-right"},Re={key:0},Je=q({__name:"[id]",setup(De){se();const G=J(),H=W(),k=Q(()=>Number(G.params.id)),x=u(!1),_=u(!1),g=u(!1),p=u(""),i=u(null),E=u([]),F=u([]),v=u(!1),f=u({}),n=u({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),U=u(null),L=[h()],Y=[h()],z=[h()],I=[h(),re()],B=async()=>{x.value=!0,p.value="";try{const m=await R(`/expenses/${k.value}`);i.value=m.data,E.value=m.meta.cash_accounts,F.value=m.meta.payment_methods}catch(m){p.value=D(m,"Gider detayi alinamadi.")}finally{x.value=!1}},K=()=>{f.value={},n.value.amount=i.value?.remaining??null,v.value=!0},P=async()=>{if((await U.value?.validate())?.valid){_.value=!0,p.value="",f.value={};try{await R(`/expenses/${k.value}/pay`,{method:"POST",body:{paid_at:n.value.paid_at,method:n.value.method,cash_account_id:n.value.cash_account_id,amount:n.value.amount,description:n.value.description||null}}),v.value=!1,await B()}catch(t){p.value=D(t,"Odeme islemi basarisiz."),f.value=oe(t)}finally{_.value=!1}}},j=async()=>{g.value=!0,p.value="";try{await R(`/expenses/${k.value}`,{method:"DELETE"}),await H.push("/expenses")}catch(m){p.value=D(m,"Gider silinemedi.")}finally{g.value=!1}};return Z(B),(m,t)=>(V(),w(S,null,{default:s(()=>[a(d,{cols:"12"},{default:s(()=>[l("div",ye,[l("div",null,[t[7]||(t[7]=l("h4",{class:"text-h4 mb-1"}," Gider Detayi ",-1)),l("p",xe,r(e(i)?.vendor?.name??"Tedarikci yok"),1)]),l("div",_e,[a(y,{variant:"outlined",to:"/expenses"},{default:s(()=>[...t[8]||(t[8]=[c(" Listeye Don ",-1)])]),_:1}),a(y,{color:"success","prepend-icon":"ri-secure-payment-line",disabled:!e(i)||e(i).remaining<=0,onClick:K},{default:s(()=>[...t[9]||(t[9]=[c(" Odeme Yap ",-1)])]),_:1},8,["disabled"]),a(y,{color:"error",variant:"outlined","prepend-icon":"ri-delete-bin-line",loading:e(g),disabled:e(g),onClick:j},{default:s(()=>[...t[10]||(t[10]=[c(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(p)?(V(),w(d,{key:0,cols:"12"},{default:s(()=>[a(ue,{type:"error",variant:"tonal"},{default:s(()=>[c(r(e(p)),1)]),_:1})]),_:1})):T("",!0),a(d,{cols:"12"},{default:s(()=>[a(A,{loading:e(x)},{default:s(()=>[e(i)?(V(),w(N,{key:0},{default:s(()=>[a(S,null,{default:s(()=>[a(d,{cols:"12",md:"3"},{default:s(()=>[t[11]||(t[11]=l("div",{class:"text-caption text-medium-emphasis"}," Gider Tarihi ",-1)),l("div",ge,r(e(O)(e(i).expense_date)),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:s(()=>[t[12]||(t[12]=l("div",{class:"text-caption text-medium-emphasis"}," Vade ",-1)),l("div",be,r(e(O)(e(i).due_date)),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:s(()=>[t[13]||(t[13]=l("div",{class:"text-caption text-medium-emphasis"}," Hesap ",-1)),l("div",he,r(e(i).account?.name??"-"),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:s(()=>[t[14]||(t[14]=l("div",{class:"text-caption text-medium-emphasis"}," Durum ",-1)),a(fe,{size:"small",color:e(ie)(e(i).status),variant:"tonal"},{default:s(()=>[c(r(e(de)(e(i).status)),1)]),_:1},8,["color"])]),_:1}),a(d,{cols:"12",md:"4"},{default:s(()=>[t[15]||(t[15]=l("div",{class:"text-caption text-medium-emphasis"},"Tutar",-1)),l("div",ke,r(e(b)(e(i).amount)),1)]),_:1}),a(d,{cols:"12",md:"4"},{default:s(()=>[t[16]||(t[16]=l("div",{class:"text-caption text-medium-emphasis"},"Odenen",-1)),l("div",we,r(e(b)(e(i).paid_amount)),1)]),_:1}),a(d,{cols:"12",md:"4"},{default:s(()=>[t[17]||(t[17]=l("div",{class:"text-caption text-medium-emphasis"},"Kalan",-1)),l("div",Te,r(e(b)(e(i).remaining)),1)]),_:1}),a(d,{cols:"12"},{default:s(()=>[t[18]||(t[18]=l("div",{class:"text-caption text-medium-emphasis"},"Aciklama",-1)),l("div",null,r(e(i).description||"-"),1)]),_:1})]),_:1})]),_:1})):T("",!0)]),_:1},8,["loading"])]),_:1}),a(d,{cols:"12"},{default:s(()=>[a(A,{loading:e(x)},{default:s(()=>[a(me,{title:"Odeme Hareketleri"}),a(ce,{density:"comfortable"},{default:s(()=>[t[20]||(t[20]=l("thead",null,[l("tr",null,[l("th",null,"Tarih"),l("th",null,"Yontem"),l("th",null,"Kasa/Banka"),l("th",{class:"text-right"}," Tutar ")])],-1)),l("tbody",null,[(V(!0),C(X,null,ee(e(i)?.payment_items??[],o=>(V(),C("tr",{key:o.id},[l("td",null,r(e(O)(o.payment?.paid_at??"")),1),l("td",null,r(o.payment?.method??"-"),1),l("td",null,r(o.payment?.cash_account?.name??"-"),1),l("td",Ce,r(e(b)(o.amount)),1)]))),128)),(e(i)?.payment_items??[]).length===0?(V(),C("tr",Re,[...t[19]||(t[19]=[l("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Odeme kaydi yok. ",-1)])])):T("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),a(ve,{modelValue:e(v),"onUpdate:modelValue":t[6]||(t[6]=o=>te(v)?v.value=o:null),"max-width":"560"},{default:s(()=>[a(A,{title:"Odeme Yap"},{default:s(()=>[a(N,null,{default:s(()=>[a(ne,{ref_key:"payFormRef",ref:U,onSubmit:ae(P,["prevent"])},{default:s(()=>[a(S,null,{default:s(()=>[a(d,{cols:"12",md:"6"},{default:s(()=>[a($,{modelValue:e(n).paid_at,"onUpdate:modelValue":t[0]||(t[0]=o=>e(n).paid_at=o),type:"date",label:"Odeme Tarihi",rules:L,"error-messages":e(f).paid_at??[]},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:s(()=>[a(M,{modelValue:e(n).method,"onUpdate:modelValue":t[1]||(t[1]=o=>e(n).method=o),items:e(F),"item-title":"label","item-value":"value",label:"Yontem",rules:Y,"error-messages":e(f).method??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(d,{cols:"12"},{default:s(()=>[a(M,{modelValue:e(n).cash_account_id,"onUpdate:modelValue":t[2]||(t[2]=o=>e(n).cash_account_id=o),items:e(E),"item-title":"name","item-value":"id",label:"Kasa/Banka Hesabi",rules:z,"error-messages":e(f).cash_account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(d,{cols:"12"},{default:s(()=>[a($,{modelValue:e(n).amount,"onUpdate:modelValue":t[3]||(t[3]=o=>e(n).amount=o),type:"number",step:"0.01",min:"0",label:"Tutar",rules:I,"error-messages":e(f).amount??[]},null,8,["modelValue","error-messages"])]),_:1}),a(d,{cols:"12"},{default:s(()=>[a(Ve,{modelValue:e(n).description,"onUpdate:modelValue":t[4]||(t[4]=o=>e(n).description=o),label:"Aciklama",rows:"2","error-messages":e(f).description??[]},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(pe,{class:"px-6 pb-4"},{default:s(()=>[a(le),a(y,{variant:"outlined",onClick:t[5]||(t[5]=o=>v.value=!1)},{default:s(()=>[...t[21]||(t[21]=[c(" Vazgec ",-1)])]),_:1}),a(y,{color:"primary",type:"submit",loading:e(_),disabled:e(_)},{default:s(()=>[...t[22]||(t[22]=[c(" Ode ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Je as default};
