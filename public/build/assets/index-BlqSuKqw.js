import{j as Ge,h as m,f as K,D as Me,Q as x,R as G,S as i,a0 as Re,q as t,y as s,a8 as d,u as n,V as M,F as de,ab as ue,O as f,ak as Ie,N as je,U as Pe,ad as R,H as Y,x as W}from"./vendor-qaEqcc9M.js";import{u as Le,i as X}from"./useAbortOnUnmount-B_TyPYrd.js";import{$ as F,T as re,x as u,W as Ne,X as Oe,V as J,q as Z}from"./main-DUODoQpR.js";import{a as qe,f as me}from"./formatters-BEv4aA23.js";import{V as ce,a as b}from"./VRow-dBMGxjTF.js";import{V as U,d as ee}from"./VCard-DEMyauu_.js";import{V as z}from"./VCardText-lEnvPJxp.js";import{V as I}from"./VTextField-BgtisBQp.js";import{V as fe}from"./VSelect-BpDYXa0x.js";import{V as ve}from"./VAlert-DIbLZTVg.js";import{V as te}from"./VDialog-8MtGyTgn.js";import{V as Qe}from"./VTextarea-BWwjO-LJ.js";import{V as He}from"./VTable-CDiDVqFm.js";import{V as pe}from"./VCheckboxBtn-B_mUIJHa.js";import{V as Ye}from"./VChip-CzUAJTHl.js";import{V as We}from"./VPagination-Dp4qKX6V.js";import{_ as Xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VSelectionControl-DtdcpgRj.js";const Je={class:"d-flex align-center justify-space-between flex-wrap gap-3 mb-2"},Ze={class:"d-flex gap-2 flex-wrap"},et={class:"d-flex align-center justify-space-between flex-wrap gap-3"},tt={class:"d-flex align-center flex-wrap gap-2"},lt={class:"mt-4"},at={class:"text-body-2 text-medium-emphasis"},nt={class:"text-center",style:{width:"50px"}},it={class:"text-right"},st={class:"text-center"},ot={class:"font-weight-medium"},dt={class:"text-caption text-medium-emphasis"},ut={class:"text-right"},rt={class:"text-right"},mt={class:"text-right"},ct={key:0},ft={colspan:"8",class:"text-center text-medium-emphasis py-6"},vt={class:"text-sm text-medium-emphasis"},pt=Ge({__name:"index",setup(gt){const{withAbort:A}=Le(),j=m(!1),P=m(!1),_=m(""),g=m(""),C=m([]),le=m([]),L=m([]),D=m({current_page:1,last_page:1,per_page:15,total:0}),r=m({vendor_id:null,status:null,from:"",to:"",search:""}),N=m(!1),o=m([]),y=m(!1),v=m(!1),$=m(!1),h=m(!1),S=m(!1),c=m({account_id:null,due_date:"",description:""}),ge=[{label:"Ödenen",value:"paid"},{label:"Ödenmeyen",value:"unpaid"},{label:"Kısmi",value:"partial"}],ye=async()=>{P.value=!0;try{const l=await A(e=>F("/expenses/meta",{signal:e}));le.value=l.data.vendors,L.value=l.data.accounts}catch(l){if(X(l))return;_.value=re(l,"Filtre verileri alınamadı.")}finally{P.value=!1}},w=async(l=1)=>{j.value=!0,_.value="";try{const e=await A(p=>F("/expenses",{query:{page:l,vendor_id:r.value.vendor_id||void 0,status:r.value.status||void 0,from:r.value.from||void 0,to:r.value.to||void 0,search:r.value.search||void 0},signal:p}));C.value=e.data,D.value=e.meta}catch(e){if(X(e))return;_.value=re(e,"Gider listesi alınamadı.")}finally{j.value=!1}},O=async()=>{await w(1)},Ve=async l=>{r.value.status=r.value.status===l?null:l,await w(1)},be=async()=>{r.value={vendor_id:null,status:null,from:"",to:"",search:""},o.value=[],g.value="",await w(1)},ae=l=>r.value.status===l,B=K(()=>C.value.map(l=>l.id)),ne=K(()=>B.value.length>0&&B.value.every(l=>o.value.includes(l))),_e=K(()=>B.value.some(l=>o.value.includes(l))&&!ne.value),ke=l=>{if(g.value="",l){const e=new Set([...o.value,...B.value]);o.value=Array.from(e);return}o.value=o.value.filter(e=>!B.value.includes(e))},xe=(l,e)=>{if(g.value="",e){o.value.includes(l)||o.value.push(l);return}o.value=o.value.filter(p=>p!==l)},we=l=>(l.description?.trim()??"")||`Gider #${l.id}`,Ce=l=>l.vendor?.name??"-",De=l=>l==="paid"?"ri-check-line":l==="partial"?"ri-time-line":"ri-alarm-line",$e=l=>l==="paid"?"text-success":l==="partial"?"text-info":"text-warning",he=l=>{if(l.status==="paid")return"Ödendi";if(l.status==="partial")return"Kısmi ödendi";const e=new Date;e.setHours(0,0,0,0);const p=new Date(`${l.due_date}T00:00:00`),a=Math.floor((p.getTime()-e.getTime())/(1e3*60*60*24));return a<0?`${Math.abs(a)} gün gecikti`:a===0?"Bugün":`${a} gün sonra`},ie=K(()=>o.value.length),q=K(()=>C.value.find(l=>o.value.includes(l.id))??null),se=l=>{const e=l?.trim()??"";return e.length>0?e:null},Se=async l=>{const e=C.value.find(p=>p.id===l);if(e)return e;try{return(await A(a=>F(`/expenses/${l}`,{signal:a}))).data}catch(p){return X(p),null}},oe=async l=>{if(o.value.length===0||y.value||v.value)return;const e=o.value.length,p=l==="arsivle"?"arşivlensin":"silinsin";if(window.confirm(`${e} seçili gider kaydı ${p} mi?`)){y.value=!0,g.value="",_.value="";try{const k=(await Promise.allSettled(o.value.map(T=>A(H=>F(`/expenses/${T}`,{method:"DELETE",signal:H}))))).filter(T=>T.status==="fulfilled").length,V=e-k;o.value=[],await w(D.value.current_page),k>0&&(g.value=l==="arsivle"?`${k} kayıt arşivlendi.`:`${k} kayıt silindi.`),V>0&&(_.value=`${V} kayıt silinemedi.`)}finally{y.value=!1}}},Ee=async()=>{await oe("arsivle")},Te=async()=>{await oe("sil")},Q=async(l,e)=>{if(!(o.value.length===0||v.value||y.value)){v.value=!0,g.value="",_.value="";try{const a=(await Promise.allSettled(o.value.map(async k=>{const V=await Se(k),T=l.account_id??V?.account?.id??null;if(!V||!T)throw new Error("missing-related-data");await A(H=>F(`/expenses/${k}`,{method:"PUT",body:{vendor_id:V.vendor?.id??null,account_id:T,expense_date:V.expense_date,due_date:l.due_date??V.due_date,amount:V.amount,description:Object.prototype.hasOwnProperty.call(l,"description")?se(l.description??null):se(V.description),invoice_no:V.invoice_no??null},signal:H}))}))).filter(k=>k.status==="fulfilled").length,E=o.value.length-a;o.value=[],await w(D.value.current_page),a>0&&(g.value=`${a} kayıt için ${e}`),E>0&&(_.value=`${E} kayıt güncellenemedi.`)}finally{v.value=!1}}},Ue=()=>{g.value="",c.value.account_id=q.value?.account?.id??L.value[0]?.id??null,$.value=!0},ze=()=>{g.value="",c.value.due_date=q.value?.due_date??new Date().toISOString().slice(0,10),h.value=!0},Ae=()=>{g.value="",c.value.description=q.value?.description??"",S.value=!0},Be=async()=>{c.value.account_id&&(await Q({account_id:c.value.account_id},"kategori güncellendi."),$.value=!1)},Ke=async()=>{c.value.due_date&&(await Q({due_date:c.value.due_date},"ödeme tarihi güncellendi."),h.value=!1)},Fe=async()=>{await Q({description:c.value.description},"gider açıklaması güncellendi."),S.value=!1};return Me(async()=>{await Promise.allSettled([ye(),w(1)])}),(l,e)=>{const p=Re("RouterLink");return x(),G(ce,null,{default:i(()=>[t(b,{cols:"12"},{default:i(()=>[s("div",Je,[e[16]||(e[16]=s("h4",{class:"text-h4 mb-0"}," Giderler ",-1)),s("div",Ze,[t(u,{variant:"outlined",color:"primary",to:"/expenses/create"},{default:i(()=>[...e[15]||(e[15]=[d(" Gider Ekle ",-1)])]),_:1})])])]),_:1}),t(b,{cols:"12"},{default:i(()=>[t(U,{loading:n(P)},{default:i(()=>[t(z,{class:"py-3"},{default:i(()=>[s("div",et,[s("div",tt,[t(Ne,{divided:""},{default:i(()=>[(x(),M(de,null,ue(ge,a=>t(u,{key:a.value,variant:ae(a.value)?"flat":"outlined",color:ae(a.value)?"primary":void 0,onClick:E=>Ve(a.value)},{default:i(()=>[d(f(a.label),1)]),_:2},1032,["variant","color","onClick"])),64))]),_:1}),t(u,{variant:"outlined","prepend-icon":"ri-filter-3-line",onClick:e[0]||(e[0]=a=>N.value=!n(N))},{default:i(()=>[...e[17]||(e[17]=[d(" Süz ",-1)])]),_:1})]),t(I,{modelValue:n(r).search,"onUpdate:modelValue":e[1]||(e[1]=a=>n(r).search=a),class:"expenses-search",label:"Gider ara","prepend-inner-icon":"ri-search-line",clearable:"","hide-details":"",onKeyup:Ie(O,["enter"]),"onClick:clear":O},null,8,["modelValue"])]),t(Oe,null,{default:i(()=>[je(s("div",lt,[t(ce,null,{default:i(()=>[t(b,{cols:"12",md:"4"},{default:i(()=>[t(fe,{modelValue:n(r).vendor_id,"onUpdate:modelValue":e[2]||(e[2]=a=>n(r).vendor_id=a),items:n(le),"item-title":"label","item-value":"id",label:l.$t("common.vendor"),"hide-details":"",clearable:""},null,8,["modelValue","items","label"])]),_:1}),t(b,{cols:"12",md:"3"},{default:i(()=>[t(I,{modelValue:n(r).from,"onUpdate:modelValue":e[3]||(e[3]=a=>n(r).from=a),type:"date",label:l.$t("common.startDate"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),t(b,{cols:"12",md:"3"},{default:i(()=>[t(I,{modelValue:n(r).to,"onUpdate:modelValue":e[4]||(e[4]=a=>n(r).to=a),type:"date",label:l.$t("common.endDate"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),t(b,{cols:"12",md:"2",class:"d-flex align-end justify-end gap-2"},{default:i(()=>[t(u,{variant:"outlined",onClick:be},{default:i(()=>[d(f(l.$t("common.clear")),1)]),_:1}),t(u,{color:"primary",onClick:O},{default:i(()=>[d(f(l.$t("common.filter")),1)]),_:1})]),_:1})]),_:1})],512),[[Pe,n(N)]])]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),n(ie)>0?(x(),G(b,{key:0,cols:"12"},{default:i(()=>[t(U,null,{default:i(()=>[t(z,{class:"d-flex align-center flex-wrap gap-2 py-3"},{default:i(()=>[s("span",at,f(n(ie))+" kayıt seçildi ",1),t(u,{size:"small",variant:"outlined",loading:n(y),disabled:n(y)||n(v),onClick:Ee},{default:i(()=>[...e[18]||(e[18]=[d(" Arşivle ",-1)])]),_:1},8,["loading","disabled"]),t(u,{size:"small",variant:"outlined",color:"error",loading:n(y),disabled:n(y)||n(v),onClick:Te},{default:i(()=>[...e[19]||(e[19]=[d(" Sil ",-1)])]),_:1},8,["loading","disabled"]),t(u,{size:"small",variant:"outlined",disabled:n(y)||n(v),onClick:Ue},{default:i(()=>[...e[20]||(e[20]=[d(" Kategori Ekle ",-1)])]),_:1},8,["disabled"]),t(u,{size:"small",variant:"outlined",disabled:n(y)||n(v),onClick:ze},{default:i(()=>[...e[21]||(e[21]=[d(" Ödeme Tarihini Değiştir ",-1)])]),_:1},8,["disabled"]),t(u,{size:"small",variant:"outlined",disabled:n(y)||n(v),onClick:Ae},{default:i(()=>[...e[22]||(e[22]=[d(" Gider Açıklamalarını Değiştir ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):R("",!0),n(g)?(x(),G(b,{key:1,cols:"12"},{default:i(()=>[t(ve,{type:"info",variant:"tonal"},{default:i(()=>[d(f(n(g)),1)]),_:1})]),_:1})):R("",!0),t(te,{modelValue:n($),"onUpdate:modelValue":e[7]||(e[7]=a=>Y($)?$.value=a:null),"max-width":"460"},{default:i(()=>[t(U,{title:"Kategori Ekle"},{default:i(()=>[t(z,null,{default:i(()=>[t(fe,{modelValue:n(c).account_id,"onUpdate:modelValue":e[5]||(e[5]=a=>n(c).account_id=a),items:n(L),"item-title":"label","item-value":"id",label:"Kategori"},null,8,["modelValue","items"])]),_:1}),t(ee,{class:"px-6 pb-4"},{default:i(()=>[t(J),t(u,{variant:"outlined",onClick:e[6]||(e[6]=a=>$.value=!1)},{default:i(()=>[...e[23]||(e[23]=[d(" Vazgeç ",-1)])]),_:1}),t(u,{color:"primary",loading:n(v),disabled:n(v)||!n(c).account_id,onClick:Be},{default:i(()=>[...e[24]||(e[24]=[d(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:n(h),"onUpdate:modelValue":e[10]||(e[10]=a=>Y(h)?h.value=a:null),"max-width":"460"},{default:i(()=>[t(U,{title:"Ödeme Tarihini Değiştir"},{default:i(()=>[t(z,null,{default:i(()=>[t(I,{modelValue:n(c).due_date,"onUpdate:modelValue":e[8]||(e[8]=a=>n(c).due_date=a),type:"date",label:"Yeni Ödeme Tarihi"},null,8,["modelValue"])]),_:1}),t(ee,{class:"px-6 pb-4"},{default:i(()=>[t(J),t(u,{variant:"outlined",onClick:e[9]||(e[9]=a=>h.value=!1)},{default:i(()=>[...e[25]||(e[25]=[d(" Vazgeç ",-1)])]),_:1}),t(u,{color:"primary",loading:n(v),disabled:n(v)||!n(c).due_date,onClick:Ke},{default:i(()=>[...e[26]||(e[26]=[d(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{modelValue:n(S),"onUpdate:modelValue":e[13]||(e[13]=a=>Y(S)?S.value=a:null),"max-width":"560"},{default:i(()=>[t(U,{title:"Gider Açıklamalarını Değiştir"},{default:i(()=>[t(z,null,{default:i(()=>[t(Qe,{modelValue:n(c).description,"onUpdate:modelValue":e[11]||(e[11]=a=>n(c).description=a),label:"Yeni Açıklama",rows:"3",hint:"Boş bırakırsanız açıklama temizlenir.","persistent-hint":""},null,8,["modelValue"])]),_:1}),t(ee,{class:"px-6 pb-4"},{default:i(()=>[t(J),t(u,{variant:"outlined",onClick:e[12]||(e[12]=a=>S.value=!1)},{default:i(()=>[...e[27]||(e[27]=[d(" Vazgeç ",-1)])]),_:1}),t(u,{color:"primary",loading:n(v),disabled:n(v),onClick:Fe},{default:i(()=>[...e[28]||(e[28]=[d(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(_)?(x(),G(b,{key:2,cols:"12"},{default:i(()=>[t(ve,{type:"error",variant:"tonal"},{default:i(()=>[d(f(n(_)),1)]),_:1})]),_:1})):R("",!0),t(b,{cols:"12"},{default:i(()=>[t(U,{loading:n(j)},{default:i(()=>[t(He,{density:"comfortable"},{default:i(()=>[s("thead",null,[s("tr",null,[s("th",nt,[t(pe,{"model-value":n(ne),indeterminate:n(_e),"onUpdate:modelValue":e[14]||(e[14]=a=>ke(!!a))},null,8,["model-value","indeterminate"])]),e[29]||(e[29]=s("th",null,"Açıklama",-1)),e[30]||(e[30]=s("th",null,"Kategori",-1)),e[31]||(e[31]=s("th",null,"Düzenleme",-1)),e[32]||(e[32]=s("th",null,"Ödeme",-1)),e[33]||(e[33]=s("th",{class:"text-right"}," Toplam ",-1)),e[34]||(e[34]=s("th",{class:"text-right"}," Kalan ",-1)),s("th",it,f(l.$t("common.actions")),1)])]),s("tbody",null,[(x(!0),M(de,null,ue(n(C),a=>(x(),M("tr",{key:a.id},[s("td",st,[t(pe,{"model-value":n(o).includes(a.id),"onUpdate:modelValue":E=>xe(a.id,!!E)},null,8,["model-value","onUpdate:modelValue"])]),s("td",null,[s("div",ot,[t(p,{to:`/expenses/${a.id}`,class:"text-decoration-none text-primary"},{default:i(()=>[d(f(we(a)),1)]),_:2},1032,["to"])]),s("div",dt,f(Ce(a)),1)]),s("td",null,[t(Ye,{size:"small",variant:"tonal",color:"secondary"},{default:i(()=>[d(f(a.account?.name??"-"),1)]),_:2},1024)]),s("td",null,f(n(qe)(a.expense_date)),1),s("td",null,[s("div",{class:W(["d-flex align-center gap-2",$e(a.status)])},[t(Z,{icon:De(a.status),size:"18"},null,8,["icon"]),s("span",null,f(he(a)),1)],2)]),s("td",ut,[s("span",{class:W(a.status==="paid"?"text-success":"")},f(n(me)(a.amount)),3)]),s("td",rt,[s("span",{class:W(a.remaining<=0?"text-success":"text-error")},f(n(me)(a.remaining)),3)]),s("td",mt,[t(u,{icon:"",size:"small",variant:"text",to:`/expenses/${a.id}/edit`},{default:i(()=>[t(Z,{icon:"ri-edit-line"})]),_:1},8,["to"]),t(u,{icon:"",size:"small",variant:"text",to:`/expenses/${a.id}`},{default:i(()=>[t(Z,{icon:"ri-eye-line"})]),_:1},8,["to"])])]))),128)),n(C).length===0?(x(),M("tr",ct,[s("td",ft,f(l.$t("common.noRecords")),1)])):R("",!0)])]),_:1}),t(z,{class:"d-flex justify-space-between align-center flex-wrap gap-3"},{default:i(()=>[s("span",vt,f(l.$t("common.totalRecords",{count:n(D).total})),1),t(We,{"model-value":n(D).current_page,length:n(D).last_page,"total-visible":7,"onUpdate:modelValue":w},null,8,["model-value","length"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})}}}),Rt=Xe(pt,[["__scopeId","data-v-8d0f2977"]]);export{Rt as default};
