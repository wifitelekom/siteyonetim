import{e as U,$ as z,T as V,x as c,q as w}from"./main-DUODoQpR.js";import{a as L}from"./formatters-BEv4aA23.js";import{j as O,h as m,f as B,D as P,Q as v,R as $,S as l,ac as Q,q as e,y as t,a8 as h,u as o,ad as C,O as n,V as x,F as Y,ab as G}from"./vendor-qaEqcc9M.js";import{V as E,a as p}from"./VRow-dBMGxjTF.js";import{V as F}from"./VCard-DEMyauu_.js";import{V as R}from"./VCardText-lEnvPJxp.js";import{V as H}from"./VSelect-BpDYXa0x.js";import{V as J}from"./VTextField-BgtisBQp.js";import{V as K}from"./VAlert-DIbLZTVg.js";import{V as W}from"./VTable-CDiDVqFm.js";import{V as X}from"./VChip-CzUAJTHl.js";import{V as Z}from"./VPagination-Dp4qKX6V.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";const ee={class:"d-flex align-center justify-space-between mb-2"},te={class:"d-flex gap-3 justify-end"},ae={class:"font-weight-medium"},le={class:"text-caption text-medium-emphasis"},ie={class:"text-caption text-medium-emphasis"},oe={class:"text-right"},se={key:0},ne={colspan:"6",class:"text-center text-medium-emphasis py-6"},re={class:"text-sm text-medium-emphasis"},Te=O({__name:"index",setup(de){const k=Q(),g=U(),b=m(!1),y=m(null),d=m(null),r=m(""),S=m([]),_=m({current_page:1,last_page:1,per_page:15,total:0}),u=m({is_active:null,search:""}),T=B(()=>g.can("sites.manage")),j=B(()=>g.site.value?.id??null),f=async(a=1)=>{if(T.value){b.value=!0,r.value="";try{const i=await z("/super/sites",{query:{page:a,is_active:u.value.is_active===null?void 0:u.value.is_active?1:0,search:u.value.search||void 0}});S.value=i.data,_.value=i.meta}catch(i){r.value=V(i,"Site listesi alınamadı.")}finally{b.value=!1}}},A=async()=>{await f(1)},D=async()=>{u.value={is_active:null,search:""},await f(1)},I=async a=>{y.value=a.id,r.value="";try{await z(`/super/sites/${a.id}`,{method:"DELETE"}),await f(_.value.current_page)}catch(i){r.value=V(i,"Site silinemedi.")}finally{y.value=null}},M=async a=>{d.value=a.id,r.value="";try{await g.switchSiteContext(a.id),await k.push("/")}catch(i){r.value=V(i,"Site baglami guncellenemedi.")}finally{d.value=null}},N=async()=>{d.value=-1,r.value="";try{await g.switchSiteContext(null),await f(1)}catch(a){r.value=V(a,"Site baglami temizlenemedi.")}finally{d.value=null}};return P(async()=>{if(await g.ensureSession(),!T.value){await k.replace("/");return}await f(1)}),(a,i)=>(v(),$(E,null,{default:l(()=>[e(p,{cols:"12"},{default:l(()=>[t("div",ee,[i[4]||(i[4]=t("div",null,[t("h4",{class:"text-h4 mb-1"}," Siteler "),t("p",{class:"text-medium-emphasis mb-0"}," Super admin site yönetimi ")],-1)),e(c,{color:"primary","prepend-icon":"ri-add-line",to:"/super/sites/create"},{default:l(()=>[...i[2]||(i[2]=[h(" Yeni Site ",-1)])]),_:1}),o(j)?(v(),$(c,{key:0,variant:"outlined","prepend-icon":"ri-close-circle-line",loading:o(d)===-1,disabled:o(d)!==null,onClick:N},{default:l(()=>[...i[3]||(i[3]=[h(" Site secimini kaldir ",-1)])]),_:1},8,["loading","disabled"])):C("",!0)])]),_:1}),e(p,{cols:"12"},{default:l(()=>[e(F,null,{default:l(()=>[e(R,null,{default:l(()=>[e(E,null,{default:l(()=>[e(p,{cols:"12",md:"3"},{default:l(()=>[e(H,{modelValue:o(u).is_active,"onUpdate:modelValue":i[0]||(i[0]=s=>o(u).is_active=s),items:[{title:a.$t("common.active"),value:!0},{title:a.$t("common.passive"),value:!1}],label:a.$t("common.status"),clearable:""},null,8,["modelValue","items","label"])]),_:1}),e(p,{cols:"12",md:"9"},{default:l(()=>[e(J,{modelValue:o(u).search,"onUpdate:modelValue":i[1]||(i[1]=s=>o(u).search=s),label:a.$t("common.search"),placeholder:"Site adi, telefon, vergi no"},null,8,["modelValue","label"])]),_:1}),e(p,{cols:"12"},{default:l(()=>[t("div",te,[e(c,{variant:"outlined",onClick:D},{default:l(()=>[h(n(a.$t("common.clear")),1)]),_:1}),e(c,{color:"primary",onClick:A},{default:l(()=>[h(n(a.$t("common.filter")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),o(r)?(v(),$(p,{key:0,cols:"12"},{default:l(()=>[e(K,{type:"error",variant:"tonal"},{default:l(()=>[h(n(o(r)),1)]),_:1})]),_:1})):C("",!0),e(p,{cols:"12"},{default:l(()=>[e(F,{loading:o(b)},{default:l(()=>[e(W,{density:"comfortable"},{default:l(()=>[t("thead",null,[t("tr",null,[t("th",null,n(a.$t("common.site")),1),t("th",null,n(a.$t("common.manager")),1),t("th",null,n(a.$t("common.phone")),1),t("th",null,n(a.$t("common.status")),1),t("th",null,n(a.$t("common.createdAt")),1),i[5]||(i[5]=t("th",{class:"text-right"}," İşlemler ",-1))])]),t("tbody",null,[(v(!0),x(Y,null,G(o(S),s=>(v(),x("tr",{key:s.id},[t("td",null,[t("div",ae,n(s.name),1),t("div",le,n(s.address||"-"),1)]),t("td",null,[t("div",null,n(s.admin?.name||"-"),1),t("div",ie,n(s.admin?.email||"-"),1)]),t("td",null,n(s.phone||"-"),1),t("td",null,[e(X,{size:"small",color:s.is_active?"success":"secondary",variant:"tonal"},{default:l(()=>[h(n(s.is_active?a.$t("common.active"):a.$t("common.passive")),1)]),_:2},1032,["color"])]),t("td",null,n(o(L)(s.created_at)),1),t("td",oe,[e(c,{icon:"",size:"small",variant:"text",color:"primary",loading:o(d)===s.id,disabled:o(d)!==null,onClick:q=>M(s)},{default:l(()=>[e(w,{icon:"ri-login-box-line"})]),_:1},8,["loading","disabled","onClick"]),e(c,{icon:"",size:"small",variant:"text",to:`/super/sites/${s.id}/edit`},{default:l(()=>[e(w,{icon:"ri-edit-line"})]),_:1},8,["to"]),e(c,{icon:"",size:"small",variant:"text",color:"error",loading:o(y)===s.id,disabled:o(y)===s.id||o(d)!==null,onClick:q=>I(s)},{default:l(()=>[e(w,{icon:"ri-delete-bin-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),o(S).length===0?(v(),x("tr",se,[t("td",ne,n(a.$t("common.noRecords")),1)])):C("",!0)])]),_:1}),e(R,{class:"d-flex justify-space-between align-center flex-wrap gap-3"},{default:l(()=>[t("span",re,n(a.$t("common.totalRecords",{count:o(_).total})),1),e(Z,{"model-value":o(_).current_page,length:o(_).last_page,"total-visible":7,"onUpdate:modelValue":f},null,8,["model-value","length"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Te as default};
