import{j as He,f as le,h as r,D as Ke,Q as p,V as k,q as e,S as l,H as I,u as t,F as S,Z as je,ac as qe,y as d,O as i,a8 as u,R as V,ad as g,N as ae,ab as te,U as oe,x as Ye,v as he,ag as _e}from"./vendor-qaEqcc9M.js";import{u as Qe,i as Ze}from"./useAbortOnUnmount-B_TyPYrd.js";import{$ as U,T as F,x,q as M,r as Je,V as be,U as ge}from"./main-DUODoQpR.js";import{f as R,a as P}from"./formatters-BEv4aA23.js";import{e as We,b as Xe}from"./statusHelpers-D3tNe4to.js";import{V as xe,r as C,p as ke}from"./VForm-AfrkaUJk.js";import{V as h,a as f}from"./VRow-dBMGxjTF.js";import{V as we}from"./VDialog-8MtGyTgn.js";import{V as $e}from"./VAlert-DIbLZTVg.js";import{V as O,a as el,d as De}from"./VCard-DEMyauu_.js";import{V as w}from"./VCardText-lEnvPJxp.js";import{V as B,a as v,b as _,d as Ce}from"./VList-BpKoOtV6.js";import{V as Te}from"./VChip-CzUAJTHl.js";import{V as ll,a as ne}from"./VTabs-zJODQ6kc.js";import{V as z}from"./VDivider-CiCMqi-4.js";import{V as al}from"./VTable-CDiDVqFm.js";import{V as se}from"./VTextarea-BWwjO-LJ.js";import{V as Q}from"./VSelect-BpDYXa0x.js";import{V as L}from"./VTextField-BgtisBQp.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";const tl={class:"d-flex align-center justify-space-between mb-2"},ol={class:"text-h4 mb-1"},nl={class:"text-medium-emphasis mb-0"},sl={class:"d-flex gap-2"},ul={class:"d-flex align-center gap-2"},dl={class:"font-weight-medium"},il={class:"text-right"},rl={key:0},ml={colspan:"4",class:"text-center text-medium-emphasis py-6"},pl={key:0,class:"text-success font-weight-medium"},fl={class:"text-success"},cl={class:"text-error"},Ml=He({__name:"[id]",setup(vl){const{withAbort:Ue}=Qe(),Re=je(),ue=qe(),$=le(()=>Number(Re.params.id)),Z=r(!1),H=r(!1),J=r(!1),y=r(""),E=r("payments"),s=r(null),de=r([]),ie=r([]),re=r([]),me=r([]),K=r([]),T=r(""),W=r(!1),j=r(!1),N=r(!1),D=r({}),c=r({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),pe=r(null),Ee=[C()],Ne=[C()],Ae=[C()],Se=[C(),ke()],A=r(!1),G=r(!1),b=r({}),m=r({vendor_id:null,account_id:null,expense_date:"",due_date:"",amount:null,description:"",invoice_no:""}),fe=r(null),Fe=[C()],Oe=[C()],ze=[C()],Le=[C(),ke()],ce=le(()=>Number(s.value?.paid_amount??0)>0),X=le(()=>{if(!s.value)return[];const n=[];s.value.created_at&&n.push({date:s.value.created_at,type:"created",description:"Gider olusturuldu",by:s.value.creator?.name??null,icon:"ri-add-circle-line",color:"info"});for(const a of s.value.payment_items)a.payment&&n.push({date:a.payment.paid_at,type:"payment",description:a.payment.description||"Odeme yapildi",by:a.payment.cash_account?.name??null,amount:a.amount,icon:"ri-money-dollar-circle-line",color:"success"});return n.sort((a,o)=>new Date(o.date).getTime()-new Date(a.date).getTime()),n}),ee=async()=>{Z.value=!0,y.value="";try{const n=await U(`/expenses/${$.value}`);s.value=n.data,de.value=n.meta.cash_accounts,ie.value=n.meta.payment_methods,re.value=n.meta.vendors,me.value=n.meta.accounts}catch(n){y.value=F(n,"Gider detayi alinamadi.")}finally{Z.value=!1}},q=async()=>{try{const n=await Ue(a=>U(`/expenses/${$.value}/notes`,{signal:a}));K.value=n.data}catch(n){if(Ze(n))return}},Ge=async()=>{if(T.value.trim()){W.value=!0;try{await U(`/expenses/${$.value}/notes`,{method:"POST",body:{content:T.value}}),T.value="",await q()}catch(n){y.value=F(n,"Not eklenemedi.")}finally{W.value=!1}}},Ie=async n=>{try{await U(`/expenses/${$.value}/notes/${n}`,{method:"DELETE"}),await q()}catch(a){y.value=F(a,"Not silinemedi.")}},Me=()=>{D.value={},c.value.amount=s.value?.remaining??null,N.value=!0},ve=async()=>{if((await pe.value?.validate())?.valid){H.value=!0,y.value="",D.value={};try{await U(`/expenses/${$.value}/pay`,{method:"POST",body:{paid_at:c.value.paid_at,method:c.value.method,cash_account_id:c.value.cash_account_id,amount:c.value.amount,description:c.value.description||null}}),N.value=!1,await ee(),await q()}catch(a){y.value=F(a,"Odeme islemi basarisiz."),D.value=ge(a)}finally{H.value=!1}}},Pe=async()=>{J.value=!0,y.value="";try{await U(`/expenses/${$.value}`,{method:"DELETE"}),await ue.push("/expenses")}catch(n){y.value=F(n,"Gider silinemedi.")}finally{J.value=!1}},Be=()=>{ue.push(`/expenses/create?copy=${$.value}`)},ye=()=>{j.value=!1,s.value&&(b.value={},m.value={vendor_id:s.value.vendor?.id??null,account_id:s.value.account?.id??null,expense_date:s.value.expense_date,due_date:s.value.due_date,amount:s.value.amount,description:s.value.description??"",invoice_no:s.value.invoice_no??""},A.value=!0)},Ve=async()=>{if((await fe.value?.validate())?.valid){G.value=!0,b.value={},y.value="";try{await U(`/expenses/${$.value}`,{method:"PUT",body:{vendor_id:m.value.vendor_id,account_id:m.value.account_id,expense_date:m.value.expense_date,due_date:m.value.due_date,amount:Number(m.value.amount),description:m.value.description||null,invoice_no:m.value.invoice_no||null}}),A.value=!1,await ee()}catch(a){y.value=F(a,"Gider guncellenemedi."),b.value=ge(a)}finally{G.value=!1}}};return Ke(async()=>{await ee(),q()}),(n,a)=>(p(),k(S,null,[e(h,null,{default:l(()=>[e(f,{cols:"12"},{default:l(()=>[d("div",tl,[d("div",null,[d("h4",ol,i(n.$t("pages.expenses.detailTitle")),1),d("p",nl,i(t(s)?.vendor?.name??n.$t("common.noVendor")),1)]),d("div",sl,[e(x,{color:"primary",variant:"outlined",onClick:ye},{default:l(()=>[...a[20]||(a[20]=[u(" Duzenle ",-1)])]),_:1}),e(x,{variant:"outlined",to:"/expenses"},{default:l(()=>[...a[21]||(a[21]=[u(" Listeye Don ",-1)])]),_:1})])])]),_:1}),t(y)?(p(),V(f,{key:0,cols:"12"},{default:l(()=>[e($e,{type:"error",variant:"tonal",closable:"","onClick:close":a[0]||(a[0]=o=>y.value="")},{default:l(()=>[u(i(t(y)),1)]),_:1})]),_:1})):g("",!0),e(f,{cols:"12",md:"8"},{default:l(()=>[e(O,{loading:t(Z),class:"mb-4"},{default:l(()=>[t(s)?(p(),V(w,{key:0},{default:l(()=>[e(B,{class:"card-list"},{default:l(()=>[t(s).description?(p(),V(v,{key:0},{append:l(()=>[d("div",ul,[d("span",null,i(t(s).description),1),t(s).vendor?(p(),V(Te,{key:0,size:"small",color:"primary",variant:"tonal"},{default:l(()=>[u(i(t(s).vendor.name),1)]),_:1})):g("",!0)])]),default:l(()=>[e(_,null,{default:l(()=>[u(i(n.$t("common.description")),1)]),_:1})]),_:1})):g("",!0),e(v,null,{append:l(()=>[d("span",dl,i(t(R)(t(s).amount)),1)]),default:l(()=>[e(_,null,{default:l(()=>[u(i(n.$t("common.amount")),1)]),_:1})]),_:1}),e(v,null,{append:l(()=>[d("span",null,i(t(P)(t(s).expense_date)),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[22]||(a[22]=[u("Gider Tarihi",-1)])]),_:1})]),_:1}),e(v,null,{append:l(()=>[d("span",null,i(t(P)(t(s).due_date)),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[23]||(a[23]=[u("Vade",-1)])]),_:1})]),_:1}),e(v,null,{append:l(()=>[d("span",null,i(t(s).account?.name??"-"),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[24]||(a[24]=[u("Hesap",-1)])]),_:1})]),_:1}),e(v,null,{append:l(()=>[e(Te,{size:"small",color:t(We)(t(s).status),variant:"tonal"},{default:l(()=>[u(i(t(Xe)(t(s).status)),1)]),_:1},8,["color"])]),default:l(()=>[e(_,null,{default:l(()=>[...a[25]||(a[25]=[u("Durum",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1},8,["loading"]),e(O,null,{default:l(()=>[e(ll,{modelValue:t(E),"onUpdate:modelValue":a[1]||(a[1]=o=>I(E)?E.value=o:null),class:"v-tabs-pill"},{default:l(()=>[e(ne,{value:"payments"},{default:l(()=>[...a[26]||(a[26]=[u(" Odemeler ",-1)])]),_:1}),e(ne,{value:"notes"},{default:l(()=>[...a[27]||(a[27]=[u(" Notlar ",-1)])]),_:1}),e(ne,{value:"history"},{default:l(()=>[...a[28]||(a[28]=[u(" Gecmis ",-1)])]),_:1})]),_:1},8,["modelValue"]),e(z),ae(d("div",null,[e(al,{density:"comfortable"},{default:l(()=>[d("thead",null,[d("tr",null,[d("th",null,i(n.$t("common.date")),1),d("th",null,i(n.$t("common.method")),1),d("th",null,i(n.$t("common.cashAccount")),1),a[29]||(a[29]=d("th",{class:"text-right"}," Tutar ",-1))])]),d("tbody",null,[(p(!0),k(S,null,te(t(s)?.payment_items??[],o=>(p(),k("tr",{key:o.id},[d("td",null,i(t(P)(o.payment?.paid_at??"")),1),d("td",null,i(o.payment?.method??"-"),1),d("td",null,i(o.payment?.cash_account?.name??"-"),1),d("td",il,i(t(R)(o.amount)),1)]))),128)),(t(s)?.payment_items??[]).length===0?(p(),k("tr",rl,[d("td",ml,i(n.$t("common.noPaymentRecords")),1)])):g("",!0)])]),_:1})],512),[[oe,t(E)==="payments"]]),ae(d("div",null,[e(w,null,{default:l(()=>[e(h,null,{default:l(()=>[e(f,{cols:"12",md:"10"},{default:l(()=>[e(se,{modelValue:t(T),"onUpdate:modelValue":a[2]||(a[2]=o=>I(T)?T.value=o:null),label:"Not ekleyin...",rows:"2","hide-details":""},null,8,["modelValue"])]),_:1}),e(f,{cols:"12",md:"2",class:"d-flex align-end"},{default:l(()=>[e(x,{color:"primary",block:"",loading:t(W),disabled:!t(T).trim(),onClick:Ge},{default:l(()=>[...a[30]||(a[30]=[u(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1}),e(z),t(K).length?(p(),V(B,{key:0},{default:l(()=>[(p(!0),k(S,null,te(t(K),(o,Y)=>(p(),k(S,{key:o.id},[e(v,null,{append:l(()=>[e(x,{icon:"",size:"small",variant:"text",color:"error",onClick:yl=>Ie(o.id)},{default:l(()=>[e(M,{icon:"ri-delete-bin-line"})]),_:1},8,["onClick"])]),default:l(()=>[e(_,null,{default:l(()=>[u(i(o.content),1)]),_:2},1024),e(Ce,null,{default:l(()=>[u(i(o.created_by?.name??"-")+" - "+i(t(P)(o.created_at)),1)]),_:2},1024)]),_:2},1024),Y<t(K).length-1?(p(),V(z,{key:0})):g("",!0)],64))),128))]),_:1})):(p(),V(w,{key:1,class:"text-center text-medium-emphasis"},{default:l(()=>[...a[31]||(a[31]=[u(" Henuz not eklenmemis. ",-1)])]),_:1}))],512),[[oe,t(E)==="notes"]]),ae(d("div",null,[t(X).length?(p(),V(B,{key:0},{default:l(()=>[(p(!0),k(S,null,te(t(X),(o,Y)=>(p(),k(S,{key:Y},[e(v,null,{prepend:l(()=>[e(M,{icon:o.icon,color:o.color,class:"me-2"},null,8,["icon","color"])]),default:l(()=>[e(_,null,{default:l(()=>[u(i(o.description)+" ",1),o.amount?(p(),k("span",pl," ("+i(t(R)(o.amount))+") ",1)):g("",!0)]),_:2},1024),e(Ce,null,{default:l(()=>[u(i(o.by??"")+" - "+i(t(P)(o.date)),1)]),_:2},1024)]),_:2},1024),Y<t(X).length-1?(p(),V(z,{key:0})):g("",!0)],64))),128))]),_:1})):(p(),V(w,{key:1,class:"text-center text-medium-emphasis"},{default:l(()=>[...a[32]||(a[32]=[u(" Gecmis kaydi yok. ",-1)])]),_:1}))],512),[[oe,t(E)==="history"]])]),_:1})]),_:1}),e(f,{cols:"12",md:"4"},{default:l(()=>[e(O,{class:"mb-4"},{default:l(()=>[e(w,{class:"d-flex align-center justify-space-between"},{default:l(()=>[d("div",null,[a[33]||(a[33]=d("div",{class:"text-overline text-medium-emphasis"}," KALAN ",-1)),d("div",{class:Ye(["text-h4",(t(s)?.remaining??0)>0?"text-error":"text-success"])},i(t(R)(t(s)?.remaining??0)),3)]),e(Je,{modelValue:t(j),"onUpdate:modelValue":a[3]||(a[3]=o=>I(j)?j.value=o:null),location:"bottom end"},{activator:l(({props:o})=>[e(x,he({variant:"outlined"},o,{"append-icon":"ri-arrow-down-s-line"}),{default:l(()=>[...a[34]||(a[34]=[u(" Diger ",-1)])]),_:1},16)]),default:l(()=>[e(B,{density:"compact"},{default:l(()=>[e(v,{onClick:Be},{prepend:l(()=>[e(M,{icon:"ri-file-copy-line",class:"me-2"})]),default:l(()=>[a[35]||(a[35]=u(" Kopyala ",-1))]),_:1}),e(v,{onClick:ye},{prepend:l(()=>[e(M,{icon:"ri-edit-line",class:"me-2"})]),default:l(()=>[a[36]||(a[36]=u(" Duzenle ",-1))]),_:1}),e(z),e(v,{loading:t(J),class:"text-error",onClick:Pe},{prepend:l(()=>[e(M,{icon:"ri-delete-bin-line",class:"me-2"})]),default:l(()=>[a[37]||(a[37]=u(" Sil ",-1))]),_:1},8,["loading"])]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(z),e(w,null,{default:l(()=>[e(x,{color:"success",block:"","prepend-icon":"ri-secure-payment-line",disabled:!t(s)||t(s).remaining<=0,onClick:Me},{default:l(()=>[...a[38]||(a[38]=[u(" Odeme Yap ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1}),t(s)?(p(),V(O,{key:0},{default:l(()=>[e(el,{title:"Ozet"}),e(w,null,{default:l(()=>[e(B,{class:"card-list",density:"compact"},{default:l(()=>[e(v,null,{append:l(()=>[d("span",null,i(t(R)(t(s).amount)),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[39]||(a[39]=[u("Toplam Tutar",-1)])]),_:1})]),_:1}),e(v,null,{append:l(()=>[d("span",fl,i(t(R)(t(s).paid_amount)),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[40]||(a[40]=[u("Odenen",-1)])]),_:1})]),_:1}),e(v,null,{append:l(()=>[d("span",cl,i(t(R)(t(s).remaining)),1)]),default:l(()=>[e(_,null,{default:l(()=>[...a[41]||(a[41]=[u("Kalan",-1)])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1}),e(we,{modelValue:t(A),"onUpdate:modelValue":a[12]||(a[12]=o=>I(A)?A.value=o:null),"max-width":"760"},{default:l(()=>[e(O,{title:"Gider Duzenle"},{default:l(()=>[e(w,null,{default:l(()=>[e(xe,{ref_key:"editFormRef",ref:fe,onSubmit:_e(Ve,["prevent"])},{default:l(()=>[e(h,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>[e(Q,{modelValue:t(m).vendor_id,"onUpdate:modelValue":a[4]||(a[4]=o=>t(m).vendor_id=o),items:t(re),"item-title":"label","item-value":"id",label:n.$t("common.vendor"),clearable:"","error-messages":t(b).vendor_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(Q,{modelValue:t(m).account_id,"onUpdate:modelValue":a[5]||(a[5]=o=>t(m).account_id=o),items:t(me),"item-title":"label","item-value":"id",label:"Gider Hesabi",rules:Fe,"error-messages":t(b).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),e(f,{cols:"12",md:"4"},{default:l(()=>[e(L,{modelValue:t(m).expense_date,"onUpdate:modelValue":a[6]||(a[6]=o=>t(m).expense_date=o),type:"date",label:n.$t("common.expenseDate"),rules:Oe,"error-messages":t(b).expense_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"4"},{default:l(()=>[e(L,{modelValue:t(m).due_date,"onUpdate:modelValue":a[7]||(a[7]=o=>t(m).due_date=o),type:"date",label:n.$t("common.dueDate"),rules:ze,"error-messages":t(b).due_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"4"},{default:l(()=>[e(L,{modelValue:t(m).amount,"onUpdate:modelValue":a[8]||(a[8]=o=>t(m).amount=o),type:"number",step:"0.01",min:"0",label:n.$t("common.amount"),rules:Le,disabled:t(ce),"error-messages":t(b).amount??[]},null,8,["modelValue","label","disabled","error-messages"])]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(se,{modelValue:t(m).description,"onUpdate:modelValue":a[9]||(a[9]=o=>t(m).description=o),label:n.$t("common.description"),rows:"2","error-messages":t(b).description??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(L,{modelValue:t(m).invoice_no,"onUpdate:modelValue":a[10]||(a[10]=o=>t(m).invoice_no=o),label:"Fatura/Fis No","error-messages":t(b).invoice_no??[]},null,8,["modelValue","error-messages"])]),_:1}),t(ce)?(p(),V(f,{key:0,cols:"12"},{default:l(()=>[e($e,{type:"warning",variant:"tonal"},{default:l(()=>[...a[42]||(a[42]=[u(" Bu giderin odemesi yapilmis. Tutar degistirilemez. ",-1)])]),_:1})]),_:1})):g("",!0)]),_:1})]),_:1},512)]),_:1}),e(De,{class:"px-6 pb-4"},{default:l(()=>[e(be),e(x,{variant:"outlined",disabled:t(G),onClick:a[11]||(a[11]=o=>A.value=!1)},{default:l(()=>[...a[43]||(a[43]=[u(" Iptal ",-1)])]),_:1},8,["disabled"]),e(x,{color:"primary",loading:t(G),disabled:t(G),onClick:Ve},{default:l(()=>[...a[44]||(a[44]=[u(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(we,{modelValue:t(N),"onUpdate:modelValue":a[19]||(a[19]=o=>I(N)?N.value=o:null),"max-width":"560"},{default:l(()=>[e(O,{title:"Odeme Yap"},{default:l(()=>[e(w,null,{default:l(()=>[e(xe,{ref_key:"payFormRef",ref:pe,onSubmit:_e(ve,["prevent"])},{default:l(()=>[e(h,null,{default:l(()=>[e(f,{cols:"12",md:"6"},{default:l(()=>[e(L,{modelValue:t(c).paid_at,"onUpdate:modelValue":a[13]||(a[13]=o=>t(c).paid_at=o),type:"date",label:n.$t("common.paymentDate"),rules:Ee,"error-messages":t(D).paid_at??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"6"},{default:l(()=>[e(Q,{modelValue:t(c).method,"onUpdate:modelValue":a[14]||(a[14]=o=>t(c).method=o),items:t(ie),"item-title":"label","item-value":"value",label:n.$t("common.method"),rules:Ne,"error-messages":t(D).method??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(Q,{modelValue:t(c).cash_account_id,"onUpdate:modelValue":a[15]||(a[15]=o=>t(c).cash_account_id=o),items:t(de),"item-title":"name","item-value":"id",label:n.$t("common.cashAccount"),rules:Ae,"error-messages":t(D).cash_account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(L,{modelValue:t(c).amount,"onUpdate:modelValue":a[16]||(a[16]=o=>t(c).amount=o),type:"number",step:"0.01",min:"0",label:n.$t("common.amount"),rules:Se,"error-messages":t(D).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12"},{default:l(()=>[e(se,{modelValue:t(c).description,"onUpdate:modelValue":a[17]||(a[17]=o=>t(c).description=o),label:n.$t("common.description"),rows:"2","error-messages":t(D).description??[]},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(De,{class:"px-6 pb-4"},{default:l(()=>[e(be),e(x,{variant:"outlined",onClick:a[18]||(a[18]=o=>N.value=!1)},{default:l(()=>[u(i(n.$t("common.cancel")),1)]),_:1}),e(x,{color:"primary",loading:t(H),disabled:t(H),onClick:ve},{default:l(()=>[...a[45]||(a[45]=[u(" Ode ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{Ml as default};
