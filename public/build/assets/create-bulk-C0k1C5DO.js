import{j as q,h as d,D as $,Q as w,R,S as s,ac as G,q as t,y as n,a8 as m,u as a,ag as H,O as L,ad as P}from"./vendor-DfCbaU-T.js";import{$ as h,T as A,x as f,U as Q}from"./main-OjHNd2U9.js";import{u as J,i as S}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as K,r as g,p as W}from"./VForm-CtC6ldpE.js";import{V as D,a as u}from"./VRow-Ba58lXtG.js";import{V as X}from"./VCard-9RfFlHpT.js";import{V as Y}from"./VCardText-YweTyZzP.js";import{V as Z}from"./VAlert-DafHPFjN.js";import{V as _}from"./VSelect-CMe3Xagq.js";import{V as b}from"./VTextField-CMxHKe9w.js";import{V as ee}from"./VTextarea-CHmrCRFp.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VList-B1ov9hmg.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";import"./VChip-CnrRRXXG.js";const ae={class:"d-flex align-center justify-space-between mb-2"},te={class:"d-flex justify-space-between align-center mb-2"},le={class:"d-flex gap-2"},se={class:"d-flex justify-end gap-3"},we=q({__name:"create-bulk",setup(re){const{withAbort:y}=J(),U=G(),p=d(!1),V=d(!1),c=d(""),i=d({}),v=d([]),k=d([]),T=d([]),l=d({apartment_ids:[],account_id:null,charge_type:"aidat",period:new Date().toISOString().slice(0,7),due_date:new Date().toISOString().slice(0,10),amount:null,description:""}),x=d(null),C=[r=>Array.isArray(r)&&r.length>0?!0:"En az bir daire seciniz."],z=[g()],M=[g()],O=[g()],B=[g()],E=[g(),W()],N=async()=>{V.value=!0;try{const r=await y(e=>h("/charges/meta",{signal:e}));v.value=r.data.apartments,k.value=r.data.accounts,T.value=r.data.charge_types}catch(r){if(S(r))return;c.value=A(r,"Form verileri alinamadi.")}finally{V.value=!1}},j=()=>{l.value.apartment_ids=v.value.map(r=>r.id)},F=()=>{l.value.apartment_ids=[]},I=async()=>{if((await x.value?.validate())?.valid){p.value=!0,c.value="",i.value={};try{await y(e=>h("/charges/bulk",{method:"POST",body:{apartment_ids:l.value.apartment_ids,account_id:l.value.account_id,charge_type:l.value.charge_type,period:l.value.period,due_date:l.value.due_date,amount:l.value.amount,description:l.value.description||null},signal:e})),await U.push("/charges")}catch(e){if(S(e))return;c.value=A(e,"Toplu tahakkuk olusturulamadi."),i.value=Q(e)}finally{p.value=!1}}};return $(N),(r,e)=>(w(),R(D,null,{default:s(()=>[t(u,{cols:"12"},{default:s(()=>[n("div",ae,[e[8]||(e[8]=n("div",null,[n("h4",{class:"text-h4 mb-1"}," Toplu Tahakkuk "),n("p",{class:"text-medium-emphasis mb-0"}," Birden fazla daire icin tek seferde tahakkuk olusturun ")],-1)),t(f,{variant:"outlined",to:"/charges"},{default:s(()=>[...e[7]||(e[7]=[m(" Listeye Don ",-1)])]),_:1})])]),_:1}),t(u,{cols:"12"},{default:s(()=>[t(X,{loading:a(V)||a(p)},{default:s(()=>[t(Y,null,{default:s(()=>[t(K,{ref_key:"formRef",ref:x,onSubmit:H(I,["prevent"])},{default:s(()=>[t(D,null,{default:s(()=>[a(c)?(w(),R(u,{key:0,cols:"12"},{default:s(()=>[t(Z,{type:"error",variant:"tonal"},{default:s(()=>[m(L(a(c)),1)]),_:1})]),_:1})):P("",!0),t(u,{cols:"12"},{default:s(()=>[n("div",te,[e[11]||(e[11]=n("label",{class:"text-body-2"},"Daireler",-1)),n("div",le,[t(f,{size:"small",variant:"text",onClick:j},{default:s(()=>[...e[9]||(e[9]=[m(" Tumunu Sec ",-1)])]),_:1}),t(f,{size:"small",variant:"text",onClick:F},{default:s(()=>[...e[10]||(e[10]=[m(" Temizle ",-1)])]),_:1})])]),t(_,{modelValue:a(l).apartment_ids,"onUpdate:modelValue":e[0]||(e[0]=o=>a(l).apartment_ids=o),items:a(v),"item-title":"label","item-value":"id",label:"Daireler",multiple:"",chips:"","closable-chips":"",rules:C,"error-messages":a(i).apartment_ids??a(i)["apartment_ids.0"]??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(u,{cols:"12",md:"6"},{default:s(()=>[t(_,{modelValue:a(l).account_id,"onUpdate:modelValue":e[1]||(e[1]=o=>a(l).account_id=o),items:a(k),"item-title":"label","item-value":"id",label:"Gelir Hesabi",rules:z,"error-messages":a(i).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(u,{cols:"12",md:"6"},{default:s(()=>[t(_,{modelValue:a(l).charge_type,"onUpdate:modelValue":e[2]||(e[2]=o=>a(l).charge_type=o),items:a(T),"item-title":"label","item-value":"value",label:"Tahakkuk Turu",rules:M,"error-messages":a(i).charge_type??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:s(()=>[t(b,{modelValue:a(l).period,"onUpdate:modelValue":e[3]||(e[3]=o=>a(l).period=o),type:"month",label:"Donem",rules:O,"error-messages":a(i).period??[]},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:s(()=>[t(b,{modelValue:a(l).due_date,"onUpdate:modelValue":e[4]||(e[4]=o=>a(l).due_date=o),type:"date",label:"Vade Tarihi",rules:B,"error-messages":a(i).due_date??[]},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:s(()=>[t(b,{modelValue:a(l).amount,"onUpdate:modelValue":e[5]||(e[5]=o=>a(l).amount=o),type:"number",step:"0.01",min:"0",label:"Tutar",rules:E,"error-messages":a(i).amount??[]},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12"},{default:s(()=>[t(ee,{modelValue:a(l).description,"onUpdate:modelValue":e[6]||(e[6]=o=>a(l).description=o),label:"Aciklama",rows:"3","error-messages":a(i).description??[]},null,8,["modelValue","error-messages"])]),_:1}),t(u,{cols:"12"},{default:s(()=>[n("div",se,[t(f,{variant:"outlined",to:"/charges"},{default:s(()=>[...e[12]||(e[12]=[m(" Iptal ",-1)])]),_:1}),t(f,{color:"primary",type:"submit",loading:a(p),disabled:a(p)},{default:s(()=>[...e[13]||(e[13]=[m(" Toplu Olustur ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{we as default};
