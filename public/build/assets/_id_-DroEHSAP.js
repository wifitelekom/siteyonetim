import{j as K,f as W,h as m,D as X,Q as h,R as A,S as o,Z as Y,ac as ee,q as a,y as l,O as s,u as e,a8 as f,ad as x,V as $,F as te,ab as ae,H as le,ag as oe}from"./vendor-qaEqcc9M.js";import{$ as D,T as R,x as _,V as se,U as ie}from"./main-DUODoQpR.js";import{u as ne,i as S}from"./useAbortOnUnmount-B_TyPYrd.js";import{a as L,f as k}from"./formatters-BEv4aA23.js";import{c as de,a as re}from"./statusHelpers-D3tNe4to.js";import{V as ue,r as w,p as me}from"./VForm-AfrkaUJk.js";import{V as E,a as r}from"./VRow-dBMGxjTF.js";import{V as ce}from"./VAlert-DIbLZTVg.js";import{V as B,a as pe,d as fe}from"./VCard-DEMyauu_.js";import{V as O}from"./VCardText-lEnvPJxp.js";import{V as he}from"./VChip-CzUAJTHl.js";import{V as ve}from"./VTable-CDiDVqFm.js";import{V as _e}from"./VDialog-8MtGyTgn.js";import{V as H}from"./VTextField-BgtisBQp.js";import{V as I}from"./VSelect-BpDYXa0x.js";import{V as ge}from"./VTextarea-BWwjO-LJ.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";const be={class:"d-flex align-center justify-space-between mb-2"},Ve={class:"text-h4 mb-1"},ye={class:"text-medium-emphasis mb-0"},xe={class:"text-body-2 text-medium-emphasis mb-0"},$e={class:"d-flex gap-2"},ke={class:"font-weight-medium"},we={class:"font-weight-medium"},Ce={class:"font-weight-medium"},Te={class:"font-weight-medium"},Ae={class:"font-weight-medium"},De={key:0,class:"text-medium-emphasis"},Re={class:"text-caption text-medium-emphasis"},Se={class:"text-h6"},Ee={class:"text-caption text-medium-emphasis"},Be={class:"text-h6 text-success"},Fe={class:"text-caption text-medium-emphasis"},Ue={class:"text-h6 text-error"},Ne={class:"text-caption text-medium-emphasis"},Me={class:"text-right"},Le={key:0},Oe={colspan:"5",class:"text-center text-medium-emphasis py-6"},rt=K({__name:"[id]",setup(He){const{withAbort:C}=ne(),j=Y(),q=ee(),T=W(()=>Number(j.params.id)),g=m(!1),b=m(!1),V=m(!1),c=m(""),n=m(null),y=m([]),F=m([]),v=m(!1),p=m({}),u=m({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),U=m(null),z=[w()],P=[w()],Q=[w()],Z=[w(),me()],N=async()=>{g.value=!0,c.value="";try{const i=await C(t=>D(`/charges/${T.value}`,{signal:t}));n.value=i.data,y.value=i.meta.cash_accounts,F.value=i.meta.payment_methods}catch(i){if(S(i))return;c.value=R(i,"Tahakkuk detayı alınamadı.")}finally{g.value=!1}},G=()=>{if(p.value={},y.value.length===0){c.value="Tahsilat için önce bir kasa/banka hesabı ekleyin.";return}u.value.amount=n.value?.remaining??null,u.value.cash_account_id==null&&(u.value.cash_account_id=y.value[0]?.id??null),v.value=!0},M=async()=>{if((await U.value?.validate())?.valid){b.value=!0,c.value="",p.value={};try{await C(t=>D(`/charges/${T.value}/collect`,{method:"POST",body:{paid_at:u.value.paid_at,method:u.value.method,cash_account_id:u.value.cash_account_id,amount:u.value.amount,description:u.value.description||null},signal:t})),v.value=!1,await N()}catch(t){if(S(t))return;c.value=R(t,"Tahsilat işlemi başarısız."),p.value=ie(t)}finally{b.value=!1}}},J=async()=>{V.value=!0,c.value="";try{await C(i=>D(`/charges/${T.value}`,{method:"DELETE",signal:i})),await q.push("/charges")}catch(i){if(S(i))return;c.value=R(i,"Tahakkuk silinemedi.")}finally{V.value=!1}};return X(N),(i,t)=>(h(),A(E,null,{default:o(()=>[a(r,{cols:"12"},{default:o(()=>[l("div",be,[l("div",null,[l("h4",Ve,s(i.$t("pages.charges.detailTitle")),1),l("p",ye,s(e(n)?.apartment?.label??"-"),1),l("p",xe,s(e(n)?.debtor?`${e(n).debtor.type_label}: ${e(n).debtor.name}`:"Borçlu: -"),1)]),l("div",$e,[a(_,{variant:"outlined",to:"/charges"},{default:o(()=>[...t[7]||(t[7]=[f(" Listeye Dön ",-1)])]),_:1}),a(_,{color:"success","prepend-icon":"ri-hand-coin-line",disabled:!e(n)||e(n).remaining<=0,onClick:G},{default:o(()=>[...t[8]||(t[8]=[f(" Tahsilat Al ",-1)])]),_:1},8,["disabled"]),a(_,{color:"error",variant:"outlined","prepend-icon":"ri-delete-bin-line",loading:e(V),disabled:e(V),onClick:J},{default:o(()=>[...t[9]||(t[9]=[f(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(c)?(h(),A(r,{key:0,cols:"12"},{default:o(()=>[a(ce,{type:"error",variant:"tonal"},{default:o(()=>[f(s(e(c)),1)]),_:1})]),_:1})):x("",!0),a(r,{cols:"12"},{default:o(()=>[a(B,{loading:e(g)},{default:o(()=>[e(n)?(h(),A(O,{key:0},{default:o(()=>[a(E,null,{default:o(()=>[a(r,{cols:"12",md:"3"},{default:o(()=>[t[10]||(t[10]=l("div",{class:"text-caption text-medium-emphasis"}," Dönem ",-1)),l("div",ke,s(e(n).period),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:o(()=>[t[11]||(t[11]=l("div",{class:"text-caption text-medium-emphasis"}," Vade ",-1)),l("div",we,s(e(L)(e(n).due_date)),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:o(()=>[t[12]||(t[12]=l("div",{class:"text-caption text-medium-emphasis"}," Hesap ",-1)),l("div",Ce,s(e(n).account?.name??"-"),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:o(()=>[t[13]||(t[13]=l("div",{class:"text-caption text-medium-emphasis"}," Durum ",-1)),a(he,{size:"small",color:e(de)(e(n).status),variant:"tonal"},{default:o(()=>[f(s(e(re)(e(n).status)),1)]),_:1},8,["color"])]),_:1}),a(r,{cols:"12",md:"6"},{default:o(()=>[t[14]||(t[14]=l("div",{class:"text-caption text-medium-emphasis"}," Borçlu Daire ",-1)),l("div",Te,s(e(n).apartment?.label??"-"),1)]),_:1}),a(r,{cols:"12",md:"6"},{default:o(()=>[t[15]||(t[15]=l("div",{class:"text-caption text-medium-emphasis"}," Borçlu ",-1)),l("div",Ae,[f(s(e(n).debtor?.name??"-")+" ",1),e(n).debtor?.type_label?(h(),$("span",De," ("+s(e(n).debtor.type_label)+") ",1)):x("",!0)])]),_:1}),a(r,{cols:"12",md:"4"},{default:o(()=>[l("div",Re,s(i.$t("common.amount")),1),l("div",Se,s(e(k)(e(n).amount)),1)]),_:1}),a(r,{cols:"12",md:"4"},{default:o(()=>[l("div",Ee,s(i.$t("common.paid")),1),l("div",Be,s(e(k)(e(n).paid_amount)),1)]),_:1}),a(r,{cols:"12",md:"4"},{default:o(()=>[l("div",Fe,s(i.$t("common.remaining")),1),l("div",Ue,s(e(k)(e(n).remaining)),1)]),_:1}),a(r,{cols:"12"},{default:o(()=>[l("div",Ne,s(i.$t("common.description")),1),l("div",null,s(e(n).description||"-"),1)]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1},8,["loading"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(B,{loading:e(g)},{default:o(()=>[a(pe,{title:"Tahsilat Hareketleri"}),a(ve,{density:"comfortable"},{default:o(()=>[l("thead",null,[l("tr",null,[l("th",null,s(i.$t("common.receiptNo")),1),l("th",null,s(i.$t("common.date")),1),l("th",null,s(i.$t("common.method")),1),l("th",null,s(i.$t("common.cashAccount")),1),t[16]||(t[16]=l("th",{class:"text-right"}," Tutar ",-1))])]),l("tbody",null,[(h(!0),$(te,null,ae(e(n)?.receipt_items??[],d=>(h(),$("tr",{key:d.id},[l("td",null,s(d.receipt?.receipt_no??"-"),1),l("td",null,s(e(L)(d.receipt?.paid_at??"")),1),l("td",null,s(d.receipt?.method??"-"),1),l("td",null,s(d.receipt?.cash_account?.name??"-"),1),l("td",Me,s(e(k)(d.amount)),1)]))),128)),(e(n)?.receipt_items??[]).length===0?(h(),$("tr",Le,[l("td",Oe,s(i.$t("common.noCollectionRecords")),1)])):x("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),a(_e,{modelValue:e(v),"onUpdate:modelValue":t[6]||(t[6]=d=>le(v)?v.value=d:null),"max-width":"560"},{default:o(()=>[a(B,{title:"Tahsilat Al"},{default:o(()=>[a(O,null,{default:o(()=>[a(ue,{ref_key:"collectFormRef",ref:U,onSubmit:oe(M,["prevent"])},{default:o(()=>[a(E,null,{default:o(()=>[a(r,{cols:"12",md:"6"},{default:o(()=>[a(H,{modelValue:e(u).paid_at,"onUpdate:modelValue":t[0]||(t[0]=d=>e(u).paid_at=d),type:"date",label:i.$t("common.collectionDate"),rules:z,"error-messages":e(p).paid_at??[]},null,8,["modelValue","label","error-messages"])]),_:1}),a(r,{cols:"12",md:"6"},{default:o(()=>[a(I,{modelValue:e(u).method,"onUpdate:modelValue":t[1]||(t[1]=d=>e(u).method=d),items:e(F),"item-title":"label","item-value":"value",label:i.$t("common.method"),rules:P,"error-messages":e(p).method??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(I,{modelValue:e(u).cash_account_id,"onUpdate:modelValue":t[2]||(t[2]=d=>e(u).cash_account_id=d),items:e(y),"item-title":"name","item-value":"id",label:i.$t("common.cashAccount"),rules:Q,"error-messages":e(p).cash_account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(H,{modelValue:e(u).amount,"onUpdate:modelValue":t[3]||(t[3]=d=>e(u).amount=d),type:"number",step:"0.01",min:"0",label:i.$t("common.amount"),rules:Z,"error-messages":e(p).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),a(r,{cols:"12"},{default:o(()=>[a(ge,{modelValue:e(u).description,"onUpdate:modelValue":t[4]||(t[4]=d=>e(u).description=d),label:i.$t("common.description"),rows:"2","error-messages":e(p).description??[]},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(fe,{class:"px-6 pb-4"},{default:o(()=>[a(se),a(_,{variant:"outlined",onClick:t[5]||(t[5]=d=>v.value=!1)},{default:o(()=>[f(s(i.$t("common.cancel")),1)]),_:1}),a(_,{color:"primary",onClick:M,loading:e(b),disabled:e(b)},{default:o(()=>[...t[17]||(t[17]=[f(" Tahsil Et ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{rt as default};
