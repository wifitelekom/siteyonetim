import{j as I,f as S,h as m,D as G,Q as k,R as C,S as i,Z as O,ac as Q,q as l,y as d,a8 as _,u as a,ag as Z,O as x,ad as H,v as J}from"./vendor-DfCbaU-T.js";import{e as K,$ as R,T as A,x as c,U as W}from"./main-OjHNd2U9.js";import{V as X,r as U,e as ee,m as ae,b as le}from"./VForm-CtC6ldpE.js";import{V as E,a as o}from"./VRow-Ba58lXtG.js";import{V as se}from"./VCard-9RfFlHpT.js";import{V as ie}from"./VCardText-YweTyZzP.js";import{V as re}from"./VAlert-DafHPFjN.js";import{V as p}from"./VTextField-CMxHKe9w.js";import{V as te}from"./VTextarea-CHmrCRFp.js";import{V as oe}from"./VSwitch-XgqsY1US.js";import{V as ne}from"./VDivider-CUijZXd4.js";import{V as de}from"./VSelect-CMe3Xagq.js";import{a as ue}from"./VList-B1ov9hmg.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VSelectionControl-Ck2LTPqY.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VChip-CnrRRXXG.js";const me={class:"d-flex align-center justify-space-between mb-2"},pe={class:"d-flex gap-2"},fe={class:"d-flex justify-end gap-3"},De=I({__name:"edit",setup(_e){const D=O(),g=Q(),Y=K(),w=S(()=>Number(D.params.id)),b=m(!1),f=m(!1),v=m(!1),u=m(""),n=m({}),N=m([]),s=m({name:"",phone:"",tax_no:"",address:"",is_active:!0,admin_user_id:null,admin_name:"",admin_email:"",admin_password:"",admin_password_confirmation:""}),T=m(null),z=S(()=>Y.can("sites.manage")),V=S(()=>s.value.admin_name.trim().length>0||s.value.admin_email.trim().length>0||s.value.admin_password.trim().length>0||s.value.admin_password_confirmation.trim().length>0),y=(r,e)=>V.value?U(e)(r):!0,B=[U()],h=[r=>y(r,"Yonetici adi zorunludur.")],M=[r=>{if(!V.value)return!0;const e=U("Yonetici e-posta zorunludur.")(r);return e!==!0?e:ee()(r)}],$=[r=>y(r,"Yonetici sifresi zorunludur."),r=>V.value?ae(8)(r):!0],q=[r=>y(r,"Sifre tekrar zorunludur."),r=>V.value?le(()=>s.value.admin_password,"Sifreler eslesmiyor.")(r):!0],F=async()=>{b.value=!0,u.value="";try{const r=await R(`/super/sites/${w.value}`);N.value=r.meta.available_admins,s.value={name:r.data.name,phone:r.data.phone??"",tax_no:r.data.tax_no??"",address:r.data.address??"",is_active:r.data.is_active,admin_user_id:r.data.current_admin_id??null,admin_name:"",admin_email:"",admin_password:"",admin_password_confirmation:""}}catch(r){u.value=A(r,"Site detayi alinamadi.")}finally{b.value=!1}},L=async()=>{if((await T.value?.validate())?.valid){f.value=!0,u.value="",n.value={};try{await R(`/super/sites/${w.value}`,{method:"PUT",body:{name:s.value.name,phone:s.value.phone||null,tax_no:s.value.tax_no||null,address:s.value.address||null,is_active:s.value.is_active,admin_user_id:s.value.admin_user_id||null,admin_name:s.value.admin_name||null,admin_email:s.value.admin_email||null,admin_password:s.value.admin_password||null,admin_password_confirmation:s.value.admin_password_confirmation||null}}),await g.push("/super/sites")}catch(e){u.value=A(e,"Site guncellenemedi."),n.value=W(e)}finally{f.value=!1}}},P=async()=>{v.value=!0,u.value="";try{await R(`/super/sites/${w.value}`,{method:"DELETE"}),await g.push("/super/sites")}catch(r){u.value=A(r,"Site silinemedi.")}finally{v.value=!1}};return G(async()=>{if(await Y.ensureSession(),!z.value){await g.replace("/");return}await F()}),(r,e)=>(k(),C(E,null,{default:i(()=>[l(o,{cols:"12"},{default:i(()=>[d("div",me,[e[12]||(e[12]=d("div",null,[d("h4",{class:"text-h4 mb-1"}," Site Duzenle "),d("p",{class:"text-medium-emphasis mb-0"}," Site ve yonetici bilgilerini guncelleyin ")],-1)),d("div",pe,[l(c,{variant:"outlined",to:"/super/sites"},{default:i(()=>[...e[10]||(e[10]=[_(" Listeye Don ",-1)])]),_:1}),l(c,{color:"error",variant:"outlined",loading:a(v),disabled:a(v),onClick:P},{default:i(()=>[...e[11]||(e[11]=[_(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),l(o,{cols:"12"},{default:i(()=>[l(se,{loading:a(b)||a(f)},{default:i(()=>[l(ie,null,{default:i(()=>[l(X,{ref_key:"formRef",ref:T,onSubmit:Z(L,["prevent"])},{default:i(()=>[l(E,null,{default:i(()=>[a(u)?(k(),C(o,{key:0,cols:"12"},{default:i(()=>[l(re,{type:"error",variant:"tonal"},{default:i(()=>[_(x(a(u)),1)]),_:1})]),_:1})):H("",!0),l(o,{cols:"12"},{default:i(()=>[...e[13]||(e[13]=[d("h6",{class:"text-h6 mb-2"}," Site Bilgileri ",-1)])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).name,"onUpdate:modelValue":e[0]||(e[0]=t=>a(s).name=t),label:"Site Adi",rules:B,"error-messages":a(n).name??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).phone,"onUpdate:modelValue":e[1]||(e[1]=t=>a(s).phone=t),label:"Telefon","error-messages":a(n).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).tax_no,"onUpdate:modelValue":e[2]||(e[2]=t=>a(s).tax_no=t),label:"Vergi No","error-messages":a(n).tax_no??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12"},{default:i(()=>[l(te,{modelValue:a(s).address,"onUpdate:modelValue":e[3]||(e[3]=t=>a(s).address=t),label:"Adres",rows:"3","error-messages":a(n).address??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12"},{default:i(()=>[l(oe,{modelValue:a(s).is_active,"onUpdate:modelValue":e[4]||(e[4]=t=>a(s).is_active=t),label:"Aktif",color:"primary"},null,8,["modelValue"])]),_:1}),l(o,{cols:"12"},{default:i(()=>[l(ne)]),_:1}),l(o,{cols:"12"},{default:i(()=>[...e[14]||(e[14]=[d("h6",{class:"text-h6 mb-2"}," Site Yonetici Bilgileri ",-1)])]),_:1}),l(o,{cols:"12"},{default:i(()=>[l(de,{modelValue:a(s).admin_user_id,"onUpdate:modelValue":e[5]||(e[5]=t=>a(s).admin_user_id=t),items:a(N),"item-title":"name","item-value":"id",label:"Yonetici Ata (opsiyonel)",clearable:"","error-messages":a(n).admin_user_id??[]},{item:i(({props:t,item:j})=>[l(ue,J(t,{subtitle:j.raw.email||"-"}),null,16,["subtitle"])]),selection:i(({item:t})=>[d("span",null,x(t.raw.name)+" - "+x(t.raw.email||"-"),1)]),_:1},8,["modelValue","items","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).admin_name,"onUpdate:modelValue":e[6]||(e[6]=t=>a(s).admin_name=t),label:"Yeni Yonetici Ad Soyad",rules:h,"error-messages":a(n).admin_name??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).admin_email,"onUpdate:modelValue":e[7]||(e[7]=t=>a(s).admin_email=t),type:"email",label:"Yeni Yonetici E-posta",rules:M,"error-messages":a(n).admin_email??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).admin_password,"onUpdate:modelValue":e[8]||(e[8]=t=>a(s).admin_password=t),type:"password",label:"Yeni Yonetici Sifre",rules:$,"error-messages":a(n).admin_password??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12",md:"6"},{default:i(()=>[l(p,{modelValue:a(s).admin_password_confirmation,"onUpdate:modelValue":e[9]||(e[9]=t=>a(s).admin_password_confirmation=t),type:"password",label:"Sifre Tekrar",rules:q,"error-messages":a(n).admin_password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),l(o,{cols:"12"},{default:i(()=>[d("div",fe,[l(c,{variant:"outlined",to:"/super/sites"},{default:i(()=>[...e[15]||(e[15]=[_(" Vazgec ",-1)])]),_:1}),l(c,{color:"primary",type:"submit",loading:a(f),disabled:a(f)},{default:i(()=>[...e[16]||(e[16]=[_(" Guncelle ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{De as default};
