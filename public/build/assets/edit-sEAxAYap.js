import{j as Y,f as h,h as u,D as O,Q as T,R as C,S as t,Z as Q,ac as Z,q as s,y as d,a8 as v,u as a,ag as G,O as p,ad as H,v as J}from"./vendor-qaEqcc9M.js";import{e as K,$ as R,T as $,x as g,U as W}from"./main-DUODoQpR.js";import{V as X,r as x,e as ee,m as ae,b as se}from"./VForm-AfrkaUJk.js";import{V as E,a as o}from"./VRow-dBMGxjTF.js";import{V as le}from"./VCard-DEMyauu_.js";import{V as re}from"./VCardText-lEnvPJxp.js";import{V as te}from"./VAlert-DIbLZTVg.js";import{V as f}from"./VTextField-BgtisBQp.js";import{V as ie}from"./VTextarea-BWwjO-LJ.js";import{V as oe}from"./VSwitch-C2gHzlAV.js";import{V as ne}from"./VDivider-CiCMqi-4.js";import{V as de}from"./VSelect-BpDYXa0x.js";import{a as me}from"./VList-BpKoOtV6.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VSelectionControl-DtdcpgRj.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VChip-CzUAJTHl.js";const ue={class:"d-flex align-center justify-space-between mb-2"},pe={class:"d-flex gap-2"},fe={class:"text-h6 mb-2"},_e={class:"text-h6 mb-2"},ve={class:"d-flex justify-end gap-3"},ze=Y({__name:"edit",setup(ce){const k=Q(),w=Z(),A=K(),b=h(()=>Number(k.params.id)),y=u(!1),_=u(!1),c=u(!1),m=u(""),n=u({}),N=u([]),l=u({name:"",phone:"",tax_no:"",address:"",is_active:!0,admin_user_id:null,admin_name:"",admin_email:"",admin_password:"",admin_password_confirmation:""}),U=u(null),D=h(()=>A.can("sites.manage")),V=h(()=>l.value.admin_name.trim().length>0||l.value.admin_email.trim().length>0||l.value.admin_password.trim().length>0||l.value.admin_password_confirmation.trim().length>0),S=(e,r)=>V.value?x(r)(e):!0,z=[x()],F=[e=>S(e,"Yönetici adı zorunludur.")],M=[e=>{if(!V.value)return!0;const r=x("Yönetici e-posta zorunludur.")(e);return r!==!0?r:ee()(e)}],P=[e=>S(e,"Yönetici şifresi zorunludur."),e=>V.value?ae(8)(e):!0],q=[e=>S(e,"Şifre tekrar zorunludur."),e=>V.value?se(()=>l.value.admin_password,"Şifreler eşleşmiyor.")(e):!0],B=async()=>{y.value=!0,m.value="";try{const e=await R(`/super/sites/${b.value}`);N.value=e.meta.available_admins,l.value={name:e.data.name,phone:e.data.phone??"",tax_no:e.data.tax_no??"",address:e.data.address??"",is_active:e.data.is_active,admin_user_id:e.data.current_admin_id??null,admin_name:"",admin_email:"",admin_password:"",admin_password_confirmation:""}}catch(e){m.value=$(e,"Site detayı alınamadı.")}finally{y.value=!1}},I=async()=>{if((await U.value?.validate())?.valid){_.value=!0,m.value="",n.value={};try{await R(`/super/sites/${b.value}`,{method:"PUT",body:{name:l.value.name,phone:l.value.phone||null,tax_no:l.value.tax_no||null,address:l.value.address||null,is_active:l.value.is_active,admin_user_id:l.value.admin_user_id||null,admin_name:l.value.admin_name||null,admin_email:l.value.admin_email||null,admin_password:l.value.admin_password||null,admin_password_confirmation:l.value.admin_password_confirmation||null}}),await w.push("/super/sites")}catch(r){m.value=$(r,"Site güncellenemedi."),n.value=W(r)}finally{_.value=!1}}},L=async()=>{c.value=!0,m.value="";try{await R(`/super/sites/${b.value}`,{method:"DELETE"}),await w.push("/super/sites")}catch(e){m.value=$(e,"Site silinemedi.")}finally{c.value=!1}};return O(async()=>{if(await A.ensureSession(),!D.value){await w.replace("/");return}await B()}),(e,r)=>(T(),C(E,null,{default:t(()=>[s(o,{cols:"12"},{default:t(()=>[d("div",ue,[r[12]||(r[12]=d("div",null,[d("h4",{class:"text-h4 mb-1"}," Site Düzenle "),d("p",{class:"text-medium-emphasis mb-0"}," Site ve yönetici bilgilerini güncelleyin ")],-1)),d("div",pe,[s(g,{variant:"outlined",to:"/super/sites"},{default:t(()=>[...r[10]||(r[10]=[v(" Listeye Don ",-1)])]),_:1}),s(g,{color:"error",variant:"outlined",loading:a(c),disabled:a(c),onClick:L},{default:t(()=>[...r[11]||(r[11]=[v(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),s(o,{cols:"12"},{default:t(()=>[s(le,{loading:a(y)||a(_)},{default:t(()=>[s(re,null,{default:t(()=>[s(X,{ref_key:"formRef",ref:U,onSubmit:G(I,["prevent"])},{default:t(()=>[s(E,null,{default:t(()=>[a(m)?(T(),C(o,{key:0,cols:"12"},{default:t(()=>[s(te,{type:"error",variant:"tonal"},{default:t(()=>[v(p(a(m)),1)]),_:1})]),_:1})):H("",!0),s(o,{cols:"12"},{default:t(()=>[d("h6",fe,p(e.$t("pages.superSites.siteInfo")),1)]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).name,"onUpdate:modelValue":r[0]||(r[0]=i=>a(l).name=i),label:e.$t("common.siteName"),rules:z,"error-messages":a(n).name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).phone,"onUpdate:modelValue":r[1]||(r[1]=i=>a(l).phone=i),label:"Telefon","error-messages":a(n).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).tax_no,"onUpdate:modelValue":r[2]||(r[2]=i=>a(l).tax_no=i),label:"Vergi No","error-messages":a(n).tax_no??[]},null,8,["modelValue","error-messages"])]),_:1}),s(o,{cols:"12"},{default:t(()=>[s(ie,{modelValue:a(l).address,"onUpdate:modelValue":r[3]||(r[3]=i=>a(l).address=i),label:"Adres",rows:"3","error-messages":a(n).address??[]},null,8,["modelValue","error-messages"])]),_:1}),s(o,{cols:"12"},{default:t(()=>[s(oe,{modelValue:a(l).is_active,"onUpdate:modelValue":r[4]||(r[4]=i=>a(l).is_active=i),label:e.$t("common.active"),color:"primary"},null,8,["modelValue","label"])]),_:1}),s(o,{cols:"12"},{default:t(()=>[s(ne)]),_:1}),s(o,{cols:"12"},{default:t(()=>[d("h6",_e,p(e.$t("pages.superSites.adminInfo")),1)]),_:1}),s(o,{cols:"12"},{default:t(()=>[s(de,{modelValue:a(l).admin_user_id,"onUpdate:modelValue":r[5]||(r[5]=i=>a(l).admin_user_id=i),items:a(N),"item-title":"name","item-value":"id",label:e.$t("pages.superSites.assignAdmin"),clearable:"","error-messages":a(n).admin_user_id??[]},{item:t(({props:i,item:j})=>[s(me,J(i,{subtitle:j.raw.email||"-"}),null,16,["subtitle"])]),selection:t(({item:i})=>[d("span",null,p(i.raw.name)+" - "+p(i.raw.email||"-"),1)]),_:1},8,["modelValue","items","label","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).admin_name,"onUpdate:modelValue":r[6]||(r[6]=i=>a(l).admin_name=i),label:e.$t("pages.superSites.newAdminFullName"),rules:F,"error-messages":a(n).admin_name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).admin_email,"onUpdate:modelValue":r[7]||(r[7]=i=>a(l).admin_email=i),type:"email",label:e.$t("pages.superSites.newAdminEmail"),rules:M,"error-messages":a(n).admin_email??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).admin_password,"onUpdate:modelValue":r[8]||(r[8]=i=>a(l).admin_password=i),type:"password",label:e.$t("pages.superSites.newAdminPassword"),rules:P,"error-messages":a(n).admin_password??[]},null,8,["modelValue","label","error-messages"])]),_:1}),s(o,{cols:"12",md:"6"},{default:t(()=>[s(f,{modelValue:a(l).admin_password_confirmation,"onUpdate:modelValue":r[9]||(r[9]=i=>a(l).admin_password_confirmation=i),type:"password",label:"Şifre Tekrar",rules:q,"error-messages":a(n).admin_password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),s(o,{cols:"12"},{default:t(()=>[d("div",ve,[s(g,{variant:"outlined",to:"/super/sites"},{default:t(()=>[v(p(e.$t("common.cancel")),1)]),_:1}),s(g,{color:"primary",type:"submit",loading:a(_),disabled:a(_)},{default:t(()=>[v(p(e.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{ze as default};
