import{j as oe,f as se,h as i,D as ne,Q as b,R as K,S as o,Z as ie,ac as ue,q as l,y as n,O as p,a8 as c,u as e,ad as N,ag as M,V as x,F as de,ab as me}from"./vendor-DfCbaU-T.js";import{$ as w,T as k,x as R,q as pe,U as O}from"./main-Btr01hqQ.js";import{a as fe}from"./formatters-BEv4aA23.js";import{V as j,r as g,e as ve,a as ce,m as ge,b as ye}from"./VForm-D0fBkA3g.js";import{V as S,a as u}from"./VRow-CRn_xzm0.js";import{V as _e}from"./VAlert-R8JWKysv.js";import{V as q,a as Ve}from"./VCard-BmPLTxO3.js";import{V as z}from"./VCardText-H2SttjXr.js";import{V as v}from"./VTextField-pVQuWnMO.js";import{V as A}from"./VSelect-DhbvR9Z1.js";import{V as be}from"./VTable-5XBH4x9y.js";import{V as we}from"./VChip-DOrTqiUh.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";const ke={class:"d-flex align-center justify-space-between mb-2"},Re={class:"text-h4 mb-1"},he={class:"text-medium-emphasis mb-0"},$e={class:"d-flex gap-2"},Te={class:"d-flex justify-end"},Ce={class:"text-right"},De={key:0},Ge=oe({__name:"edit",setup(Ee){const P=ie(),Q=ue(),y=se(()=>Number(P.params.id)),h=i(!1),_=i(!1),$=i(!1),T=i(!1),C=i(null),d=i(""),f=i({}),V=i({}),F=i([]),D=i([]),B=i([]),U=i([]),s=i({name:"",email:"",phone:"",tc_kimlik:"",password:"",password_confirmation:"",role:"owner"}),L=i(null),m=i({apartment_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),I=i(null),Y=[g()],Z=[g(),ve()],G=[t=>typeof t!="string"||t.length===0?!0:ce(11)(t)],H=[t=>typeof t!="string"||t.length===0?!0:ge(8)(t)],J=[t=>s.value.password?g("Şifre tekrar zorunludur.")(t):!0,t=>s.value.password?ye(()=>s.value.password,"Şifreler eşleşmiyor.")(t):!0],W=[g()],X=[g()],ee=[g()],E=async()=>{h.value=!0,d.value="";try{const t=await w(`/users/${y.value}`),a=t.data;s.value={name:a.name,email:a.email??"",phone:a.phone??"",tc_kimlik:a.tc_kimlik??"",password:"",password_confirmation:"",role:a.role??"owner"},U.value=a.apartments,B.value=t.meta.available_apartments,F.value=t.meta.roles,D.value=t.meta.relation_types,D.value.some(r=>r.value===m.value.relation_type)||(m.value.relation_type=D.value[0]?.value??"owner")}catch(t){d.value=k(t,"Kullanıcı detayı alınamadı.")}finally{h.value=!1}},ae=async()=>{if(!(await L.value?.validate())?.valid)return;_.value=!0,d.value="",f.value={};const a={name:s.value.name,email:s.value.email,phone:s.value.phone||null,tc_kimlik:s.value.tc_kimlik||null,role:s.value.role};s.value.password&&(a.password=s.value.password,a.password_confirmation=s.value.password_confirmation);try{await w(`/users/${y.value}`,{method:"PUT",body:a}),await E()}catch(r){d.value=k(r,"Kullanıcı güncellenemedi."),f.value=O(r)}finally{_.value=!1}},le=async()=>{$.value=!0,d.value="";try{await w(`/users/${y.value}`,{method:"DELETE"}),await Q.push("/management/users")}catch(t){d.value=k(t,"Kullanıcı silinemedi.")}finally{$.value=!1}},te=async()=>{if((await I.value?.validate())?.valid){T.value=!0,d.value="",V.value={};try{await w(`/users/${y.value}/apartments`,{method:"POST",body:{apartment_id:m.value.apartment_id,relation_type:m.value.relation_type,start_date:m.value.start_date||null}}),m.value.apartment_id=null,await E()}catch(a){d.value=k(a,"Daire ilişkisi eklenemedi."),V.value=O(a)}finally{T.value=!1}}},re=async t=>{C.value=t,d.value="";try{await w(`/users/${y.value}/apartments/${t}`,{method:"DELETE"}),await E()}catch(a){d.value=k(a,"Daire ilişkisi kaldırılamadı.")}finally{C.value=null}};return ne(E),(t,a)=>(b(),K(S,null,{default:o(()=>[l(u,{cols:"12"},{default:o(()=>[n("div",ke,[n("div",null,[n("h4",Re,p(t.$t("pages.users.editTitle")),1),n("p",he,p(t.$t("pages.users.editSubtitle")),1)]),n("div",$e,[l(R,{variant:"outlined",to:"/management/users"},{default:o(()=>[...a[10]||(a[10]=[c(" Listeye Don ",-1)])]),_:1}),l(R,{color:"error",variant:"outlined",loading:e($),disabled:e($),onClick:le},{default:o(()=>[...a[11]||(a[11]=[c(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(d)?(b(),K(u,{key:0,cols:"12"},{default:o(()=>[l(_e,{type:"error",variant:"tonal"},{default:o(()=>[c(p(e(d)),1)]),_:1})]),_:1})):N("",!0),l(u,{cols:"12"},{default:o(()=>[l(q,{loading:e(h)||e(_)},{default:o(()=>[l(z,null,{default:o(()=>[l(j,{ref_key:"formRef",ref:L,onSubmit:M(ae,["prevent"])},{default:o(()=>[l(S,null,{default:o(()=>[l(u,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:e(s).name,"onUpdate:modelValue":a[0]||(a[0]=r=>e(s).name=r),label:"Ad Soyad",rules:Y,"error-messages":e(f).name??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:e(s).email,"onUpdate:modelValue":a[1]||(a[1]=r=>e(s).email=r),type:"email",label:"E-posta",rules:Z,"error-messages":e(f).email??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:e(s).phone,"onUpdate:modelValue":a[2]||(a[2]=r=>e(s).phone=r),label:"Telefon","error-messages":e(f).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"6"},{default:o(()=>[l(v,{modelValue:e(s).tc_kimlik,"onUpdate:modelValue":a[3]||(a[3]=r=>e(s).tc_kimlik=r),label:"TC Kimlik",maxlength:"11",rules:G,"error-messages":e(f).tc_kimlik??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(v,{modelValue:e(s).password,"onUpdate:modelValue":a[4]||(a[4]=r=>e(s).password=r),type:"password",label:"Yeni Şifre",rules:H,"error-messages":e(f).password??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(v,{modelValue:e(s).password_confirmation,"onUpdate:modelValue":a[5]||(a[5]=r=>e(s).password_confirmation=r),type:"password",label:"Şifre Tekrar",rules:J,"error-messages":e(f).password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),l(u,{cols:"12",md:"4"},{default:o(()=>[l(A,{modelValue:e(s).role,"onUpdate:modelValue":a[6]||(a[6]=r=>e(s).role=r),items:e(F),"item-title":"label","item-value":"value",label:"Rol",rules:W,"error-messages":e(f).role??[]},null,8,["modelValue","items","error-messages"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[n("div",Te,[l(R,{color:"primary",type:"submit",loading:e(_),disabled:e(_)},{default:o(()=>[c(p(t.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1}),l(u,{cols:"12"},{default:o(()=>[l(q,{loading:e(h)},{default:o(()=>[l(Ve,{title:"Bağlı Daireler"}),l(z,null,{default:o(()=>[l(j,{ref_key:"apartmentFormRef",ref:I,onSubmit:M(te,["prevent"])},{default:o(()=>[l(S,null,{default:o(()=>[l(u,{cols:"12",md:"5"},{default:o(()=>[l(A,{modelValue:e(m).apartment_id,"onUpdate:modelValue":a[7]||(a[7]=r=>e(m).apartment_id=r),items:e(B),"item-title":"label","item-value":"id",label:t.$t("common.apartment"),rules:X,"error-messages":e(V).apartment_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(u,{cols:"12",md:"3"},{default:o(()=>[l(A,{modelValue:e(m).relation_type,"onUpdate:modelValue":a[8]||(a[8]=r=>e(m).relation_type=r),items:e(D),"item-title":"label","item-value":"value",label:t.$t("common.type"),rules:ee,"error-messages":e(V).relation_type??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(u,{cols:"12",md:"2"},{default:o(()=>[l(v,{modelValue:e(m).start_date,"onUpdate:modelValue":a[9]||(a[9]=r=>e(m).start_date=r),type:"date",label:t.$t("common.startDate"),"error-messages":e(V).start_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(u,{cols:"12",md:"2",class:"d-flex align-end"},{default:o(()=>[l(R,{color:"primary",type:"submit",block:"",loading:e(T),disabled:e(T)},{default:o(()=>[...a[12]||(a[12]=[c(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(be,{density:"comfortable"},{default:o(()=>[n("thead",null,[n("tr",null,[n("th",null,p(t.$t("common.apartment")),1),n("th",null,p(t.$t("common.type")),1),n("th",null,p(t.$t("common.startDate")),1),a[13]||(a[13]=n("th",{class:"text-right"}," Islem ",-1))])]),n("tbody",null,[(b(!0),x(de,null,me(e(U),r=>(b(),x("tr",{key:r.id},[n("td",null,p(r.label),1),n("td",null,[l(we,{size:"small",color:r.relation_type==="owner"?"primary":"warning",variant:"tonal"},{default:o(()=>[c(p(r.relation_label),1)]),_:2},1032,["color"])]),n("td",null,p(e(fe)(r.start_date)),1),n("td",Ce,[l(R,{icon:"",size:"small",variant:"text",color:"error",loading:e(C)===r.id,disabled:e(C)===r.id,onClick:Ue=>re(r.id)},{default:o(()=>[l(pe,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),e(U).length===0?(b(),x("tr",De,[...a[14]||(a[14]=[n("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Bağlı daire yok. ",-1)])])):N("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ge as default};
