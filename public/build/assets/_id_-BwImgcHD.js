import{j as Q,f as Z,h as u,D as J,Q as _,R as w,S as a,Z as K,ac as W,q as t,y as o,O as n,u as e,a8 as f,ad as C,V as R,F as X,ab as ee,H as te,ag as ae}from"./vendor-DfCbaU-T.js";import{u as se}from"./useAbortOnUnmount-D2zdVzb9.js";import{$ as k,T as D,x as V,V as oe,U as le}from"./main-Btr01hqQ.js";import{a as T,f as b}from"./formatters-BEv4aA23.js";import{e as ne,b as ie}from"./statusHelpers-DSGXz7Bq.js";import{V as de,r as x,p as me}from"./VForm-D0fBkA3g.js";import{V as S,a as m}from"./VRow-CRn_xzm0.js";import{V as re}from"./VAlert-R8JWKysv.js";import{V as A,a as ue,d as pe}from"./VCard-BmPLTxO3.js";import{V as B}from"./VCardText-H2SttjXr.js";import{V as ce}from"./VChip-DOrTqiUh.js";import{V as fe}from"./VTable-5XBH4x9y.js";import{V as ve}from"./VDialog-Ei8l_Al8.js";import{V as M}from"./VTextField-pVQuWnMO.js";import{V as O}from"./VSelect-DhbvR9Z1.js";import{V as _e}from"./VTextarea-DCdZ-5SO.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";const Ve={class:"d-flex align-center justify-space-between mb-2"},he={class:"text-h4 mb-1"},ye={class:"text-medium-emphasis mb-0"},ge={class:"d-flex gap-2"},be={class:"font-weight-medium"},xe={class:"font-weight-medium"},$e={class:"font-weight-medium"},we={class:"text-caption text-medium-emphasis"},Ce={class:"text-h6"},Re={class:"text-caption text-medium-emphasis"},ke={class:"text-h6 text-success"},De={class:"text-caption text-medium-emphasis"},Te={class:"text-h6 text-error"},Se={class:"text-caption text-medium-emphasis"},Ae={class:"text-right"},Ee={key:0},Fe={colspan:"4",class:"text-center text-medium-emphasis py-6"},st=Q({__name:"[id]",setup(Ue){se();const L=K(),P=W(),$=Z(()=>Number(L.params.id)),h=u(!1),y=u(!1),g=u(!1),p=u(""),d=u(null),E=u([]),F=u([]),v=u(!1),c=u({}),r=u({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),U=u(null),G=[x()],H=[x()],I=[x()],j=[x(),me()],N=async()=>{h.value=!0,p.value="";try{const l=await k(`/expenses/${$.value}`);d.value=l.data,E.value=l.meta.cash_accounts,F.value=l.meta.payment_methods}catch(l){p.value=D(l,"Gider detayı alınamadı.")}finally{h.value=!1}},q=()=>{c.value={},r.value.amount=d.value?.remaining??null,v.value=!0},z=async()=>{if((await U.value?.validate())?.valid){y.value=!0,p.value="",c.value={};try{await k(`/expenses/${$.value}/pay`,{method:"POST",body:{paid_at:r.value.paid_at,method:r.value.method,cash_account_id:r.value.cash_account_id,amount:r.value.amount,description:r.value.description||null}}),v.value=!1,await N()}catch(s){p.value=D(s,"Ödeme işlemi başarısız."),c.value=le(s)}finally{y.value=!1}}},Y=async()=>{g.value=!0,p.value="";try{await k(`/expenses/${$.value}`,{method:"DELETE"}),await P.push("/expenses")}catch(l){p.value=D(l,"Gider silinemedi.")}finally{g.value=!1}};return J(N),(l,s)=>(_(),w(S,null,{default:a(()=>[t(m,{cols:"12"},{default:a(()=>[o("div",Ve,[o("div",null,[o("h4",he,n(l.$t("pages.expenses.detailTitle")),1),o("p",ye,n(e(d)?.vendor?.name??l.$t("common.noVendor")),1)]),o("div",ge,[t(V,{variant:"outlined",to:"/expenses"},{default:a(()=>[...s[7]||(s[7]=[f(" Listeye Don ",-1)])]),_:1}),t(V,{color:"success","prepend-icon":"ri-secure-payment-line",disabled:!e(d)||e(d).remaining<=0,onClick:q},{default:a(()=>[...s[8]||(s[8]=[f(" Ödeme Yap ",-1)])]),_:1},8,["disabled"]),t(V,{color:"error",variant:"outlined","prepend-icon":"ri-delete-bin-line",loading:e(g),disabled:e(g),onClick:Y},{default:a(()=>[...s[9]||(s[9]=[f(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(p)?(_(),w(m,{key:0,cols:"12"},{default:a(()=>[t(re,{type:"error",variant:"tonal"},{default:a(()=>[f(n(e(p)),1)]),_:1})]),_:1})):C("",!0),t(m,{cols:"12"},{default:a(()=>[t(A,{loading:e(h)},{default:a(()=>[e(d)?(_(),w(B,{key:0},{default:a(()=>[t(S,null,{default:a(()=>[t(m,{cols:"12",md:"3"},{default:a(()=>[s[10]||(s[10]=o("div",{class:"text-caption text-medium-emphasis"}," Gider Tarihi ",-1)),o("div",be,n(e(T)(e(d).expense_date)),1)]),_:1}),t(m,{cols:"12",md:"3"},{default:a(()=>[s[11]||(s[11]=o("div",{class:"text-caption text-medium-emphasis"}," Vade ",-1)),o("div",xe,n(e(T)(e(d).due_date)),1)]),_:1}),t(m,{cols:"12",md:"3"},{default:a(()=>[s[12]||(s[12]=o("div",{class:"text-caption text-medium-emphasis"}," Hesap ",-1)),o("div",$e,n(e(d).account?.name??"-"),1)]),_:1}),t(m,{cols:"12",md:"3"},{default:a(()=>[s[13]||(s[13]=o("div",{class:"text-caption text-medium-emphasis"}," Durum ",-1)),t(ce,{size:"small",color:e(ne)(e(d).status),variant:"tonal"},{default:a(()=>[f(n(e(ie)(e(d).status)),1)]),_:1},8,["color"])]),_:1}),t(m,{cols:"12",md:"4"},{default:a(()=>[o("div",we,n(l.$t("common.amount")),1),o("div",Ce,n(e(b)(e(d).amount)),1)]),_:1}),t(m,{cols:"12",md:"4"},{default:a(()=>[o("div",Re,n(l.$t("common.paid")),1),o("div",ke,n(e(b)(e(d).paid_amount)),1)]),_:1}),t(m,{cols:"12",md:"4"},{default:a(()=>[o("div",De,n(l.$t("common.remaining")),1),o("div",Te,n(e(b)(e(d).remaining)),1)]),_:1}),t(m,{cols:"12"},{default:a(()=>[o("div",Se,n(l.$t("common.description")),1),o("div",null,n(e(d).description||"-"),1)]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1},8,["loading"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(A,{loading:e(h)},{default:a(()=>[t(ue,{title:"Ödeme Hareketleri"}),t(fe,{density:"comfortable"},{default:a(()=>[o("thead",null,[o("tr",null,[o("th",null,n(l.$t("common.date")),1),o("th",null,n(l.$t("common.method")),1),o("th",null,n(l.$t("common.cashAccount")),1),s[14]||(s[14]=o("th",{class:"text-right"}," Tutar ",-1))])]),o("tbody",null,[(_(!0),R(X,null,ee(e(d)?.payment_items??[],i=>(_(),R("tr",{key:i.id},[o("td",null,n(e(T)(i.payment?.paid_at??"")),1),o("td",null,n(i.payment?.method??"-"),1),o("td",null,n(i.payment?.cash_account?.name??"-"),1),o("td",Ae,n(e(b)(i.amount)),1)]))),128)),(e(d)?.payment_items??[]).length===0?(_(),R("tr",Ee,[o("td",Fe,n(l.$t("common.noPaymentRecords")),1)])):C("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),t(ve,{modelValue:e(v),"onUpdate:modelValue":s[6]||(s[6]=i=>te(v)?v.value=i:null),"max-width":"560"},{default:a(()=>[t(A,{title:"Ödeme Yap"},{default:a(()=>[t(B,null,{default:a(()=>[t(de,{ref_key:"payFormRef",ref:U,onSubmit:ae(z,["prevent"])},{default:a(()=>[t(S,null,{default:a(()=>[t(m,{cols:"12",md:"6"},{default:a(()=>[t(M,{modelValue:e(r).paid_at,"onUpdate:modelValue":s[0]||(s[0]=i=>e(r).paid_at=i),type:"date",label:l.$t("common.paymentDate"),rules:G,"error-messages":e(c).paid_at??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(m,{cols:"12",md:"6"},{default:a(()=>[t(O,{modelValue:e(r).method,"onUpdate:modelValue":s[1]||(s[1]=i=>e(r).method=i),items:e(F),"item-title":"label","item-value":"value",label:l.$t("common.method"),rules:H,"error-messages":e(c).method??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(O,{modelValue:e(r).cash_account_id,"onUpdate:modelValue":s[2]||(s[2]=i=>e(r).cash_account_id=i),items:e(E),"item-title":"name","item-value":"id",label:l.$t("common.cashAccount"),rules:I,"error-messages":e(c).cash_account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(M,{modelValue:e(r).amount,"onUpdate:modelValue":s[3]||(s[3]=i=>e(r).amount=i),type:"number",step:"0.01",min:"0",label:l.$t("common.amount"),rules:j,"error-messages":e(c).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(m,{cols:"12"},{default:a(()=>[t(_e,{modelValue:e(r).description,"onUpdate:modelValue":s[4]||(s[4]=i=>e(r).description=i),label:l.$t("common.description"),rows:"2","error-messages":e(c).description??[]},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(pe,{class:"px-6 pb-4"},{default:a(()=>[t(oe),t(V,{variant:"outlined",onClick:s[5]||(s[5]=i=>v.value=!1)},{default:a(()=>[f(n(l.$t("common.cancel")),1)]),_:1}),t(V,{color:"primary",type:"submit",loading:e(y),disabled:e(y)},{default:a(()=>[...s[15]||(s[15]=[f(" Ode ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{st as default};
