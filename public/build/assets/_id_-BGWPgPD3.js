import{j as K,f as W,h as m,D as X,Q as v,R as C,S as l,Z as Y,ac as ee,q as a,y as o,O as i,u as e,a8 as f,ad as T,V as w,F as te,ab as ae,H as le,ag as oe}from"./vendor-DfCbaU-T.js";import{$ as A,T as R,x as _,V as se,U as ie}from"./main-Btr01hqQ.js";import{u as ne,i as D}from"./useAbortOnUnmount-D2zdVzb9.js";import{a as M,f as y}from"./formatters-BEv4aA23.js";import{c as re,a as de}from"./statusHelpers-DSGXz7Bq.js";import{V as ue,r as x,p as me}from"./VForm-D0fBkA3g.js";import{V as S,a as d}from"./VRow-CRn_xzm0.js";import{V as ce}from"./VAlert-R8JWKysv.js";import{V as E,a as pe,d as fe}from"./VCard-BmPLTxO3.js";import{V as L}from"./VCardText-H2SttjXr.js";import{V as he}from"./VChip-DOrTqiUh.js";import{V as ve}from"./VTable-5XBH4x9y.js";import{V as _e}from"./VDialog-Ei8l_Al8.js";import{V as O}from"./VTextField-pVQuWnMO.js";import{V as H}from"./VSelect-DhbvR9Z1.js";import{V as ge}from"./VTextarea-DCdZ-5SO.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";const Ve={class:"d-flex align-center justify-space-between mb-2"},be={class:"text-h4 mb-1"},ye={class:"text-medium-emphasis mb-0"},xe={class:"d-flex gap-2"},$e={class:"font-weight-medium"},ke={class:"font-weight-medium"},Ce={class:"font-weight-medium"},Te={class:"text-caption text-medium-emphasis"},we={class:"text-h6"},Ae={class:"text-caption text-medium-emphasis"},Re={class:"text-h6 text-success"},De={class:"text-caption text-medium-emphasis"},Se={class:"text-h6 text-error"},Ee={class:"text-caption text-medium-emphasis"},Fe={class:"text-right"},Ue={key:0},Ne={colspan:"5",class:"text-center text-medium-emphasis py-6"},st=K({__name:"[id]",setup(Be){const{withAbort:$}=ne(),I=Y(),j=ee(),k=W(()=>Number(I.params.id)),g=m(!1),V=m(!1),b=m(!1),c=m(""),r=m(null),F=m([]),U=m([]),h=m(!1),p=m({}),u=m({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),N=m(null),q=[x()],z=[x()],P=[x()],Q=[x(),me()],B=async()=>{g.value=!0,c.value="";try{const s=await $(t=>A(`/charges/${k.value}`,{signal:t}));r.value=s.data,F.value=s.meta.cash_accounts,U.value=s.meta.payment_methods}catch(s){if(D(s))return;c.value=R(s,"Tahakkuk detayı alınamadı.")}finally{g.value=!1}},Z=()=>{p.value={},u.value.amount=r.value?.remaining??null,h.value=!0},G=async()=>{if((await N.value?.validate())?.valid){V.value=!0,c.value="",p.value={};try{await $(t=>A(`/charges/${k.value}/collect`,{method:"POST",body:{paid_at:u.value.paid_at,method:u.value.method,cash_account_id:u.value.cash_account_id,amount:u.value.amount,description:u.value.description||null},signal:t})),h.value=!1,await B()}catch(t){if(D(t))return;c.value=R(t,"Tahsilat işlemi başarısız."),p.value=ie(t)}finally{V.value=!1}}},J=async()=>{b.value=!0,c.value="";try{await $(s=>A(`/charges/${k.value}`,{method:"DELETE",signal:s})),await j.push("/charges")}catch(s){if(D(s))return;c.value=R(s,"Tahakkuk silinemedi.")}finally{b.value=!1}};return X(B),(s,t)=>(v(),C(S,null,{default:l(()=>[a(d,{cols:"12"},{default:l(()=>[o("div",Ve,[o("div",null,[o("h4",be,i(s.$t("pages.charges.detailTitle")),1),o("p",ye,i(e(r)?.apartment?.label??"-"),1)]),o("div",xe,[a(_,{variant:"outlined",to:"/charges"},{default:l(()=>[...t[7]||(t[7]=[f(" Listeye Don ",-1)])]),_:1}),a(_,{color:"success","prepend-icon":"ri-hand-coin-line",disabled:!e(r)||e(r).remaining<=0,onClick:Z},{default:l(()=>[...t[8]||(t[8]=[f(" Tahsilat Al ",-1)])]),_:1},8,["disabled"]),a(_,{color:"error",variant:"outlined","prepend-icon":"ri-delete-bin-line",loading:e(b),disabled:e(b),onClick:J},{default:l(()=>[...t[9]||(t[9]=[f(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(c)?(v(),C(d,{key:0,cols:"12"},{default:l(()=>[a(ce,{type:"error",variant:"tonal"},{default:l(()=>[f(i(e(c)),1)]),_:1})]),_:1})):T("",!0),a(d,{cols:"12"},{default:l(()=>[a(E,{loading:e(g)},{default:l(()=>[e(r)?(v(),C(L,{key:0},{default:l(()=>[a(S,null,{default:l(()=>[a(d,{cols:"12",md:"3"},{default:l(()=>[t[10]||(t[10]=o("div",{class:"text-caption text-medium-emphasis"}," Dönem ",-1)),o("div",$e,i(e(r).period),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:l(()=>[t[11]||(t[11]=o("div",{class:"text-caption text-medium-emphasis"}," Vade ",-1)),o("div",ke,i(e(M)(e(r).due_date)),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:l(()=>[t[12]||(t[12]=o("div",{class:"text-caption text-medium-emphasis"}," Hesap ",-1)),o("div",Ce,i(e(r).account?.name??"-"),1)]),_:1}),a(d,{cols:"12",md:"3"},{default:l(()=>[t[13]||(t[13]=o("div",{class:"text-caption text-medium-emphasis"}," Durum ",-1)),a(he,{size:"small",color:e(re)(e(r).status),variant:"tonal"},{default:l(()=>[f(i(e(de)(e(r).status)),1)]),_:1},8,["color"])]),_:1}),a(d,{cols:"12",md:"4"},{default:l(()=>[o("div",Te,i(s.$t("common.amount")),1),o("div",we,i(e(y)(e(r).amount)),1)]),_:1}),a(d,{cols:"12",md:"4"},{default:l(()=>[o("div",Ae,i(s.$t("common.paid")),1),o("div",Re,i(e(y)(e(r).paid_amount)),1)]),_:1}),a(d,{cols:"12",md:"4"},{default:l(()=>[o("div",De,i(s.$t("common.remaining")),1),o("div",Se,i(e(y)(e(r).remaining)),1)]),_:1}),a(d,{cols:"12"},{default:l(()=>[o("div",Ee,i(s.$t("common.description")),1),o("div",null,i(e(r).description||"-"),1)]),_:1})]),_:1})]),_:1})):T("",!0)]),_:1},8,["loading"])]),_:1}),a(d,{cols:"12"},{default:l(()=>[a(E,{loading:e(g)},{default:l(()=>[a(pe,{title:"Tahsilat Hareketleri"}),a(ve,{density:"comfortable"},{default:l(()=>[o("thead",null,[o("tr",null,[o("th",null,i(s.$t("common.receiptNo")),1),o("th",null,i(s.$t("common.date")),1),o("th",null,i(s.$t("common.method")),1),o("th",null,i(s.$t("common.cashAccount")),1),t[14]||(t[14]=o("th",{class:"text-right"}," Tutar ",-1))])]),o("tbody",null,[(v(!0),w(te,null,ae(e(r)?.receipt_items??[],n=>(v(),w("tr",{key:n.id},[o("td",null,i(n.receipt?.receipt_no??"-"),1),o("td",null,i(e(M)(n.receipt?.paid_at??"")),1),o("td",null,i(n.receipt?.method??"-"),1),o("td",null,i(n.receipt?.cash_account?.name??"-"),1),o("td",Fe,i(e(y)(n.amount)),1)]))),128)),(e(r)?.receipt_items??[]).length===0?(v(),w("tr",Ue,[o("td",Ne,i(s.$t("common.noCollectionRecords")),1)])):T("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),a(_e,{modelValue:e(h),"onUpdate:modelValue":t[6]||(t[6]=n=>le(h)?h.value=n:null),"max-width":"560"},{default:l(()=>[a(E,{title:"Tahsilat Al"},{default:l(()=>[a(L,null,{default:l(()=>[a(ue,{ref_key:"collectFormRef",ref:N,onSubmit:oe(G,["prevent"])},{default:l(()=>[a(S,null,{default:l(()=>[a(d,{cols:"12",md:"6"},{default:l(()=>[a(O,{modelValue:e(u).paid_at,"onUpdate:modelValue":t[0]||(t[0]=n=>e(u).paid_at=n),type:"date",label:s.$t("common.collectionDate"),rules:q,"error-messages":e(p).paid_at??[]},null,8,["modelValue","label","error-messages"])]),_:1}),a(d,{cols:"12",md:"6"},{default:l(()=>[a(H,{modelValue:e(u).method,"onUpdate:modelValue":t[1]||(t[1]=n=>e(u).method=n),items:e(U),"item-title":"label","item-value":"value",label:s.$t("common.method"),rules:z,"error-messages":e(p).method??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(d,{cols:"12"},{default:l(()=>[a(H,{modelValue:e(u).cash_account_id,"onUpdate:modelValue":t[2]||(t[2]=n=>e(u).cash_account_id=n),items:e(F),"item-title":"name","item-value":"id",label:s.$t("common.cashAccount"),rules:P,"error-messages":e(p).cash_account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(d,{cols:"12"},{default:l(()=>[a(O,{modelValue:e(u).amount,"onUpdate:modelValue":t[3]||(t[3]=n=>e(u).amount=n),type:"number",step:"0.01",min:"0",label:s.$t("common.amount"),rules:Q,"error-messages":e(p).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),a(d,{cols:"12"},{default:l(()=>[a(ge,{modelValue:e(u).description,"onUpdate:modelValue":t[4]||(t[4]=n=>e(u).description=n),label:s.$t("common.description"),rows:"2","error-messages":e(p).description??[]},null,8,["modelValue","label","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(fe,{class:"px-6 pb-4"},{default:l(()=>[a(se),a(_,{variant:"outlined",onClick:t[5]||(t[5]=n=>h.value=!1)},{default:l(()=>[f(i(s.$t("common.cancel")),1)]),_:1}),a(_,{color:"primary",type:"submit",loading:e(V),disabled:e(V)},{default:l(()=>[...t[15]||(t[15]=[f(" Tahsil Et ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{st as default};
