import{j as J,f as W,h as m,D as X,Q as p,R as T,S as t,Z as Y,q as e,y as a,O as r,u as s,a8 as d,ad as x,ag as tt,V as _,F as L,ab as U}from"./vendor-DfCbaU-T.js";import{$ as D,T as R,x as b,q as z,U as et}from"./main-Btr01hqQ.js";import{a as N,f as A}from"./formatters-BEv4aA23.js";import{c as lt,a as at}from"./statusHelpers-DSGXz7Bq.js";import{V as st,r as M}from"./VForm-D0fBkA3g.js";import{u as ot}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as O,a as f}from"./VRow-CRn_xzm0.js";import{V as rt}from"./VAlert-R8JWKysv.js";import{V as C,a as E}from"./VCard-BmPLTxO3.js";import{V as q}from"./VCardText-H2SttjXr.js";import{V as nt,a as y,b as c}from"./VList-BYpc2SqC.js";import{V as F}from"./VChip-DOrTqiUh.js";import{V as j}from"./VSelect-DhbvR9Z1.js";import{V as it}from"./VTextField-pVQuWnMO.js";import{V as K}from"./VTable-5XBH4x9y.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";const dt={class:"d-flex align-center justify-space-between mb-2"},ut={class:"text-h4 mb-1"},mt={class:"text-medium-emphasis mb-0"},pt={class:"d-flex gap-2"},ft={class:"font-weight-medium"},vt={class:"text-caption text-medium-emphasis"},_t={class:"text-right"},yt={key:0},ct={class:"text-right"},gt={class:"text-right"},Vt={class:"text-right"},bt={key:0},jt=J({__name:"[id]",setup(kt){const P=Y(),k=W(()=>Number(P.params.id));ot();const g=m(!1),$=m(!1),h=m(null),v=m(""),V=m({}),i=m(null),I=m([]),w=m([]),u=m({user_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),B=m(null),Q=[M()],Z=[M()],S=async()=>{g.value=!0,v.value="";try{const n=await D(`/apartments/${k.value}`);i.value=n.data,I.value=n.meta.available_users,w.value=n.meta.relation_types,w.value.some(l=>l.value===u.value.relation_type)||(u.value.relation_type=w.value[0]?.value??"owner")}catch(n){v.value=R(n,"Daire detayı alınamadı.")}finally{g.value=!1}},G=async()=>{if((await B.value?.validate())?.valid){$.value=!0,v.value="",V.value={};try{await D(`/apartments/${k.value}/residents`,{method:"POST",body:{user_id:u.value.user_id,relation_type:u.value.relation_type,start_date:u.value.start_date||null}}),u.value.user_id=null,await S()}catch(l){v.value=R(l,"Sakin eklenemedi."),V.value=et(l)}finally{$.value=!1}}},H=async n=>{h.value=n,v.value="";try{await D(`/apartments/${k.value}/residents/${n}`,{method:"DELETE"}),await S()}catch(l){v.value=R(l,"Sakin kaldırılamadı.")}finally{h.value=null}};return X(S),(n,l)=>(p(),T(O,null,{default:t(()=>[e(f,{cols:"12"},{default:t(()=>[a("div",dt,[a("div",null,[a("h4",ut,r(n.$t("pages.apartments.detailTitle")),1),a("p",mt,r(s(i)?.full_label??"-"),1)]),a("div",pt,[e(b,{variant:"outlined",to:"/management/apartments"},{default:t(()=>[...l[3]||(l[3]=[d(" Listeye Don ",-1)])]),_:1}),e(b,{color:"primary",to:`/management/apartments/${s(k)}/edit`},{default:t(()=>[...l[4]||(l[4]=[d(" Düzenle ",-1)])]),_:1},8,["to"])])])]),_:1}),s(v)?(p(),T(f,{key:0,cols:"12"},{default:t(()=>[e(rt,{type:"error",variant:"tonal"},{default:t(()=>[d(r(s(v)),1)]),_:1})]),_:1})):x("",!0),e(f,{cols:"12",md:"4"},{default:t(()=>[e(C,{loading:s(g)},{default:t(()=>[e(E,{title:"Daire Bilgileri"}),s(i)?(p(),T(q,{key:0},{default:t(()=>[e(nt,{class:"card-list"},{default:t(()=>[e(y,null,{append:t(()=>[a("span",null,r(s(i).block||"-"),1)]),default:t(()=>[e(c,null,{default:t(()=>[...l[5]||(l[5]=[d("Blok",-1)])]),_:1})]),_:1}),e(y,null,{append:t(()=>[a("span",null,r(s(i).floor),1)]),default:t(()=>[e(c,null,{default:t(()=>[...l[6]||(l[6]=[d("Kat",-1)])]),_:1})]),_:1}),e(y,null,{append:t(()=>[a("span",null,r(s(i).number),1)]),default:t(()=>[e(c,null,{default:t(()=>[...l[7]||(l[7]=[d("No",-1)])]),_:1})]),_:1}),e(y,null,{append:t(()=>[a("span",null,r(s(i).m2??"-"),1)]),default:t(()=>[e(c,null,{default:t(()=>[...l[8]||(l[8]=[d("m2",-1)])]),_:1})]),_:1}),e(y,null,{append:t(()=>[a("span",null,r(s(i).arsa_payi??"-"),1)]),default:t(()=>[e(c,null,{default:t(()=>[d(r(n.$t("common.landShare")),1)]),_:1})]),_:1}),e(y,null,{append:t(()=>[e(F,{size:"small",color:s(i).is_active?"success":"secondary",variant:"tonal"},{default:t(()=>[d(r(s(i).is_active?n.$t("common.active"):n.$t("common.passive")),1)]),_:1},8,["color"])]),default:t(()=>[e(c,null,{default:t(()=>[...l[9]||(l[9]=[d("Durum",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0)]),_:1},8,["loading"])]),_:1}),e(f,{cols:"12",md:"8"},{default:t(()=>[e(C,{loading:s(g)},{default:t(()=>[e(E,{title:"Sakinler"}),e(q,null,{default:t(()=>[e(st,{ref_key:"residentFormRef",ref:B,onSubmit:tt(G,["prevent"])},{default:t(()=>[e(O,null,{default:t(()=>[e(f,{cols:"12",md:"5"},{default:t(()=>[e(j,{modelValue:s(u).user_id,"onUpdate:modelValue":l[0]||(l[0]=o=>s(u).user_id=o),items:s(I),"item-title":"name","item-value":"id",label:n.$t("common.user"),rules:Q,"error-messages":s(V).user_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"3"},{default:t(()=>[e(j,{modelValue:s(u).relation_type,"onUpdate:modelValue":l[1]||(l[1]=o=>s(u).relation_type=o),items:s(w),"item-title":"label","item-value":"value",label:n.$t("common.type"),rules:Z,"error-messages":s(V).relation_type??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"2"},{default:t(()=>[e(it,{modelValue:s(u).start_date,"onUpdate:modelValue":l[2]||(l[2]=o=>s(u).start_date=o),type:"date",label:n.$t("common.startDate"),"error-messages":s(V).start_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),e(f,{cols:"12",md:"2",class:"d-flex align-end"},{default:t(()=>[e(b,{color:"primary",type:"submit",block:"",loading:s($),disabled:s($)},{default:t(()=>[...l[10]||(l[10]=[d(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),e(K,{density:"comfortable"},{default:t(()=>[a("thead",null,[a("tr",null,[l[11]||(l[11]=a("th",null,"Ad",-1)),a("th",null,r(n.$t("common.type")),1),a("th",null,r(n.$t("common.startDate")),1),l[12]||(l[12]=a("th",{class:"text-right"}," Islem ",-1))])]),a("tbody",null,[(p(!0),_(L,null,U(s(i)?.users??[],o=>(p(),_("tr",{key:o.id},[a("td",null,[a("div",ft,r(o.name),1),a("div",vt,r(o.email||"-"),1)]),a("td",null,[e(F,{size:"small",color:o.relation_type==="owner"?"primary":"warning",variant:"tonal"},{default:t(()=>[d(r(o.relation_label),1)]),_:2},1032,["color"])]),a("td",null,r(s(N)(o.start_date)),1),a("td",_t,[e(b,{icon:"",size:"small",variant:"text",color:"error",loading:s(h)===o.id,disabled:s(h)===o.id,onClick:$t=>H(o.id)},{default:t(()=>[e(z,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),(s(i)?.users??[]).length===0?(p(),_("tr",yt,[...l[13]||(l[13]=[a("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Sakin kaydı yok. ",-1)])])):x("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),e(f,{cols:"12"},{default:t(()=>[e(C,{loading:s(g)},{default:t(()=>[e(E,{title:"Son Tahakkuklar"}),e(K,{density:"comfortable"},{default:t(()=>[a("thead",null,[a("tr",null,[a("th",null,r(n.$t("common.period")),1),a("th",null,r(n.$t("common.due")),1),l[14]||(l[14]=a("th",{class:"text-right"}," Tutar ",-1)),l[15]||(l[15]=a("th",{class:"text-right"}," Kalan ",-1)),a("th",null,r(n.$t("common.status")),1),l[16]||(l[16]=a("th",{class:"text-right"}," Islem ",-1))])]),a("tbody",null,[(p(!0),_(L,null,U(s(i)?.charges??[],o=>(p(),_("tr",{key:o.id},[a("td",null,r(o.period),1),a("td",null,r(s(N)(o.due_date)),1),a("td",ct,r(s(A)(o.amount)),1),a("td",gt,r(s(A)(o.remaining)),1),a("td",null,[e(F,{size:"small",color:s(lt)(o.status),variant:"tonal"},{default:t(()=>[d(r(s(at)(o.status)),1)]),_:2},1032,["color"])]),a("td",Vt,[e(b,{icon:"",size:"small",variant:"text",to:`/charges/${o.id}`},{default:t(()=>[e(z,{icon:"ri-eye-line"})]),_:1},8,["to"])])]))),128)),(s(i)?.charges??[]).length===0?(p(),_("tr",bt,[...l[17]||(l[17]=[a("td",{colspan:"6",class:"text-center text-medium-emphasis py-6"}," Tahakkuk kaydı yok. ",-1)])])):x("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{jt as default};
