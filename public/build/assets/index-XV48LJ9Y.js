import{j as Re,h as m,f as K,D as je,Q as h,R as I,S as s,a0 as Le,q as a,y as i,a8 as r,u as n,V as N,F as oe,ab as re,O as c,ak as Oe,N as Pe,U as qe,ad as R,H as G,x as Y}from"./vendor-qaEqcc9M.js";import{u as He,i as W}from"./useAbortOnUnmount-B_TyPYrd.js";import{$ as M,T as de,x as u,W as Qe,X as Ge,V as X,q as ue}from"./main-DUODoQpR.js";import{a as Ye,f as me}from"./formatters-BEv4aA23.js";import{V as pe,a as x}from"./VRow-dBMGxjTF.js";import{V as z,d as J}from"./VCard-DEMyauu_.js";import{V as A}from"./VCardText-lEnvPJxp.js";import{V as Z}from"./VTextField-BgtisBQp.js";import{V as ce}from"./VSelect-BpDYXa0x.js";import{V as fe}from"./VAlert-DIbLZTVg.js";import{V as ee}from"./VDialog-8MtGyTgn.js";import{V as We}from"./VTextarea-BWwjO-LJ.js";import{V as Xe}from"./VTable-CDiDVqFm.js";import{V as ve}from"./VCheckboxBtn-B_mUIJHa.js";import{V as Je}from"./VChip-CzUAJTHl.js";import{V as Ze}from"./VPagination-Dp4qKX6V.js";import{_ as et}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VSelectionControl-DtdcpgRj.js";const tt={class:"d-flex align-center justify-space-between flex-wrap gap-3 mb-2"},at={class:"d-flex gap-2 flex-wrap"},lt={class:"d-flex align-center justify-space-between flex-wrap gap-3"},nt={class:"d-flex align-center flex-wrap gap-2"},st={class:"mt-4"},it={class:"text-body-2 text-medium-emphasis"},ot={class:"text-center",style:{width:"50px"}},rt={class:"text-right"},dt={class:"text-center"},ut={class:"font-weight-medium"},mt={class:"text-caption text-medium-emphasis"},pt={class:"text-right"},ct={class:"text-right"},ft={class:"text-right"},vt={key:0},gt={colspan:"8",class:"text-center text-medium-emphasis py-6"},yt={class:"text-sm text-medium-emphasis"},kt=Re({__name:"index",setup(bt){const j=m(!1),L=m(!1),_=m(""),C=m([]),te=m([]),O=m([]),$=m({current_page:1,last_page:1,per_page:15,total:0}),v=m({period:"",apartment_id:null,status:null,search:""}),P=m(!1),o=m([]),y=m(!1),f=m(!1),g=m(""),D=m(!1),S=m(!1),T=m(!1),p=m({charge_type:null,due_date:"",description:""}),{withAbort:U}=He(),ge=[{label:"Ödenen",value:"paid"},{label:"Ödenmeyen",value:"open"},{label:"Geciken",value:"overdue"}],ye=async()=>{L.value=!0;try{const t=await U(e=>M("/charges/meta",{signal:e}));te.value=t.data.apartments,O.value=t.data.charge_types}catch(t){if(W(t))return;_.value=de(t,"Filtre verileri alınamadı.")}finally{L.value=!1}},w=async(t=1)=>{j.value=!0,_.value="";try{const e=await U(d=>M("/charges",{query:{page:t,period:v.value.period||void 0,apartment_id:v.value.apartment_id||void 0,status:v.value.status||void 0,search:v.value.search||void 0},signal:d}));C.value=e.data,$.value=e.meta}catch(e){if(W(e))return;_.value=de(e,"Tahakkuk listesi alınamadı.")}finally{j.value=!1}},q=async()=>{await w(1)},ke=async t=>{v.value.status=v.value.status===t?null:t,await w(1)},be=async()=>{v.value={period:"",apartment_id:null,status:null,search:""},o.value=[],g.value="",await w(1)},ae=t=>v.value.status===t,E=K(()=>C.value.map(t=>t.id)),le=K(()=>E.value.length>0&&E.value.every(t=>o.value.includes(t))),Ve=K(()=>E.value.some(t=>o.value.includes(t))&&!le.value),_e=t=>{if(g.value="",t){const e=new Set([...o.value,...E.value]);o.value=Array.from(e);return}o.value=o.value.filter(e=>!E.value.includes(e))},xe=(t,e)=>{if(g.value="",e){o.value.includes(t)||o.value.push(t);return}o.value=o.value.filter(d=>d!==t)},he=["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],we=t=>/�|Ã.|Ä.|Å./.test(t),Ce=t=>{const e=t.description?.trim()??"";if(e&&!we(e))return e;const[d,l]=t.period.split("-"),k=Number(l)-1,b=he[k]??l??"";return`${d} - ${b} ayı aidatı`},$e=t=>{const e=t.apartment?.label??"-",d=t.debtor?.name??"-";return`${e} - ${d}`},De=t=>t==="paid"?"ri-check-line":t==="overdue"?"ri-alert-line":"ri-alarm-line",Se=t=>t==="paid"?"text-success":t==="overdue"?"text-error":"text-warning",Te=t=>{if(t.status==="paid")return"Ödendi";const e=new Date;e.setHours(0,0,0,0);const d=new Date(`${t.due_date}T00:00:00`),l=Math.floor((d.getTime()-e.getTime())/(1e3*60*60*24));if(t.status==="overdue"){const k=Math.abs(l);return k===0?"Bugün gecikti":`${k} gün gecikti`}return l===0?"Bugün":`${l} gün sonra`},ne=K(()=>o.value.length),H=K(()=>C.value.find(t=>o.value.includes(t.id))??null),se=t=>{const e=t?.trim()??"";return e.length>0?e:null},Be=async t=>{const e=C.value.find(d=>d.id===t);if(e)return e;try{return(await U(l=>M(`/charges/${t}`,{signal:l}))).data}catch(d){return W(d),null}},ie=async t=>{if(o.value.length===0||y.value||f.value)return;const e=o.value.length,d=t==="arsivle"?"arşivlensin":"silinsin";if(window.confirm(`${e} seçili tahakkuk kaydı ${d} mi?`)){y.value=!0,g.value="",_.value="";try{const b=(await Promise.allSettled(o.value.map(B=>U(F=>M(`/charges/${B}`,{method:"DELETE",signal:F}))))).filter(B=>B.status==="fulfilled").length,V=e-b;o.value=[],await w($.value.current_page),b>0&&(g.value=t==="arsivle"?`${b} kayıt arşivlendi.`:`${b} kayıt silindi.`),V>0&&(_.value=`${V} kayıt silinemedi.`)}finally{y.value=!1}}},ze=async()=>{await ie("arsivle")},Ae=async()=>{await ie("sil")},Q=async(t,e)=>{if(!(o.value.length===0||f.value||y.value)){f.value=!0,g.value="",_.value="";try{const l=(await Promise.allSettled(o.value.map(async b=>{const V=await Be(b),B=V?.apartment?.id??null,F=V?.account?.id??null;if(!V||!B||!F)throw new Error("missing-related-data");await U(Ne=>M(`/charges/${b}`,{method:"PUT",body:{apartment_id:B,account_id:F,charge_type:t.charge_type??V.charge_type,period:V.period,due_date:t.due_date??V.due_date,amount:V.amount,description:Object.prototype.hasOwnProperty.call(t,"description")?se(t.description??null):se(V.description)},signal:Ne}))}))).filter(b=>b.status==="fulfilled").length,k=o.value.length-l;o.value=[],await w($.value.current_page),l>0&&(g.value=`${l} kayıt için ${e}`),k>0&&(_.value=`${k} kayıt güncellenemedi.`)}finally{f.value=!1}}},Ue=()=>{g.value="",p.value.charge_type=H.value?.charge_type??O.value[0]?.value??"aidat",D.value=!0},Ee=()=>{g.value="",p.value.due_date=H.value?.due_date??new Date().toISOString().slice(0,10),S.value=!0},Ke=()=>{g.value="",p.value.description=H.value?.description??"",T.value=!0},Me=async()=>{p.value.charge_type&&(await Q({charge_type:p.value.charge_type},"kategori güncellendi."),D.value=!1)},Fe=async()=>{p.value.due_date&&(await Q({due_date:p.value.due_date},"ödeme tarihi güncellendi."),S.value=!1)},Ie=async()=>{await Q({description:p.value.description},"borç açıklaması güncellendi."),T.value=!1};return je(async()=>{await Promise.allSettled([ye(),w(1)])}),(t,e)=>{const d=Le("RouterLink");return h(),I(pe,null,{default:s(()=>[a(x,{cols:"12"},{default:s(()=>[i("div",tt,[e[16]||(e[16]=i("h4",{class:"text-h4 mb-0"}," Aidatlar ",-1)),i("div",at,[a(u,{variant:"outlined",color:"primary",to:"/charges/create"},{default:s(()=>[...e[14]||(e[14]=[r(" Borç Ekle ",-1)])]),_:1}),a(u,{variant:"outlined",color:"primary",to:"/charges/create-bulk"},{default:s(()=>[...e[15]||(e[15]=[r(" Toplu Borç Ekle ",-1)])]),_:1})])])]),_:1}),a(x,{cols:"12"},{default:s(()=>[a(z,{loading:n(L)},{default:s(()=>[a(A,{class:"py-3"},{default:s(()=>[i("div",lt,[i("div",nt,[a(Qe,{divided:""},{default:s(()=>[(h(),N(oe,null,re(ge,l=>a(u,{key:l.value,variant:ae(l.value)?"flat":"outlined",color:ae(l.value)?"primary":void 0,onClick:k=>ke(l.value)},{default:s(()=>[r(c(l.label),1)]),_:2},1032,["variant","color","onClick"])),64))]),_:1}),a(u,{variant:"outlined","prepend-icon":"ri-filter-3-line",onClick:e[0]||(e[0]=l=>P.value=!n(P))},{default:s(()=>[...e[17]||(e[17]=[r(" Süz ",-1)])]),_:1})]),a(Z,{modelValue:n(v).search,"onUpdate:modelValue":e[1]||(e[1]=l=>n(v).search=l),class:"aidat-search",label:"Hesap ara","prepend-inner-icon":"ri-search-line",clearable:"","hide-details":"",onKeyup:Oe(q,["enter"]),"onClick:clear":q},null,8,["modelValue"])]),a(Ge,null,{default:s(()=>[Pe(i("div",st,[a(pe,null,{default:s(()=>[a(x,{cols:"12",md:"3"},{default:s(()=>[a(Z,{modelValue:n(v).period,"onUpdate:modelValue":e[2]||(e[2]=l=>n(v).period=l),type:"month",label:t.$t("common.period"),"hide-details":""},null,8,["modelValue","label"])]),_:1}),a(x,{cols:"12",md:"4"},{default:s(()=>[a(ce,{modelValue:n(v).apartment_id,"onUpdate:modelValue":e[3]||(e[3]=l=>n(v).apartment_id=l),items:n(te),"item-title":"label","item-value":"id",label:t.$t("common.apartment"),"hide-details":"",clearable:""},null,8,["modelValue","items","label"])]),_:1}),a(x,{cols:"12",md:"5",class:"d-flex align-end justify-end gap-2"},{default:s(()=>[a(u,{variant:"outlined",onClick:be},{default:s(()=>[r(c(t.$t("common.clear")),1)]),_:1}),a(u,{color:"primary",onClick:q},{default:s(()=>[r(c(t.$t("common.filter")),1)]),_:1})]),_:1})]),_:1})],512),[[qe,n(P)]])]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),n(ne)>0?(h(),I(x,{key:0,cols:"12"},{default:s(()=>[a(z,null,{default:s(()=>[a(A,{class:"d-flex align-center flex-wrap gap-2 py-3"},{default:s(()=>[i("span",it,c(n(ne))+" kayıt seçildi ",1),a(u,{size:"small",variant:"outlined",loading:n(y),disabled:n(y)||n(f),onClick:ze},{default:s(()=>[...e[18]||(e[18]=[r(" Arşivle ",-1)])]),_:1},8,["loading","disabled"]),a(u,{size:"small",variant:"outlined",color:"error",loading:n(y),disabled:n(y)||n(f),onClick:Ae},{default:s(()=>[...e[19]||(e[19]=[r(" Sil ",-1)])]),_:1},8,["loading","disabled"]),a(u,{size:"small",variant:"outlined",disabled:n(y)||n(f),onClick:Ue},{default:s(()=>[...e[20]||(e[20]=[r(" Kategori Ekle ",-1)])]),_:1},8,["disabled"]),a(u,{size:"small",variant:"outlined",disabled:n(y)||n(f),onClick:Ee},{default:s(()=>[...e[21]||(e[21]=[r(" Ödeme Tarihini Değiştir ",-1)])]),_:1},8,["disabled"]),a(u,{size:"small",variant:"outlined",disabled:n(y)||n(f),onClick:Ke},{default:s(()=>[...e[22]||(e[22]=[r(" Borç Açıklamalarını Değiştir ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})):R("",!0),n(g)?(h(),I(x,{key:1,cols:"12"},{default:s(()=>[a(fe,{type:"info",variant:"tonal"},{default:s(()=>[r(c(n(g)),1)]),_:1})]),_:1})):R("",!0),a(ee,{modelValue:n(D),"onUpdate:modelValue":e[6]||(e[6]=l=>G(D)?D.value=l:null),"max-width":"460"},{default:s(()=>[a(z,{title:"Kategori Ekle"},{default:s(()=>[a(A,null,{default:s(()=>[a(ce,{modelValue:n(p).charge_type,"onUpdate:modelValue":e[4]||(e[4]=l=>n(p).charge_type=l),items:n(O),"item-title":"label","item-value":"value",label:"Kategori"},null,8,["modelValue","items"])]),_:1}),a(J,{class:"px-6 pb-4"},{default:s(()=>[a(X),a(u,{variant:"outlined",onClick:e[5]||(e[5]=l=>D.value=!1)},{default:s(()=>[...e[23]||(e[23]=[r(" Vazgeç ",-1)])]),_:1}),a(u,{color:"primary",loading:n(f),disabled:n(f)||!n(p).charge_type,onClick:Me},{default:s(()=>[...e[24]||(e[24]=[r(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ee,{modelValue:n(S),"onUpdate:modelValue":e[9]||(e[9]=l=>G(S)?S.value=l:null),"max-width":"460"},{default:s(()=>[a(z,{title:"Ödeme Tarihini Değiştir"},{default:s(()=>[a(A,null,{default:s(()=>[a(Z,{modelValue:n(p).due_date,"onUpdate:modelValue":e[7]||(e[7]=l=>n(p).due_date=l),type:"date",label:"Yeni Ödeme Tarihi"},null,8,["modelValue"])]),_:1}),a(J,{class:"px-6 pb-4"},{default:s(()=>[a(X),a(u,{variant:"outlined",onClick:e[8]||(e[8]=l=>S.value=!1)},{default:s(()=>[...e[25]||(e[25]=[r(" Vazgeç ",-1)])]),_:1}),a(u,{color:"primary",loading:n(f),disabled:n(f)||!n(p).due_date,onClick:Fe},{default:s(()=>[...e[26]||(e[26]=[r(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ee,{modelValue:n(T),"onUpdate:modelValue":e[12]||(e[12]=l=>G(T)?T.value=l:null),"max-width":"560"},{default:s(()=>[a(z,{title:"Borç Açıklamalarını Değiştir"},{default:s(()=>[a(A,null,{default:s(()=>[a(We,{modelValue:n(p).description,"onUpdate:modelValue":e[10]||(e[10]=l=>n(p).description=l),label:"Yeni Açıklama",rows:"3",hint:"Boş bırakırsanız açıklama temizlenir.","persistent-hint":""},null,8,["modelValue"])]),_:1}),a(J,{class:"px-6 pb-4"},{default:s(()=>[a(X),a(u,{variant:"outlined",onClick:e[11]||(e[11]=l=>T.value=!1)},{default:s(()=>[...e[27]||(e[27]=[r(" Vazgeç ",-1)])]),_:1}),a(u,{color:"primary",loading:n(f),disabled:n(f),onClick:Ie},{default:s(()=>[...e[28]||(e[28]=[r(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),n(_)?(h(),I(x,{key:2,cols:"12"},{default:s(()=>[a(fe,{type:"error",variant:"tonal"},{default:s(()=>[r(c(n(_)),1)]),_:1})]),_:1})):R("",!0),a(x,{cols:"12"},{default:s(()=>[a(z,{loading:n(j)},{default:s(()=>[a(Xe,{density:"comfortable"},{default:s(()=>[i("thead",null,[i("tr",null,[i("th",ot,[a(ve,{"model-value":n(le),indeterminate:n(Ve),"onUpdate:modelValue":e[13]||(e[13]=l=>_e(!!l))},null,8,["model-value","indeterminate"])]),e[29]||(e[29]=i("th",null,"Açıklama",-1)),e[30]||(e[30]=i("th",null,"Kategori",-1)),e[31]||(e[31]=i("th",null,"Düzenleme",-1)),e[32]||(e[32]=i("th",null,"Ödeme",-1)),e[33]||(e[33]=i("th",{class:"text-right"}," Toplam ",-1)),e[34]||(e[34]=i("th",{class:"text-right"}," Kalan ",-1)),i("th",rt,c(t.$t("common.actions")),1)])]),i("tbody",null,[(h(!0),N(oe,null,re(n(C),l=>(h(),N("tr",{key:l.id},[i("td",dt,[a(ve,{"model-value":n(o).includes(l.id),"onUpdate:modelValue":k=>xe(l.id,!!k)},null,8,["model-value","onUpdate:modelValue"])]),i("td",null,[i("div",ut,[a(d,{to:`/charges/${l.id}`,class:"text-decoration-none text-primary"},{default:s(()=>[r(c(Ce(l)),1)]),_:2},1032,["to"])]),i("div",mt,c($e(l)),1)]),i("td",null,[a(Je,{size:"small",variant:"tonal",color:l.charge_type==="aidat"?"info":"secondary"},{default:s(()=>[r(c(l.charge_type==="aidat"?"Aidat":"Diğer"),1)]),_:2},1032,["color"])]),i("td",null,c(n(Ye)(l.due_date)),1),i("td",null,[i("div",{class:Y(["d-flex align-center gap-2",Se(l.status)])},[a(ue,{icon:De(l.status),size:"18"},null,8,["icon"]),i("span",null,c(Te(l)),1)],2)]),i("td",pt,[i("span",{class:Y(l.status==="paid"?"text-success":"")},c(n(me)(l.amount)),3)]),i("td",ct,[i("span",{class:Y(l.remaining<=0?"text-success":"text-error")},c(n(me)(l.remaining)),3)]),i("td",ft,[a(u,{icon:"",size:"small",variant:"text",to:`/charges/${l.id}`},{default:s(()=>[a(ue,{icon:"ri-eye-line"})]),_:1},8,["to"])])]))),128)),n(C).length===0?(h(),N("tr",vt,[i("td",gt,c(t.$t("common.noRecords")),1)])):R("",!0)])]),_:1}),a(A,{class:"d-flex justify-space-between align-center flex-wrap gap-3"},{default:s(()=>[i("span",yt,c(t.$t("common.totalRecords",{count:n($).total})),1),a(Ze,{"model-value":n($).current_page,length:n($).last_page,"total-visible":7,"onUpdate:modelValue":w},null,8,["model-value","length"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1})}}}),Lt=et(kt,[["__scopeId","data-v-9c3ac8ed"]]);export{Lt as default};
