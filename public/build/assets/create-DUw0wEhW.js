import{j as h,h as d,f as S,D as H,Q as M,R as N,S as s,Z as L,ac as P,q as l,y as p,O as f,u as e,a8 as _,ag as Q,ad as Z}from"./vendor-qaEqcc9M.js";import{u as z,i as x}from"./useAbortOnUnmount-B_TyPYrd.js";import{$ as w,T as R,x as k,U as J}from"./main-DUODoQpR.js";import{V as W,r as c,p as X}from"./VForm-AfrkaUJk.js";import{V as A,a as n}from"./VRow-dBMGxjTF.js";import{V as ee}from"./VCard-DEMyauu_.js";import{V as ae}from"./VCardText-lEnvPJxp.js";import{V as oe}from"./VAlert-DIbLZTVg.js";import{V as F}from"./VSelect-BpDYXa0x.js";import{V}from"./VTextField-BgtisBQp.js";import{V as te}from"./VTextarea-BWwjO-LJ.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";import"./VChip-CzUAJTHl.js";const le={class:"d-flex align-center justify-space-between mb-2"},se={class:"text-h4 mb-1"},re={class:"text-medium-emphasis mb-0"},ne={class:"d-flex justify-end gap-3"},$e=h({__name:"create",setup(ue){const{withAbort:y}=z(),T=L(),B=P(),m=d(!1),b=d(!1),g=d(!1),i=d(""),u=d({}),v=S(()=>{const t=T.query.copy;return t?Number(t):null}),C=S(()=>v.value!==null),U=d([]),$=d([]),o=d({vendor_id:null,account_id:null,expense_date:"",due_date:"",amount:null,description:"",invoice_no:""}),D=d(null),E=[c()],G=[c()],O=[c()],j=[c()],q=[c(),X()],I=async()=>{b.value=!0;try{const t=await y(a=>w("/expenses/meta",{signal:a}));U.value=t.data.vendors,$.value=t.data.accounts}catch(t){if(x(t))return;i.value=R(t,"Form verileri alınamadı.")}finally{b.value=!1}},K=async()=>{if((await D.value?.validate())?.valid){m.value=!0,i.value="",u.value={};try{await y(a=>w("/expenses",{method:"POST",body:{vendor_id:o.value.vendor_id,account_id:o.value.account_id,expense_date:o.value.expense_date,due_date:o.value.due_date,amount:o.value.amount,description:o.value.description||null,invoice_no:o.value.invoice_no||null},signal:a})),await B.push("/expenses")}catch(a){if(x(a))return;i.value=R(a,"Gider oluşturulamadı."),u.value=J(a)}finally{m.value=!1}}},Y=async()=>{if(v.value){g.value=!0;try{const t=await y(a=>w(`/expenses/${v.value}`,{signal:a}));o.value.vendor_id=t.data.vendor?.id??null,o.value.account_id=t.data.account?.id??null,o.value.expense_date=new Date().toISOString().slice(0,10),o.value.due_date=t.data.due_date,o.value.amount=t.data.amount,o.value.description=t.data.description??""}catch(t){if(x(t))return;i.value=R(t,"Kaynak gider alinamadi.")}finally{g.value=!1}}};return H(async()=>{await I(),v.value&&await Y()}),(t,a)=>(M(),N(A,null,{default:s(()=>[l(n,{cols:"12"},{default:s(()=>[p("div",le,[p("div",null,[p("h4",se,f(e(C)?"Gider Kopyala":"Yeni Gider"),1),p("p",re,f(e(C)?"Mevcut giderden kopyalayarak yeni kayit olusturun":"Yeni bir gider kaydi olusturun"),1)]),l(k,{variant:"outlined",to:"/expenses"},{default:s(()=>[...a[7]||(a[7]=[_(" Listeye Don ",-1)])]),_:1})])]),_:1}),l(n,{cols:"12"},{default:s(()=>[l(ee,{loading:e(b)||e(g)||e(m)},{default:s(()=>[l(ae,null,{default:s(()=>[l(W,{ref_key:"formRef",ref:D,onSubmit:Q(K,["prevent"])},{default:s(()=>[l(A,null,{default:s(()=>[e(i)?(M(),N(n,{key:0,cols:"12"},{default:s(()=>[l(oe,{type:"error",variant:"tonal"},{default:s(()=>[_(f(e(i)),1)]),_:1})]),_:1})):Z("",!0),l(n,{cols:"12",md:"6"},{default:s(()=>[l(F,{modelValue:e(o).vendor_id,"onUpdate:modelValue":a[0]||(a[0]=r=>e(o).vendor_id=r),items:e(U),"item-title":"label","item-value":"id",label:t.$t("common.vendor"),clearable:"",rules:E,"error-messages":e(u).vendor_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(n,{cols:"12",md:"6"},{default:s(()=>[l(F,{modelValue:e(o).account_id,"onUpdate:modelValue":a[1]||(a[1]=r=>e(o).account_id=r),items:e($),"item-title":"label","item-value":"id",label:"Gider Hesabi",rules:G,"error-messages":e(u).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),l(n,{cols:"12",md:"4"},{default:s(()=>[l(V,{modelValue:e(o).expense_date,"onUpdate:modelValue":a[2]||(a[2]=r=>e(o).expense_date=r),type:"date",label:t.$t("common.expenseDate"),rules:O,"error-messages":e(u).expense_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(n,{cols:"12",md:"4"},{default:s(()=>[l(V,{modelValue:e(o).due_date,"onUpdate:modelValue":a[3]||(a[3]=r=>e(o).due_date=r),type:"date",label:t.$t("common.dueDate"),rules:j,"error-messages":e(u).due_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(n,{cols:"12",md:"4"},{default:s(()=>[l(V,{modelValue:e(o).amount,"onUpdate:modelValue":a[4]||(a[4]=r=>e(o).amount=r),type:"number",step:"0.01",min:"0",label:t.$t("common.amount"),rules:q,"error-messages":e(u).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(n,{cols:"12"},{default:s(()=>[l(te,{modelValue:e(o).description,"onUpdate:modelValue":a[5]||(a[5]=r=>e(o).description=r),label:t.$t("common.description"),rows:"3","error-messages":e(u).description??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(n,{cols:"12",md:"6"},{default:s(()=>[l(V,{modelValue:e(o).invoice_no,"onUpdate:modelValue":a[6]||(a[6]=r=>e(o).invoice_no=r),label:"Fatura/Fiş No","error-messages":e(u).invoice_no??[]},null,8,["modelValue","error-messages"])]),_:1}),l(n,{cols:"12"},{default:s(()=>[p("div",ne,[l(k,{variant:"outlined",to:"/expenses"},{default:s(()=>[...a[8]||(a[8]=[_(" Iptal ",-1)])]),_:1}),l(k,{color:"primary",type:"submit",loading:e(m),disabled:e(m)},{default:s(()=>[_(f(t.$t("common.save")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{$e as default};
