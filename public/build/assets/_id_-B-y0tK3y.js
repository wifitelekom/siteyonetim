import{j as J,f as W,h as m,D as X,Q as p,R as S,S as e,Z as Y,q as t,y as a,O as o,u as s,a8 as i,ad as D,ag as ee,V as v,F as A,ab as L}from"./vendor-DfCbaU-T.js";import{$ as R,T as C,x as b,p as U,U as te}from"./main-OjHNd2U9.js";import{a as z,f as N}from"./formatters-BEv4aA23.js";import{c as le,a as ae}from"./statusHelpers-B7BIhNzn.js";import{V as se,r as M}from"./VForm-CtC6ldpE.js";import{u as re}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as O,a as f}from"./VRow-Ba58lXtG.js";import{V as oe}from"./VAlert-DafHPFjN.js";import{V as B,a as $}from"./VCard-9RfFlHpT.js";import{V as K}from"./VCardText-YweTyZzP.js";import{V as ne,a as y,b as c}from"./VList-B1ov9hmg.js";import{V as E}from"./VChip-CnrRRXXG.js";import{V as P}from"./VSelect-CMe3Xagq.js";import{V as ie}from"./VTextField-CMxHKe9w.js";import{V as j}from"./VTable-ByowNMkP.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";const ue={class:"d-flex align-center justify-space-between mb-2"},de={class:"text-medium-emphasis mb-0"},me={class:"d-flex gap-2"},pe={class:"font-weight-medium"},fe={class:"text-caption text-medium-emphasis"},_e={class:"text-right"},ve={key:0},ye={class:"text-right"},ce={class:"text-right"},ge={class:"text-right"},Ve={key:0},Ke=J({__name:"[id]",setup(be){const q=Y(),k=W(()=>Number(q.params.id));re();const g=m(!1),x=m(!1),h=m(null),_=m(""),V=m({}),n=m(null),F=m([]),w=m([]),u=m({user_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),I=m(null),Q=[M()],Z=[M()],T=async()=>{g.value=!0,_.value="";try{const d=await R(`/apartments/${k.value}`);n.value=d.data,F.value=d.meta.available_users,w.value=d.meta.relation_types,w.value.some(l=>l.value===u.value.relation_type)||(u.value.relation_type=w.value[0]?.value??"owner")}catch(d){_.value=C(d,"Daire detayi alinamadi.")}finally{g.value=!1}},G=async()=>{if((await I.value?.validate())?.valid){x.value=!0,_.value="",V.value={};try{await R(`/apartments/${k.value}/residents`,{method:"POST",body:{user_id:u.value.user_id,relation_type:u.value.relation_type,start_date:u.value.start_date||null}}),u.value.user_id=null,await T()}catch(l){_.value=C(l,"Sakin eklenemedi."),V.value=te(l)}finally{x.value=!1}}},H=async d=>{h.value=d,_.value="";try{await R(`/apartments/${k.value}/residents/${d}`,{method:"DELETE"}),await T()}catch(l){_.value=C(l,"Sakin kaldirilamadi.")}finally{h.value=null}};return X(T),(d,l)=>(p(),S(O,null,{default:e(()=>[t(f,{cols:"12"},{default:e(()=>[a("div",ue,[a("div",null,[l[3]||(l[3]=a("h4",{class:"text-h4 mb-1"}," Daire Detayi ",-1)),a("p",de,o(s(n)?.full_label??"-"),1)]),a("div",me,[t(b,{variant:"outlined",to:"/management/apartments"},{default:e(()=>[...l[4]||(l[4]=[i(" Listeye Don ",-1)])]),_:1}),t(b,{color:"primary",to:`/management/apartments/${s(k)}/edit`},{default:e(()=>[...l[5]||(l[5]=[i(" Duzenle ",-1)])]),_:1},8,["to"])])])]),_:1}),s(_)?(p(),S(f,{key:0,cols:"12"},{default:e(()=>[t(oe,{type:"error",variant:"tonal"},{default:e(()=>[i(o(s(_)),1)]),_:1})]),_:1})):D("",!0),t(f,{cols:"12",md:"4"},{default:e(()=>[t(B,{loading:s(g)},{default:e(()=>[t($,{title:"Daire Bilgileri"}),s(n)?(p(),S(K,{key:0},{default:e(()=>[t(ne,{class:"card-list"},{default:e(()=>[t(y,null,{append:e(()=>[a("span",null,o(s(n).block||"-"),1)]),default:e(()=>[t(c,null,{default:e(()=>[...l[6]||(l[6]=[i("Blok",-1)])]),_:1})]),_:1}),t(y,null,{append:e(()=>[a("span",null,o(s(n).floor),1)]),default:e(()=>[t(c,null,{default:e(()=>[...l[7]||(l[7]=[i("Kat",-1)])]),_:1})]),_:1}),t(y,null,{append:e(()=>[a("span",null,o(s(n).number),1)]),default:e(()=>[t(c,null,{default:e(()=>[...l[8]||(l[8]=[i("No",-1)])]),_:1})]),_:1}),t(y,null,{append:e(()=>[a("span",null,o(s(n).m2??"-"),1)]),default:e(()=>[t(c,null,{default:e(()=>[...l[9]||(l[9]=[i("m2",-1)])]),_:1})]),_:1}),t(y,null,{append:e(()=>[a("span",null,o(s(n).arsa_payi??"-"),1)]),default:e(()=>[t(c,null,{default:e(()=>[...l[10]||(l[10]=[i("Arsa Payi",-1)])]),_:1})]),_:1}),t(y,null,{append:e(()=>[t(E,{size:"small",color:s(n).is_active?"success":"secondary",variant:"tonal"},{default:e(()=>[i(o(s(n).is_active?"Aktif":"Pasif"),1)]),_:1},8,["color"])]),default:e(()=>[t(c,null,{default:e(()=>[...l[11]||(l[11]=[i("Durum",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):D("",!0)]),_:1},8,["loading"])]),_:1}),t(f,{cols:"12",md:"8"},{default:e(()=>[t(B,{loading:s(g)},{default:e(()=>[t($,{title:"Sakinler"}),t(K,null,{default:e(()=>[t(se,{ref_key:"residentFormRef",ref:I,onSubmit:ee(G,["prevent"])},{default:e(()=>[t(O,null,{default:e(()=>[t(f,{cols:"12",md:"5"},{default:e(()=>[t(P,{modelValue:s(u).user_id,"onUpdate:modelValue":l[0]||(l[0]=r=>s(u).user_id=r),items:s(F),"item-title":"name","item-value":"id",label:"Kullanici",rules:Q,"error-messages":s(V).user_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(f,{cols:"12",md:"3"},{default:e(()=>[t(P,{modelValue:s(u).relation_type,"onUpdate:modelValue":l[1]||(l[1]=r=>s(u).relation_type=r),items:s(w),"item-title":"label","item-value":"value",label:"Tur",rules:Z,"error-messages":s(V).relation_type??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(f,{cols:"12",md:"2"},{default:e(()=>[t(ie,{modelValue:s(u).start_date,"onUpdate:modelValue":l[2]||(l[2]=r=>s(u).start_date=r),type:"date",label:"Baslangic","error-messages":s(V).start_date??[]},null,8,["modelValue","error-messages"])]),_:1}),t(f,{cols:"12",md:"2",class:"d-flex align-end"},{default:e(()=>[t(b,{color:"primary",type:"submit",block:"",loading:s(x),disabled:s(x)},{default:e(()=>[...l[12]||(l[12]=[i(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),t(j,{density:"comfortable"},{default:e(()=>[l[14]||(l[14]=a("thead",null,[a("tr",null,[a("th",null,"Ad"),a("th",null,"Tur"),a("th",null,"Baslangic"),a("th",{class:"text-right"}," Islem ")])],-1)),a("tbody",null,[(p(!0),v(A,null,L(s(n)?.users??[],r=>(p(),v("tr",{key:r.id},[a("td",null,[a("div",pe,o(r.name),1),a("div",fe,o(r.email||"-"),1)]),a("td",null,[t(E,{size:"small",color:r.relation_type==="owner"?"primary":"warning",variant:"tonal"},{default:e(()=>[i(o(r.relation_label),1)]),_:2},1032,["color"])]),a("td",null,o(s(z)(r.start_date)),1),a("td",_e,[t(b,{icon:"",size:"small",variant:"text",color:"error",loading:s(h)===r.id,disabled:s(h)===r.id,onClick:ke=>H(r.id)},{default:e(()=>[t(U,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),(s(n)?.users??[]).length===0?(p(),v("tr",ve,[...l[13]||(l[13]=[a("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Sakin kaydi yok. ",-1)])])):D("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),t(f,{cols:"12"},{default:e(()=>[t(B,{loading:s(g)},{default:e(()=>[t($,{title:"Son Tahakkuklar"}),t(j,{density:"comfortable"},{default:e(()=>[l[16]||(l[16]=a("thead",null,[a("tr",null,[a("th",null,"Donem"),a("th",null,"Vade"),a("th",{class:"text-right"}," Tutar "),a("th",{class:"text-right"}," Kalan "),a("th",null,"Durum"),a("th",{class:"text-right"}," Islem ")])],-1)),a("tbody",null,[(p(!0),v(A,null,L(s(n)?.charges??[],r=>(p(),v("tr",{key:r.id},[a("td",null,o(r.period),1),a("td",null,o(s(z)(r.due_date)),1),a("td",ye,o(s(N)(r.amount)),1),a("td",ce,o(s(N)(r.remaining)),1),a("td",null,[t(E,{size:"small",color:s(le)(r.status),variant:"tonal"},{default:e(()=>[i(o(s(ae)(r.status)),1)]),_:2},1032,["color"])]),a("td",ge,[t(b,{icon:"",size:"small",variant:"text",to:`/charges/${r.id}`},{default:e(()=>[t(U,{icon:"ri-eye-line"})]),_:1},8,["to"])])]))),128)),(s(n)?.charges??[]).length===0?(p(),v("tr",Ve,[...l[15]||(l[15]=[a("td",{colspan:"6",class:"text-center text-medium-emphasis py-6"}," Tahakkuk kaydi yok. ",-1)])])):D("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ke as default};
