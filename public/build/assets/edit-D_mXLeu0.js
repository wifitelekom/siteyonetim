import{j as H,f as L,h as n,D as Q,Q as $,R as w,S as o,Z,ac as J,q as l,y as p,u as e,a8 as f,ag as K,O as k,ad as A}from"./vendor-qaEqcc9M.js";import{$ as R,T as D,x as _,U as W}from"./main-DUODoQpR.js";import{V as X,r as V,p as Y}from"./VForm-AfrkaUJk.js";import{u as h,i as U}from"./useAbortOnUnmount-B_TyPYrd.js";import{V as G,a as r}from"./VRow-dBMGxjTF.js";import{V as ee}from"./VCard-DEMyauu_.js";import{V as ae}from"./VCardText-lEnvPJxp.js";import{V as B}from"./VAlert-DIbLZTVg.js";import{V as F}from"./VSelect-BpDYXa0x.js";import{V as b}from"./VTextField-BgtisBQp.js";import{V as le}from"./VTextarea-BWwjO-LJ.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";import"./VChip-CzUAJTHl.js";const te={class:"d-flex align-center justify-space-between mb-2"},oe={class:"d-flex gap-2"},se={class:"d-flex justify-end gap-3"},De=H({__name:"edit",setup(de){const S=Z(),E=J(),m=L(()=>Number(S.params.id)),{withAbort:g}=h(),y=n(!1),c=n(!1),v=n(!1),u=n(""),i=n({}),N=n([]),T=n([]),x=n(!1),s=n({vendor_id:null,account_id:null,expense_date:"",due_date:"",amount:null,description:"",invoice_no:""}),C=n(null),M=[V()],j=[V()],z=[V()],q=[V(),Y()],I=async()=>{y.value=!0,u.value="";try{const t=await g(a=>R(`/expenses/${m.value}`,{signal:a}));s.value={vendor_id:t.data.vendor?.id??null,account_id:t.data.account?.id??null,expense_date:t.data.expense_date,due_date:t.data.due_date,amount:t.data.amount,description:t.data.description??"",invoice_no:t.data.invoice_no??""},x.value=t.data.paid_amount>0,N.value=t.meta.vendors,T.value=t.meta.accounts}catch(t){if(U(t))return;u.value=D(t,"Gider bilgileri alinamadi.")}finally{y.value=!1}},O=async()=>{if((await C.value?.validate())?.valid){c.value=!0,u.value="",i.value={};try{await g(a=>R(`/expenses/${m.value}`,{method:"PUT",body:{vendor_id:s.value.vendor_id,account_id:s.value.account_id,expense_date:s.value.expense_date,due_date:s.value.due_date,amount:Number(s.value.amount),description:s.value.description||null,invoice_no:s.value.invoice_no||null},signal:a})),await E.push(`/expenses/${m.value}`)}catch(a){if(U(a))return;u.value=D(a,"Gider guncellenemedi."),i.value=W(a)}finally{c.value=!1}}},P=async()=>{v.value=!0,u.value="";try{await g(t=>R(`/expenses/${m.value}`,{method:"DELETE",signal:t})),await E.push("/expenses")}catch(t){if(U(t))return;u.value=D(t,"Gider silinemedi.")}finally{v.value=!1}};return Q(I),(t,a)=>($(),w(G,null,{default:o(()=>[l(r,{cols:"12"},{default:o(()=>[p("div",te,[a[9]||(a[9]=p("div",null,[p("h4",{class:"text-h4 mb-1"}," Gider Duzenle "),p("p",{class:"text-medium-emphasis mb-0"}," Gider bilgilerini guncelleyin ")],-1)),p("div",oe,[l(_,{variant:"outlined",to:`/expenses/${e(m)}`},{default:o(()=>[...a[7]||(a[7]=[f(" Detaya Don ",-1)])]),_:1},8,["to"]),l(_,{color:"error",variant:"outlined",loading:e(v),disabled:e(v),onClick:P},{default:o(()=>[...a[8]||(a[8]=[f(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(ee,{loading:e(y)||e(c)},{default:o(()=>[l(ae,null,{default:o(()=>[l(X,{ref_key:"formRef",ref:C,onSubmit:K(O,["prevent"])},{default:o(()=>[l(G,null,{default:o(()=>[e(u)?($(),w(r,{key:0,cols:"12"},{default:o(()=>[l(B,{type:"error",variant:"tonal"},{default:o(()=>[f(k(e(u)),1)]),_:1})]),_:1})):A("",!0),e(x)?($(),w(r,{key:1,cols:"12"},{default:o(()=>[l(B,{type:"warning",variant:"tonal"},{default:o(()=>[...a[10]||(a[10]=[f(" Bu giderin odemesi yapilmis. Tutari degistiremezsiniz. ",-1)])]),_:1})]),_:1})):A("",!0),l(r,{cols:"12",md:"6"},{default:o(()=>[l(F,{modelValue:e(s).vendor_id,"onUpdate:modelValue":a[0]||(a[0]=d=>e(s).vendor_id=d),items:e(N),"item-title":"label","item-value":"id",label:t.$t("common.vendor"),clearable:"","error-messages":e(i).vendor_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(r,{cols:"12",md:"6"},{default:o(()=>[l(F,{modelValue:e(s).account_id,"onUpdate:modelValue":a[1]||(a[1]=d=>e(s).account_id=d),items:e(T),"item-title":"label","item-value":"id",label:"Gider Hesabi",rules:M,"error-messages":e(i).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),l(r,{cols:"12",md:"4"},{default:o(()=>[l(b,{modelValue:e(s).expense_date,"onUpdate:modelValue":a[2]||(a[2]=d=>e(s).expense_date=d),type:"date",label:t.$t("common.expenseDate"),rules:j,"error-messages":e(i).expense_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(r,{cols:"12",md:"4"},{default:o(()=>[l(b,{modelValue:e(s).due_date,"onUpdate:modelValue":a[3]||(a[3]=d=>e(s).due_date=d),type:"date",label:t.$t("common.dueDate"),rules:z,"error-messages":e(i).due_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(r,{cols:"12",md:"4"},{default:o(()=>[l(b,{modelValue:e(s).amount,"onUpdate:modelValue":a[4]||(a[4]=d=>e(s).amount=d),type:"number",step:"0.01",min:"0",label:t.$t("common.amount"),rules:q,disabled:e(x),"error-messages":e(i).amount??[]},null,8,["modelValue","label","disabled","error-messages"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[l(le,{modelValue:e(s).description,"onUpdate:modelValue":a[5]||(a[5]=d=>e(s).description=d),label:t.$t("common.description"),rows:"3","error-messages":e(i).description??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(r,{cols:"12",md:"6"},{default:o(()=>[l(b,{modelValue:e(s).invoice_no,"onUpdate:modelValue":a[6]||(a[6]=d=>e(s).invoice_no=d),label:"Fatura/Fis No","error-messages":e(i).invoice_no??[]},null,8,["modelValue","error-messages"])]),_:1}),l(r,{cols:"12"},{default:o(()=>[p("div",se,[l(_,{variant:"outlined",to:`/expenses/${e(m)}`},{default:o(()=>[...a[11]||(a[11]=[f(" Iptal ",-1)])]),_:1},8,["to"]),l(_,{color:"primary",type:"submit",loading:e(c),disabled:e(c)},{default:o(()=>[f(k(t.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{De as default};
