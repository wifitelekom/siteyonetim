import{j as K,h as u,D as q,Q as T,R as S,S as s,ac as I,q as t,y as g,O as _,a8 as c,u as e,ag as P,ad as Q}from"./vendor-qaEqcc9M.js";import{u as z,i as x}from"./useAbortOnUnmount-B_TyPYrd.js";import{$ as C,T as $,x as y,U as G}from"./main-DUODoQpR.js";import{V as H,r as d,c as J,e as W,a as X,m as Y,b as Z}from"./VForm-AfrkaUJk.js";import{V as h,a as n}from"./VRow-dBMGxjTF.js";import{V as ee}from"./VCard-DEMyauu_.js";import{V as ae}from"./VCardText-lEnvPJxp.js";import{V as le}from"./VAlert-DIbLZTVg.js";import{V as i}from"./VTextField-BgtisBQp.js";import{V as w}from"./VSelect-BpDYXa0x.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";import"./VChip-CzUAJTHl.js";const te={class:"d-flex align-center justify-space-between mb-2"},se={class:"text-h4 mb-1"},oe={class:"text-medium-emphasis mb-0"},re={class:"d-flex justify-end gap-3"},Te=K({__name:"create",setup(ne){const{withAbort:R}=z(),A=I(),b=u(!1),p=u(!1),f=u(""),m=u({}),v=u([]),k=u([]),V=u([]),a=u({name:"",email:"",phone:"",tc_kimlik:"",password:"",password_confirmation:"",role:"owner",apartment_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),U=u(null),M=[d(),J(100)],O=[d(),W()],D=[o=>typeof o!="string"||o.length===0?!0:X(11)(o)],E=[d(),Y(8)],B=[d(),Z(()=>a.value.password,"Şifreler eşleşmiyor.")],L=[d()],N=[o=>a.value.apartment_id==null?!0:d()(o)],j=async()=>{b.value=!0;try{const o=await R(l=>C("/users/meta",{signal:l}));v.value=o.data.roles,k.value=o.data.apartments,V.value=o.data.relation_types,v.value.length>0&&!v.value.some(l=>l.value===a.value.role)&&(a.value.role=v.value[0].value),V.value.length>0&&!V.value.some(l=>l.value===a.value.relation_type)&&(a.value.relation_type=V.value[0].value)}catch(o){if(x(o))return;f.value=$(o,"Rol listesi alınamadı.")}finally{b.value=!1}},F=async()=>{if((await U.value?.validate())?.valid){p.value=!0,f.value="",m.value={};try{await R(l=>C("/users",{method:"POST",body:{name:a.value.name,email:a.value.email,phone:a.value.phone||null,tc_kimlik:a.value.tc_kimlik||null,password:a.value.password,password_confirmation:a.value.password_confirmation,role:a.value.role,apartment_id:a.value.apartment_id,relation_type:a.value.apartment_id==null?void 0:a.value.relation_type,start_date:a.value.apartment_id==null?void 0:a.value.start_date||null},signal:l})),await A.push("/management/users")}catch(l){if(x(l))return;f.value=$(l,"Kullanıcı oluşturulamadı."),m.value=G(l)}finally{p.value=!1}}};return q(j),(o,l)=>(T(),S(h,null,{default:s(()=>[t(n,{cols:"12"},{default:s(()=>[g("div",te,[g("div",null,[g("h4",se,_(o.$t("pages.users.newTitle")),1),g("p",oe,_(o.$t("pages.users.createSubtitle")),1)]),t(y,{variant:"outlined",to:"/management/users"},{default:s(()=>[...l[10]||(l[10]=[c(" Listeye Don ",-1)])]),_:1})])]),_:1}),t(n,{cols:"12"},{default:s(()=>[t(ee,{loading:e(p)||e(b)},{default:s(()=>[t(ae,null,{default:s(()=>[t(H,{ref_key:"formRef",ref:U,onSubmit:P(F,["prevent"])},{default:s(()=>[t(h,null,{default:s(()=>[e(f)?(T(),S(n,{key:0,cols:"12"},{default:s(()=>[t(le,{type:"error",variant:"tonal"},{default:s(()=>[c(_(e(f)),1)]),_:1})]),_:1})):Q("",!0),t(n,{cols:"12",md:"6"},{default:s(()=>[t(i,{modelValue:e(a).name,"onUpdate:modelValue":l[0]||(l[0]=r=>e(a).name=r),label:"Ad Soyad",rules:M,"error-messages":e(m).name??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"6"},{default:s(()=>[t(i,{modelValue:e(a).email,"onUpdate:modelValue":l[1]||(l[1]=r=>e(a).email=r),type:"email",label:"E-posta",rules:O,"error-messages":e(m).email??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"6"},{default:s(()=>[t(i,{modelValue:e(a).phone,"onUpdate:modelValue":l[2]||(l[2]=r=>e(a).phone=r),label:"Telefon","error-messages":e(m).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"6"},{default:s(()=>[t(i,{modelValue:e(a).tc_kimlik,"onUpdate:modelValue":l[3]||(l[3]=r=>e(a).tc_kimlik=r),label:"TC Kimlik",maxlength:"11",rules:D,"error-messages":e(m).tc_kimlik??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(i,{modelValue:e(a).password,"onUpdate:modelValue":l[4]||(l[4]=r=>e(a).password=r),type:"password",label:"Şifre",rules:E,"error-messages":e(m).password??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(i,{modelValue:e(a).password_confirmation,"onUpdate:modelValue":l[5]||(l[5]=r=>e(a).password_confirmation=r),type:"password",label:"Şifre Tekrar",rules:B,"error-messages":e(m).password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(w,{modelValue:e(a).role,"onUpdate:modelValue":l[6]||(l[6]=r=>e(a).role=r),items:e(v),"item-title":"label","item-value":"value",label:"Rol",rules:L,"error-messages":e(m).role??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(w,{modelValue:e(a).apartment_id,"onUpdate:modelValue":l[7]||(l[7]=r=>e(a).apartment_id=r),items:e(k),"item-title":"label","item-value":"id",label:o.$t("common.apartment"),clearable:"","error-messages":e(m).apartment_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(w,{modelValue:e(a).relation_type,"onUpdate:modelValue":l[8]||(l[8]=r=>e(a).relation_type=r),items:e(V),"item-title":"label","item-value":"value",label:o.$t("common.type"),rules:N,disabled:e(a).apartment_id==null,"error-messages":e(m).relation_type??[]},null,8,["modelValue","items","label","disabled","error-messages"])]),_:1}),t(n,{cols:"12",md:"4"},{default:s(()=>[t(i,{modelValue:e(a).start_date,"onUpdate:modelValue":l[9]||(l[9]=r=>e(a).start_date=r),type:"date",label:o.$t("common.startDate"),disabled:e(a).apartment_id==null,"error-messages":e(m).start_date??[]},null,8,["modelValue","label","disabled","error-messages"])]),_:1}),t(n,{cols:"12"},{default:s(()=>[g("div",re,[t(y,{variant:"outlined",to:"/management/users"},{default:s(()=>[...l[11]||(l[11]=[c(" Iptal ",-1)])]),_:1}),t(y,{color:"primary",type:"submit",loading:e(p),disabled:e(p)},{default:s(()=>[c(_(o.$t("common.save")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Te as default};
