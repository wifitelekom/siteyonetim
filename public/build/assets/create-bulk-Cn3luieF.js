import{j as q,h as n,D as G,Q as R,R as A,S as o,ac as H,q as t,y as d,a8 as m,u as a,ag as L,O as b,ad as P}from"./vendor-qaEqcc9M.js";import{$ as S,T as $,x as f,U as Q}from"./main-DUODoQpR.js";import{u as J,i as x}from"./useAbortOnUnmount-B_TyPYrd.js";import{V as K,r as g,p as W}from"./VForm-AfrkaUJk.js";import{V as U,a as u}from"./VRow-dBMGxjTF.js";import{V as X}from"./VCard-DEMyauu_.js";import{V as Y}from"./VCardText-lEnvPJxp.js";import{V as Z}from"./VAlert-DIbLZTVg.js";import{V as _}from"./VSelect-BpDYXa0x.js";import{V as y}from"./VTextField-BgtisBQp.js";import{V as ee}from"./VTextarea-BWwjO-LJ.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";import"./VChip-CzUAJTHl.js";const ae={class:"d-flex align-center justify-space-between mb-2"},te={class:"d-flex justify-space-between align-center mb-2"},le={class:"text-body-2"},oe={class:"d-flex gap-2"},se={class:"d-flex justify-end gap-3"},Re=q({__name:"create-bulk",setup(re){const{withAbort:k}=J(),C=H(),p=n(!1),v=n(!1),c=n(""),i=n({}),V=n([]),h=n([]),T=n([]),l=n({apartment_ids:[],account_id:null,charge_type:"aidat",period:new Date().toISOString().slice(0,7),due_date:new Date().toISOString().slice(0,10),amount:null,description:""}),w=n(null),D=[s=>Array.isArray(s)&&s.length>0?!0:"En az bir daire seçiniz."],M=[g()],O=[g()],z=[g()],B=[g()],E=[g(),W()],N=async()=>{v.value=!0;try{const s=await k(e=>S("/charges/meta",{signal:e}));V.value=s.data.apartments,h.value=s.data.accounts,T.value=s.data.charge_types}catch(s){if(x(s))return;c.value=$(s,"Form verileri alınamadı.")}finally{v.value=!1}},j=()=>{l.value.apartment_ids=V.value.map(s=>s.id)},F=()=>{l.value.apartment_ids=[]},I=async()=>{if((await w.value?.validate())?.valid){p.value=!0,c.value="",i.value={};try{await k(e=>S("/charges/bulk",{method:"POST",body:{apartment_ids:l.value.apartment_ids,account_id:l.value.account_id,charge_type:l.value.charge_type,period:l.value.period,due_date:l.value.due_date,amount:l.value.amount,description:l.value.description||null},signal:e})),await C.push("/charges")}catch(e){if(x(e))return;c.value=$(e,"Toplu tahakkuk oluşturulamadı."),i.value=Q(e)}finally{p.value=!1}}};return G(N),(s,e)=>(R(),A(U,null,{default:o(()=>[t(u,{cols:"12"},{default:o(()=>[d("div",ae,[e[8]||(e[8]=d("div",null,[d("h4",{class:"text-h4 mb-1"}," Toplu Tahakkuk "),d("p",{class:"text-medium-emphasis mb-0"}," Birden fazla daire için tek seferde tahakkuk oluşturun ")],-1)),t(f,{variant:"outlined",to:"/charges"},{default:o(()=>[...e[7]||(e[7]=[m(" Listeye Don ",-1)])]),_:1})])]),_:1}),t(u,{cols:"12"},{default:o(()=>[t(X,{loading:a(v)||a(p)},{default:o(()=>[t(Y,null,{default:o(()=>[t(K,{ref_key:"formRef",ref:w,onSubmit:L(I,["prevent"])},{default:o(()=>[t(U,null,{default:o(()=>[a(c)?(R(),A(u,{key:0,cols:"12"},{default:o(()=>[t(Z,{type:"error",variant:"tonal"},{default:o(()=>[m(b(a(c)),1)]),_:1})]),_:1})):P("",!0),t(u,{cols:"12"},{default:o(()=>[d("div",te,[d("label",le,b(s.$t("common.apartments")),1),d("div",oe,[t(f,{size:"small",variant:"text",onClick:j},{default:o(()=>[...e[9]||(e[9]=[m(" Tümunu Sec ",-1)])]),_:1}),t(f,{size:"small",variant:"text",onClick:F},{default:o(()=>[m(b(s.$t("common.clear")),1)]),_:1})])]),t(_,{modelValue:a(l).apartment_ids,"onUpdate:modelValue":e[0]||(e[0]=r=>a(l).apartment_ids=r),items:a(V),"item-title":"label","item-value":"id",label:s.$t("common.apartments"),multiple:"",chips:"","closable-chips":"",rules:D,"error-messages":a(i).apartment_ids??a(i)["apartment_ids.0"]??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:a(l).account_id,"onUpdate:modelValue":e[1]||(e[1]=r=>a(l).account_id=r),items:a(h),"item-title":"label","item-value":"id",label:"Gelir Hesabi",rules:M,"error-messages":a(i).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),t(u,{cols:"12",md:"6"},{default:o(()=>[t(_,{modelValue:a(l).charge_type,"onUpdate:modelValue":e[2]||(e[2]=r=>a(l).charge_type=r),items:a(T),"item-title":"label","item-value":"value",label:s.$t("common.chargeType"),rules:O,"error-messages":a(i).charge_type??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:a(l).period,"onUpdate:modelValue":e[3]||(e[3]=r=>a(l).period=r),type:"month",label:s.$t("common.period"),rules:z,"error-messages":a(i).period??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:a(l).due_date,"onUpdate:modelValue":e[4]||(e[4]=r=>a(l).due_date=r),type:"date",label:s.$t("common.dueDate"),rules:B,"error-messages":a(i).due_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(u,{cols:"12",md:"4"},{default:o(()=>[t(y,{modelValue:a(l).amount,"onUpdate:modelValue":e[5]||(e[5]=r=>a(l).amount=r),type:"number",step:"0.01",min:"0",label:s.$t("common.amount"),rules:E,"error-messages":a(i).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(u,{cols:"12"},{default:o(()=>[t(ee,{modelValue:a(l).description,"onUpdate:modelValue":e[6]||(e[6]=r=>a(l).description=r),label:s.$t("common.description"),rows:"3","error-messages":a(i).description??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(u,{cols:"12"},{default:o(()=>[d("div",se,[t(f,{variant:"outlined",to:"/charges"},{default:o(()=>[...e[10]||(e[10]=[m(" Iptal ",-1)])]),_:1}),t(f,{color:"primary",type:"submit",loading:a(p),disabled:a(p)},{default:o(()=>[...e[11]||(e[11]=[m(" Toplu Oluştur ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Re as default};
