import{j as Q,f as Z,h as n,D as H,Q as M,R as k,S as s,Z as J,ac as K,q as t,y as m,a8 as c,u as l,ag as W,O as x,ad as X}from"./vendor-DfCbaU-T.js";import{$ as y,T as g,x as _,U as Y}from"./main-Btr01hqQ.js";import{V as ee,r as f,p as ae}from"./VForm-D0fBkA3g.js";import{u as le,i as w}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as h,a as d}from"./VRow-CRn_xzm0.js";import{V as te}from"./VCard-BmPLTxO3.js";import{V as oe}from"./VCardText-H2SttjXr.js";import{V as se}from"./VAlert-R8JWKysv.js";import{V as N}from"./VTextField-pVQuWnMO.js";import{V as D}from"./VSelect-DhbvR9Z1.js";import{V as re}from"./VSwitch-Blte16Xl.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";import"./VChip-DOrTqiUh.js";const ne={class:"d-flex align-center justify-space-between mb-2"},de={class:"d-flex gap-2"},ue={class:"d-flex justify-end gap-3"},Ee=Q({__name:"edit",setup(ie){const B=J(),C=K(),R=Z(()=>Number(B.params.id)),{withAbort:v}=le(),b={path:"/templates/expense"},$=n(!1),U=n(!1),p=n(!1),V=n(!1),u=n(""),i=n({}),E=n([]),S=n([]),T=n([]),o=n({name:"",amount:null,due_day:15,period:"monthly",vendor_id:null,account_id:null,is_active:!0}),A=n(null),F=[f()],G=[f()],j=[f()],q=[f(),ae()],I=[f(),e=>{const a=Number(e);return!Number.isInteger(a)||a<1||a>28?"Vade gunu 1 ile 28 arasinda olmalidir.":!0}],L=async()=>{$.value=!0;try{const e=await v(a=>y("/templates/expense/meta",{signal:a}));E.value=e.data.accounts,S.value=e.data.vendors,T.value=e.data.periods}catch(e){if(w(e))return;u.value=g(e,"Form verileri alınamadı.")}finally{$.value=!1}},O=async()=>{U.value=!0,u.value="";try{const e=await v(a=>y(`/templates/expense/${R.value}`,{signal:a}));o.value={name:e.data.name,amount:e.data.amount,due_day:e.data.due_day,period:e.data.period,vendor_id:e.data.vendor?.id??null,account_id:e.data.account?.id??null,is_active:e.data.is_active}}catch(e){if(w(e))return;u.value=g(e,"Gider şablonu alınamadı.")}finally{U.value=!1}},P=async()=>{if((await A.value?.validate())?.valid){p.value=!0,u.value="",i.value={};try{await v(a=>y(`/templates/expense/${R.value}`,{method:"PUT",body:{name:o.value.name,amount:o.value.amount,due_day:o.value.due_day,period:o.value.period,vendor_id:o.value.vendor_id,account_id:o.value.account_id,is_active:o.value.is_active},signal:a})),await C.push(b)}catch(a){if(w(a))return;u.value=g(a,"Gider şablonu güncellenemedi."),i.value=Y(a)}finally{p.value=!1}}},z=async()=>{V.value=!0,u.value="";try{await v(e=>y(`/templates/expense/${R.value}`,{method:"DELETE",signal:e})),await C.push(b)}catch(e){if(w(e))return;u.value=g(e,"Gider şablonu silinemedi.")}finally{V.value=!1}};return H(async()=>{await Promise.allSettled([L(),O()])}),(e,a)=>(M(),k(h,null,{default:s(()=>[t(d,{cols:"12"},{default:s(()=>[m("div",ne,[a[9]||(a[9]=m("div",null,[m("h4",{class:"text-h4 mb-1"}," Gider Şablonu Düzenle "),m("p",{class:"text-medium-emphasis mb-0"}," Şablon bilgilerini güncelleyin ")],-1)),m("div",de,[t(_,{variant:"outlined",to:b},{default:s(()=>[...a[7]||(a[7]=[c(" Listeye Don ",-1)])]),_:1}),t(_,{color:"error",variant:"outlined",loading:l(V),disabled:l(V),onClick:z},{default:s(()=>[...a[8]||(a[8]=[c(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),t(d,{cols:"12"},{default:s(()=>[t(te,{loading:l($)||l(U)||l(p)},{default:s(()=>[t(oe,null,{default:s(()=>[t(ee,{ref_key:"formRef",ref:A,onSubmit:W(P,["prevent"])},{default:s(()=>[t(h,null,{default:s(()=>[l(u)?(M(),k(d,{key:0,cols:"12"},{default:s(()=>[t(se,{type:"error",variant:"tonal"},{default:s(()=>[c(x(l(u)),1)]),_:1})]),_:1})):X("",!0),t(d,{cols:"12",md:"6"},{default:s(()=>[t(N,{modelValue:l(o).name,"onUpdate:modelValue":a[0]||(a[0]=r=>l(o).name=r),label:e.$t("common.templateName"),rules:F,"error-messages":l(i).name??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(d,{cols:"12",md:"6"},{default:s(()=>[t(D,{modelValue:l(o).vendor_id,"onUpdate:modelValue":a[1]||(a[1]=r=>l(o).vendor_id=r),items:l(S),"item-title":"label","item-value":"id",label:e.$t("common.vendor"),clearable:"","error-messages":l(i).vendor_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(d,{cols:"12",md:"4"},{default:s(()=>[t(D,{modelValue:l(o).account_id,"onUpdate:modelValue":a[2]||(a[2]=r=>l(o).account_id=r),items:l(E),"item-title":"label","item-value":"id",label:e.$t("common.account"),rules:G,"error-messages":l(i).account_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(d,{cols:"12",md:"4"},{default:s(()=>[t(D,{modelValue:l(o).period,"onUpdate:modelValue":a[3]||(a[3]=r=>l(o).period=r),items:l(T),"item-title":"label","item-value":"value",label:e.$t("common.periodicity"),rules:j,"error-messages":l(i).period??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),t(d,{cols:"12",md:"4"},{default:s(()=>[t(N,{modelValue:l(o).due_day,"onUpdate:modelValue":a[4]||(a[4]=r=>l(o).due_day=r),type:"number",min:"1",max:"28",label:e.$t("common.dueDay"),rules:I,"error-messages":l(i).due_day??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(d,{cols:"12"},{default:s(()=>[t(N,{modelValue:l(o).amount,"onUpdate:modelValue":a[5]||(a[5]=r=>l(o).amount=r),type:"number",min:"0.01",step:"0.01",label:e.$t("common.amount"),rules:q,"error-messages":l(i).amount??[]},null,8,["modelValue","label","error-messages"])]),_:1}),t(d,{cols:"12"},{default:s(()=>[t(re,{modelValue:l(o).is_active,"onUpdate:modelValue":a[6]||(a[6]=r=>l(o).is_active=r),label:e.$t("common.active"),color:"primary"},null,8,["modelValue","label"])]),_:1}),t(d,{cols:"12"},{default:s(()=>[m("div",ue,[t(_,{variant:"outlined",to:b},{default:s(()=>[c(x(e.$t("common.cancel")),1)]),_:1}),t(_,{color:"primary",type:"submit",loading:l(p),disabled:l(p)},{default:s(()=>[c(x(e.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ee as default};
