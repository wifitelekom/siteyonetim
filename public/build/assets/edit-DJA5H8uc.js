import{j as H,f as K,h as u,D as Q,Q as x,R as S,S as o,Z,ac as J,q as s,y as m,a8 as c,u as a,ag as W,O as X,ad as M}from"./vendor-DfCbaU-T.js";import{$ as _,T as b,x as y,U as Y}from"./main-OjHNd2U9.js";import{V as ee,r as f,p as ae}from"./VForm-CtC6ldpE.js";import{u as te,i as g}from"./useAbortOnUnmount-D2zdVzb9.js";import{V as $,a as i}from"./VRow-Ba58lXtG.js";import{V as le}from"./VCard-9RfFlHpT.js";import{V as se}from"./VCardText-YweTyZzP.js";import{V as oe}from"./VAlert-DafHPFjN.js";import{V as U}from"./VTextField-CMxHKe9w.js";import{V as D}from"./VSelect-CMe3Xagq.js";import{V as re}from"./VSwitch-XgqsY1US.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VList-B1ov9hmg.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";import"./VChip-CnrRRXXG.js";const ue={class:"d-flex align-center justify-space-between mb-2"},ie={class:"d-flex gap-2"},ne={class:"d-flex justify-end gap-3"},Ne=H({__name:"edit",setup(de){const z=Z(),E=J(),w=K(()=>Number(z.params.id)),{withAbort:v}=te(),A=u(!1),R=u(!1),p=u(!1),V=u(!1),n=u(""),d=u({}),N=u([]),T=u([]),k=u([]),l=u({name:"",amount:null,due_day:15,account_id:null,scope:"all",apartment_ids:[],is_active:!0}),C=u(null),B=[f()],F=[f()],j=[f(),ae()],O=[f(),t=>{const e=Number(t);return!Number.isInteger(e)||e<1||e>28?"Vade gunu 1 ile 28 arasinda olmalidir.":!0}],q=[f()],G=[t=>l.value.scope!=="selected"||Array.isArray(t)&&t.length>0?!0:"En az bir daire seciniz."],I=async()=>{A.value=!0;try{const t=await v(e=>_("/templates/aidat/meta",{signal:e}));N.value=t.data.accounts,T.value=t.data.apartments,k.value=t.data.scopes}catch(t){if(g(t))return;n.value=b(t,"Form verileri alinamadi.")}finally{A.value=!1}},L=async()=>{R.value=!0,n.value="";try{const t=await v(e=>_(`/templates/aidat/${w.value}`,{signal:e}));l.value={name:t.data.name,amount:t.data.amount,due_day:t.data.due_day,account_id:t.data.account?.id??null,scope:t.data.scope,apartment_ids:t.data.apartment_ids??[],is_active:t.data.is_active}}catch(t){if(g(t))return;n.value=b(t,"Aidat sablonu alinamadi.")}finally{R.value=!1}},P=async()=>{if((await C.value?.validate())?.valid){p.value=!0,n.value="",d.value={};try{await v(e=>_(`/templates/aidat/${w.value}`,{method:"PUT",body:{name:l.value.name,amount:l.value.amount,due_day:l.value.due_day,account_id:l.value.account_id,scope:l.value.scope,apartment_ids:l.value.scope==="selected"?l.value.apartment_ids:[],is_active:l.value.is_active},signal:e})),await E.push("/templates/aidat")}catch(e){if(g(e))return;n.value=b(e,"Aidat sablonu guncellenemedi."),d.value=Y(e)}finally{p.value=!1}}},h=async()=>{V.value=!0,n.value="";try{await v(t=>_(`/templates/aidat/${w.value}`,{method:"DELETE",signal:t})),await E.push("/templates/aidat")}catch(t){if(g(t))return;n.value=b(t,"Aidat sablonu silinemedi.")}finally{V.value=!1}};return Q(async()=>{await Promise.allSettled([I(),L()])}),(t,e)=>(x(),S($,null,{default:o(()=>[s(i,{cols:"12"},{default:o(()=>[m("div",ue,[e[9]||(e[9]=m("div",null,[m("h4",{class:"text-h4 mb-1"}," Aidat Sablonu Duzenle "),m("p",{class:"text-medium-emphasis mb-0"}," Sablon bilgilerini guncelleyin ")],-1)),m("div",ie,[s(y,{variant:"outlined",to:"/templates/aidat"},{default:o(()=>[...e[7]||(e[7]=[c(" Listeye Don ",-1)])]),_:1}),s(y,{color:"error",variant:"outlined",loading:a(V),disabled:a(V),onClick:h},{default:o(()=>[...e[8]||(e[8]=[c(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),s(i,{cols:"12"},{default:o(()=>[s(le,{loading:a(A)||a(R)||a(p)},{default:o(()=>[s(se,null,{default:o(()=>[s(ee,{ref_key:"formRef",ref:C,onSubmit:W(P,["prevent"])},{default:o(()=>[s($,null,{default:o(()=>[a(n)?(x(),S(i,{key:0,cols:"12"},{default:o(()=>[s(oe,{type:"error",variant:"tonal"},{default:o(()=>[c(X(a(n)),1)]),_:1})]),_:1})):M("",!0),s(i,{cols:"12",md:"6"},{default:o(()=>[s(U,{modelValue:a(l).name,"onUpdate:modelValue":e[0]||(e[0]=r=>a(l).name=r),label:"Sablon Adi",rules:B,"error-messages":a(d).name??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12",md:"6"},{default:o(()=>[s(D,{modelValue:a(l).account_id,"onUpdate:modelValue":e[1]||(e[1]=r=>a(l).account_id=r),items:a(N),"item-title":"label","item-value":"id",label:"Hesap",rules:F,"error-messages":a(d).account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),s(i,{cols:"12",md:"4"},{default:o(()=>[s(U,{modelValue:a(l).amount,"onUpdate:modelValue":e[2]||(e[2]=r=>a(l).amount=r),type:"number",min:"0.01",step:"0.01",label:"Tutar",rules:j,"error-messages":a(d).amount??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12",md:"4"},{default:o(()=>[s(U,{modelValue:a(l).due_day,"onUpdate:modelValue":e[3]||(e[3]=r=>a(l).due_day=r),type:"number",min:"1",max:"28",label:"Vade Gunu",rules:O,"error-messages":a(d).due_day??[]},null,8,["modelValue","error-messages"])]),_:1}),s(i,{cols:"12",md:"4"},{default:o(()=>[s(D,{modelValue:a(l).scope,"onUpdate:modelValue":e[4]||(e[4]=r=>a(l).scope=r),items:a(k),"item-title":"label","item-value":"value",label:"Kapsam",rules:q,"error-messages":a(d).scope??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(l).scope==="selected"?(x(),S(i,{key:1,cols:"12"},{default:o(()=>[s(D,{modelValue:a(l).apartment_ids,"onUpdate:modelValue":e[5]||(e[5]=r=>a(l).apartment_ids=r),items:a(T),"item-title":"label","item-value":"id",label:"Daireler",multiple:"",chips:"","closable-chips":"",rules:G,"error-messages":a(d).apartment_ids??[]},null,8,["modelValue","items","error-messages"])]),_:1})):M("",!0),s(i,{cols:"12"},{default:o(()=>[s(re,{modelValue:a(l).is_active,"onUpdate:modelValue":e[6]||(e[6]=r=>a(l).is_active=r),label:"Aktif",color:"primary"},null,8,["modelValue"])]),_:1}),s(i,{cols:"12"},{default:o(()=>[m("div",ne,[s(y,{variant:"outlined",to:"/templates/aidat"},{default:o(()=>[...e[10]||(e[10]=[c(" Vazgec ",-1)])]),_:1}),s(y,{color:"primary",type:"submit",loading:a(p),disabled:a(p)},{default:o(()=>[...e[11]||(e[11]=[c(" Guncelle ",-1)])]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Ne as default};
