import{j as G,f as J,h as m,D as W,Q as g,R as w,S as l,Z as X,ac as ee,q as a,y as s,O as u,u as t,a8 as f,ad as C,V as A,F as te,ab as ae,H as le,ag as se}from"./vendor-DfCbaU-T.js";import{$ as D,T as R,x as V,V as oe,U as ie}from"./main-OjHNd2U9.js";import{u as re,i as S}from"./useAbortOnUnmount-D2zdVzb9.js";import{a as $,f as b}from"./formatters-BEv4aA23.js";import{c as de,a as ue}from"./statusHelpers-B7BIhNzn.js";import{V as ne,r as y,p as me}from"./VForm-CtC6ldpE.js";import{V as E,a as r}from"./VRow-Ba58lXtG.js";import{V as ce}from"./VAlert-DafHPFjN.js";import{V as F,a as pe,d as fe}from"./VCard-9RfFlHpT.js";import{V as O}from"./VCardText-YweTyZzP.js";import{V as ve}from"./VChip-CnrRRXXG.js";import{V as ge}from"./VTable-ByowNMkP.js";import{V as Ve}from"./VDialog-BQJ2uzM5.js";import{V as z}from"./VTextField-CMxHKe9w.js";import{V as H}from"./VSelect-CMe3Xagq.js";import{V as he}from"./VTextarea-CHmrCRFp.js";import"./vuetify-BWJcAN87.js";import"./VAvatar-BcaC_ZEa.js";import"./VList-B1ov9hmg.js";import"./VDivider-CUijZXd4.js";import"./VCheckboxBtn-B6JwM7Rr.js";import"./VSelectionControl-Ck2LTPqY.js";const _e={class:"d-flex align-center justify-space-between mb-2"},xe={class:"text-medium-emphasis mb-0"},be={class:"d-flex gap-2"},ye={class:"font-weight-medium"},ke={class:"font-weight-medium"},Te={class:"font-weight-medium"},we={class:"text-h6"},Ce={class:"text-h6 text-success"},Ae={class:"text-h6 text-error"},De={class:"text-right"},Re={key:0},Xe=G({__name:"[id]",setup(Se){const{withAbort:k}=re(),L=X(),I=ee(),T=J(()=>Number(L.params.id)),h=m(!1),_=m(!1),x=m(!1),c=m(""),i=m(null),U=m([]),B=m([]),v=m(!1),p=m({}),d=m({paid_at:new Date().toISOString().slice(0,10),method:"cash",cash_account_id:null,amount:null,description:""}),N=m(null),K=[y()],j=[y()],q=[y()],Y=[y(),me()],M=async()=>{h.value=!0,c.value="";try{const n=await k(e=>D(`/charges/${T.value}`,{signal:e}));i.value=n.data,U.value=n.meta.cash_accounts,B.value=n.meta.payment_methods}catch(n){if(S(n))return;c.value=R(n,"Tahakkuk detayi alinamadi.")}finally{h.value=!1}},P=()=>{p.value={},d.value.amount=i.value?.remaining??null,v.value=!0},Q=async()=>{if((await N.value?.validate())?.valid){_.value=!0,c.value="",p.value={};try{await k(e=>D(`/charges/${T.value}/collect`,{method:"POST",body:{paid_at:d.value.paid_at,method:d.value.method,cash_account_id:d.value.cash_account_id,amount:d.value.amount,description:d.value.description||null},signal:e})),v.value=!1,await M()}catch(e){if(S(e))return;c.value=R(e,"Tahsilat islemi basarisiz."),p.value=ie(e)}finally{_.value=!1}}},Z=async()=>{x.value=!0,c.value="";try{await k(n=>D(`/charges/${T.value}`,{method:"DELETE",signal:n})),await I.push("/charges")}catch(n){if(S(n))return;c.value=R(n,"Tahakkuk silinemedi.")}finally{x.value=!1}};return W(M),(n,e)=>(g(),w(E,null,{default:l(()=>[a(r,{cols:"12"},{default:l(()=>[s("div",_e,[s("div",null,[e[7]||(e[7]=s("h4",{class:"text-h4 mb-1"}," Tahakkuk Detayi ",-1)),s("p",xe,u(t(i)?.apartment?.label??"-"),1)]),s("div",be,[a(V,{variant:"outlined",to:"/charges"},{default:l(()=>[...e[8]||(e[8]=[f(" Listeye Don ",-1)])]),_:1}),a(V,{color:"success","prepend-icon":"ri-hand-coin-line",disabled:!t(i)||t(i).remaining<=0,onClick:P},{default:l(()=>[...e[9]||(e[9]=[f(" Tahsilat Al ",-1)])]),_:1},8,["disabled"]),a(V,{color:"error",variant:"outlined","prepend-icon":"ri-delete-bin-line",loading:t(x),disabled:t(x),onClick:Z},{default:l(()=>[...e[10]||(e[10]=[f(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),t(c)?(g(),w(r,{key:0,cols:"12"},{default:l(()=>[a(ce,{type:"error",variant:"tonal"},{default:l(()=>[f(u(t(c)),1)]),_:1})]),_:1})):C("",!0),a(r,{cols:"12"},{default:l(()=>[a(F,{loading:t(h)},{default:l(()=>[t(i)?(g(),w(O,{key:0},{default:l(()=>[a(E,null,{default:l(()=>[a(r,{cols:"12",md:"3"},{default:l(()=>[e[11]||(e[11]=s("div",{class:"text-caption text-medium-emphasis"}," Donem ",-1)),s("div",ye,u(t(i).period),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:l(()=>[e[12]||(e[12]=s("div",{class:"text-caption text-medium-emphasis"}," Vade ",-1)),s("div",ke,u(t($)(t(i).due_date)),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:l(()=>[e[13]||(e[13]=s("div",{class:"text-caption text-medium-emphasis"}," Hesap ",-1)),s("div",Te,u(t(i).account?.name??"-"),1)]),_:1}),a(r,{cols:"12",md:"3"},{default:l(()=>[e[14]||(e[14]=s("div",{class:"text-caption text-medium-emphasis"}," Durum ",-1)),a(ve,{size:"small",color:t(de)(t(i).status),variant:"tonal"},{default:l(()=>[f(u(t(ue)(t(i).status)),1)]),_:1},8,["color"])]),_:1}),a(r,{cols:"12",md:"4"},{default:l(()=>[e[15]||(e[15]=s("div",{class:"text-caption text-medium-emphasis"},"Tutar",-1)),s("div",we,u(t(b)(t(i).amount)),1)]),_:1}),a(r,{cols:"12",md:"4"},{default:l(()=>[e[16]||(e[16]=s("div",{class:"text-caption text-medium-emphasis"},"Odenen",-1)),s("div",Ce,u(t(b)(t(i).paid_amount)),1)]),_:1}),a(r,{cols:"12",md:"4"},{default:l(()=>[e[17]||(e[17]=s("div",{class:"text-caption text-medium-emphasis"},"Kalan",-1)),s("div",Ae,u(t(b)(t(i).remaining)),1)]),_:1}),a(r,{cols:"12"},{default:l(()=>[e[18]||(e[18]=s("div",{class:"text-caption text-medium-emphasis"},"Aciklama",-1)),s("div",null,u(t(i).description||"-"),1)]),_:1})]),_:1})]),_:1})):C("",!0)]),_:1},8,["loading"])]),_:1}),a(r,{cols:"12"},{default:l(()=>[a(F,{loading:t(h)},{default:l(()=>[a(pe,{title:"Tahsilat Hareketleri"}),a(ge,{density:"comfortable"},{default:l(()=>[e[20]||(e[20]=s("thead",null,[s("tr",null,[s("th",null,"Makbuz No"),s("th",null,"Tarih"),s("th",null,"Yontem"),s("th",null,"Kasa/Banka"),s("th",{class:"text-right"}," Tutar ")])],-1)),s("tbody",null,[(g(!0),A(te,null,ae(t(i)?.receipt_items??[],o=>(g(),A("tr",{key:o.id},[s("td",null,u(o.receipt?.receipt_no??"-"),1),s("td",null,u(t($)(o.receipt?.paid_at??"")),1),s("td",null,u(o.receipt?.method??"-"),1),s("td",null,u(o.receipt?.cash_account?.name??"-"),1),s("td",De,u(t(b)(o.amount)),1)]))),128)),(t(i)?.receipt_items??[]).length===0?(g(),A("tr",Re,[...e[19]||(e[19]=[s("td",{colspan:"5",class:"text-center text-medium-emphasis py-6"}," Tahsilat kaydi yok. ",-1)])])):C("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),a(Ve,{modelValue:t(v),"onUpdate:modelValue":e[6]||(e[6]=o=>le(v)?v.value=o:null),"max-width":"560"},{default:l(()=>[a(F,{title:"Tahsilat Al"},{default:l(()=>[a(O,null,{default:l(()=>[a(ne,{ref_key:"collectFormRef",ref:N,onSubmit:se(Q,["prevent"])},{default:l(()=>[a(E,null,{default:l(()=>[a(r,{cols:"12",md:"6"},{default:l(()=>[a(z,{modelValue:t(d).paid_at,"onUpdate:modelValue":e[0]||(e[0]=o=>t(d).paid_at=o),type:"date",label:"Tahsilat Tarihi",rules:K,"error-messages":t(p).paid_at??[]},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12",md:"6"},{default:l(()=>[a(H,{modelValue:t(d).method,"onUpdate:modelValue":e[1]||(e[1]=o=>t(d).method=o),items:t(B),"item-title":"label","item-value":"value",label:"Yontem",rules:j,"error-messages":t(p).method??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(r,{cols:"12"},{default:l(()=>[a(H,{modelValue:t(d).cash_account_id,"onUpdate:modelValue":e[2]||(e[2]=o=>t(d).cash_account_id=o),items:t(U),"item-title":"name","item-value":"id",label:"Kasa/Banka Hesabi",rules:q,"error-messages":t(p).cash_account_id??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(r,{cols:"12"},{default:l(()=>[a(z,{modelValue:t(d).amount,"onUpdate:modelValue":e[3]||(e[3]=o=>t(d).amount=o),type:"number",step:"0.01",min:"0",label:"Tutar",rules:Y,"error-messages":t(p).amount??[]},null,8,["modelValue","error-messages"])]),_:1}),a(r,{cols:"12"},{default:l(()=>[a(he,{modelValue:t(d).description,"onUpdate:modelValue":e[4]||(e[4]=o=>t(d).description=o),label:"Aciklama",rows:"2","error-messages":t(p).description??[]},null,8,["modelValue","error-messages"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a(fe,{class:"px-6 pb-4"},{default:l(()=>[a(oe),a(V,{variant:"outlined",onClick:e[5]||(e[5]=o=>v.value=!1)},{default:l(()=>[...e[21]||(e[21]=[f(" Vazgec ",-1)])]),_:1}),a(V,{color:"primary",type:"submit",loading:t(_),disabled:t(_)},{default:l(()=>[...e[22]||(e[22]=[f(" Tahsil Et ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{Xe as default};
