import{j as fe,f as pe,h as m,D as ve,Q as y,V,q as l,S as t,H as ye,u as a,F as A,Z as be,y as s,O as i,a8 as p,R as Z,ad as F,ag as h,ab as G}from"./vendor-qaEqcc9M.js";import{$ as N,T as E,x as _,q as J,V as Ve,U as W}from"./main-DUODoQpR.js";import{a as X,f as Y}from"./formatters-BEv4aA23.js";import{c as _e,a as ge}from"./statusHelpers-D3tNe4to.js";import{V as ee,r as I,p as ce}from"./VForm-AfrkaUJk.js";import{V as B,a as f}from"./VRow-dBMGxjTF.js";import{V as ke}from"./VDialog-8MtGyTgn.js";import{V as $e}from"./VAlert-DIbLZTVg.js";import{V as z,a as L,d as Re}from"./VCard-DEMyauu_.js";import{V as K}from"./VCardText-lEnvPJxp.js";import{V as we,a as k,b as $}from"./VList-BpKoOtV6.js";import{V as M}from"./VChip-CzUAJTHl.js";import{V as q}from"./VSelect-BpDYXa0x.js";import{V as R}from"./VTextField-BgtisBQp.js";import{V as le}from"./VTable-CDiDVqFm.js";import{V as Se}from"./VSwitch-C2gHzlAV.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";const De={class:"d-flex align-center justify-space-between mb-2"},Ce={class:"text-h4 mb-1"},xe={class:"text-medium-emphasis mb-0"},Te={class:"d-flex gap-2"},Ue={class:"font-weight-medium"},Fe={class:"text-caption text-medium-emphasis"},Ne={class:"text-right"},Ee={key:0},Ie={class:"text-right"},ze={class:"text-right"},Ae={class:"text-right"},Be={key:0},il=fe({__name:"[id]",setup(Le){const ae=be(),D=pe(()=>Number(ae.params.id)),w=m(!1),C=m(!1),x=m(null),v=m(""),g=m({}),u=m(null),O=m([]),T=m([]),P=m([]),d=m({user_id:null,relation_type:"owner",family_role:null,start_date:new Date().toISOString().slice(0,10)}),j=m(null),te=[I()],oe=[I()],c=m(!1),S=m(!1),b=m({}),n=m({block:"",floor:null,number:"",m2:null,arsa_payi:null,is_active:!0}),H=m(null),se=[I(),r=>Number.isInteger(Number(r))?!0:"Kat bilgisi tam sayi olmalidir."],re=[I()],ie=[r=>r==null||r===""?!0:ce()(r)],ue=[r=>{if(r==null||r==="")return!0;const e=Number(r);return Number.isFinite(e)&&e>=0?!0:"Sifir veya daha buyuk bir deger giriniz."}],U=async()=>{w.value=!0,v.value="";try{const r=await N(`/apartments/${D.value}`);u.value=r.data,O.value=r.meta.available_users,T.value=r.meta.relation_types,P.value=r.meta.family_roles,T.value.some(e=>e.value===d.value.relation_type)||(d.value.relation_type=T.value[0]?.value??"owner")}catch(r){v.value=E(r,"Daire detayi alinamadi.")}finally{w.value=!1}},ne=async()=>{if((await j.value?.validate())?.valid){C.value=!0,v.value="",g.value={};try{await N(`/apartments/${D.value}/residents`,{method:"POST",body:{user_id:d.value.user_id,relation_type:d.value.relation_type,family_role:d.value.family_role||null,start_date:d.value.start_date||null}}),d.value.user_id=null,d.value.family_role=null,await U()}catch(e){v.value=E(e,"Sakin eklenemedi."),g.value=W(e)}finally{C.value=!1}}},de=async r=>{x.value=r,v.value="";try{await N(`/apartments/${D.value}/residents/${r}`,{method:"DELETE"}),await U()}catch(e){v.value=E(e,"Sakin kaldirilamadi.")}finally{x.value=null}},me=()=>{u.value&&(b.value={},n.value={block:u.value.block??"",floor:u.value.floor,number:u.value.number,m2:u.value.m2,arsa_payi:u.value.arsa_payi,is_active:u.value.is_active},c.value=!0)},Q=async()=>{if((await H.value?.validate())?.valid){S.value=!0,b.value={},v.value="";try{await N(`/apartments/${D.value}`,{method:"PUT",body:{block:n.value.block||null,floor:n.value.floor,number:n.value.number,m2:n.value.m2,arsa_payi:n.value.arsa_payi,is_active:n.value.is_active}}),c.value=!1,await U()}catch(e){v.value=E(e,"Daire guncellenemedi."),b.value=W(e)}finally{S.value=!1}}};return ve(U),(r,e)=>(y(),V(A,null,[l(B,null,{default:t(()=>[l(f,{cols:"12"},{default:t(()=>[s("div",De,[s("div",null,[s("h4",Ce,i(r.$t("pages.apartments.detailTitle")),1),s("p",xe,i(a(u)?.full_label??"-"),1)]),s("div",Te,[l(_,{variant:"outlined",to:"/management/apartments"},{default:t(()=>[...e[12]||(e[12]=[p(" Listeye Don ",-1)])]),_:1}),l(_,{color:"primary",onClick:me},{default:t(()=>[...e[13]||(e[13]=[p(" Duzenle ",-1)])]),_:1})])])]),_:1}),a(v)?(y(),Z(f,{key:0,cols:"12"},{default:t(()=>[l($e,{type:"error",variant:"tonal"},{default:t(()=>[p(i(a(v)),1)]),_:1})]),_:1})):F("",!0),l(f,{cols:"12",md:"4"},{default:t(()=>[l(z,{loading:a(w)},{default:t(()=>[l(L,{title:"Daire Bilgileri"}),a(u)?(y(),Z(K,{key:0},{default:t(()=>[l(we,{class:"card-list"},{default:t(()=>[l(k,null,{append:t(()=>[s("span",null,i(a(u).block||"-"),1)]),default:t(()=>[l($,null,{default:t(()=>[...e[14]||(e[14]=[p("Blok",-1)])]),_:1})]),_:1}),l(k,null,{append:t(()=>[s("span",null,i(a(u).floor),1)]),default:t(()=>[l($,null,{default:t(()=>[...e[15]||(e[15]=[p("Kat",-1)])]),_:1})]),_:1}),l(k,null,{append:t(()=>[s("span",null,i(a(u).number),1)]),default:t(()=>[l($,null,{default:t(()=>[...e[16]||(e[16]=[p("No",-1)])]),_:1})]),_:1}),l(k,null,{append:t(()=>[s("span",null,i(a(u).m2??"-"),1)]),default:t(()=>[l($,null,{default:t(()=>[...e[17]||(e[17]=[p("m2",-1)])]),_:1})]),_:1}),l(k,null,{append:t(()=>[s("span",null,i(a(u).arsa_payi??"-"),1)]),default:t(()=>[l($,null,{default:t(()=>[p(i(r.$t("common.landShare")),1)]),_:1})]),_:1}),l(k,null,{append:t(()=>[l(M,{size:"small",color:a(u).is_active?"success":"secondary",variant:"tonal"},{default:t(()=>[p(i(a(u).is_active?r.$t("common.active"):r.$t("common.passive")),1)]),_:1},8,["color"])]),default:t(()=>[l($,null,{default:t(()=>[...e[18]||(e[18]=[p("Durum",-1)])]),_:1})]),_:1})]),_:1})]),_:1})):F("",!0)]),_:1},8,["loading"])]),_:1}),l(f,{cols:"12",md:"8"},{default:t(()=>[l(z,{loading:a(w)},{default:t(()=>[l(L,{title:"Sakinler"}),l(K,null,{default:t(()=>[l(ee,{ref_key:"residentFormRef",ref:j,onSubmit:h(ne,["prevent"])},{default:t(()=>[l(B,null,{default:t(()=>[l(f,{cols:"12",md:"4"},{default:t(()=>[l(q,{modelValue:a(d).user_id,"onUpdate:modelValue":e[0]||(e[0]=o=>a(d).user_id=o),items:a(O),"item-title":"name","item-value":"id",label:r.$t("common.user"),rules:te,"error-messages":a(g).user_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(f,{cols:"12",md:"2"},{default:t(()=>[l(q,{modelValue:a(d).relation_type,"onUpdate:modelValue":e[1]||(e[1]=o=>a(d).relation_type=o),items:a(T),"item-title":"label","item-value":"value",label:r.$t("common.type"),rules:oe,"error-messages":a(g).relation_type??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),l(f,{cols:"12",md:"2"},{default:t(()=>[l(q,{modelValue:a(d).family_role,"onUpdate:modelValue":e[2]||(e[2]=o=>a(d).family_role=o),items:a(P),"item-title":"label","item-value":"value",label:"Aile Rolu",clearable:"","error-messages":a(g).family_role??[]},null,8,["modelValue","items","error-messages"])]),_:1}),l(f,{cols:"12",md:"2"},{default:t(()=>[l(R,{modelValue:a(d).start_date,"onUpdate:modelValue":e[3]||(e[3]=o=>a(d).start_date=o),type:"date",label:r.$t("common.startDate"),"error-messages":a(g).start_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(f,{cols:"12",md:"2",class:"d-flex align-end"},{default:t(()=>[l(_,{color:"primary",type:"submit",block:"",loading:a(C),disabled:a(C)},{default:t(()=>[...e[19]||(e[19]=[p(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(le,{density:"comfortable"},{default:t(()=>[s("thead",null,[s("tr",null,[e[20]||(e[20]=s("th",null,"Ad",-1)),s("th",null,i(r.$t("common.type")),1),e[21]||(e[21]=s("th",null,"Aile Rolu",-1)),s("th",null,i(r.$t("common.startDate")),1),e[22]||(e[22]=s("th",{class:"text-right"}," Islem ",-1))])]),s("tbody",null,[(y(!0),V(A,null,G(a(u)?.users??[],o=>(y(),V("tr",{key:o.id},[s("td",null,[s("div",Ue,i(o.name),1),s("div",Fe,i(o.email||"-"),1)]),s("td",null,[l(M,{size:"small",color:o.relation_type==="owner"?"primary":"warning",variant:"tonal"},{default:t(()=>[p(i(o.relation_label),1)]),_:2},1032,["color"])]),s("td",null,i(o.family_role_label||"-"),1),s("td",null,i(a(X)(o.start_date)),1),s("td",Ne,[l(_,{icon:"",size:"small",variant:"text",color:"error",loading:a(x)===o.id,disabled:a(x)===o.id,onClick:Ke=>de(o.id)},{default:t(()=>[l(J,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),(a(u)?.users??[]).length===0?(y(),V("tr",Ee,[...e[23]||(e[23]=[s("td",{colspan:"5",class:"text-center text-medium-emphasis py-6"}," Sakin kaydi yok. ",-1)])])):F("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1}),l(f,{cols:"12"},{default:t(()=>[l(z,{loading:a(w)},{default:t(()=>[l(L,{title:"Son Tahakkuklar"}),l(le,{density:"comfortable"},{default:t(()=>[s("thead",null,[s("tr",null,[s("th",null,i(r.$t("common.period")),1),s("th",null,i(r.$t("common.due")),1),e[24]||(e[24]=s("th",{class:"text-right"}," Tutar ",-1)),e[25]||(e[25]=s("th",{class:"text-right"}," Kalan ",-1)),s("th",null,i(r.$t("common.status")),1),e[26]||(e[26]=s("th",{class:"text-right"}," Islem ",-1))])]),s("tbody",null,[(y(!0),V(A,null,G(a(u)?.charges??[],o=>(y(),V("tr",{key:o.id},[s("td",null,i(o.period),1),s("td",null,i(a(X)(o.due_date)),1),s("td",Ie,i(a(Y)(o.amount)),1),s("td",ze,i(a(Y)(o.remaining)),1),s("td",null,[l(M,{size:"small",color:a(_e)(o.status),variant:"tonal"},{default:t(()=>[p(i(a(ge)(o.status)),1)]),_:2},1032,["color"])]),s("td",Ae,[l(_,{icon:"",size:"small",variant:"text",to:`/charges/${o.id}`},{default:t(()=>[l(J,{icon:"ri-eye-line"})]),_:1},8,["to"])])]))),128)),(a(u)?.charges??[]).length===0?(y(),V("tr",Be,[...e[27]||(e[27]=[s("td",{colspan:"6",class:"text-center text-medium-emphasis py-6"}," Tahakkuk kaydi yok. ",-1)])])):F("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}),l(ke,{modelValue:a(c),"onUpdate:modelValue":e[11]||(e[11]=o=>ye(c)?c.value=o:null),"max-width":"760"},{default:t(()=>[l(z,{title:"Daire Duzenle"},{default:t(()=>[l(K,null,{default:t(()=>[l(ee,{ref_key:"editFormRef",ref:H,onSubmit:h(Q,["prevent"])},{default:t(()=>[l(B,null,{default:t(()=>[l(f,{cols:"12",md:"4"},{default:t(()=>[l(R,{modelValue:a(n).block,"onUpdate:modelValue":e[4]||(e[4]=o=>a(n).block=o),label:"Blok","error-messages":a(b).block??[]},null,8,["modelValue","error-messages"])]),_:1}),l(f,{cols:"12",md:"4"},{default:t(()=>[l(R,{modelValue:a(n).floor,"onUpdate:modelValue":e[5]||(e[5]=o=>a(n).floor=o),type:"number",label:"Kat",rules:se,"error-messages":a(b).floor??[]},null,8,["modelValue","error-messages"])]),_:1}),l(f,{cols:"12",md:"4"},{default:t(()=>[l(R,{modelValue:a(n).number,"onUpdate:modelValue":e[6]||(e[6]=o=>a(n).number=o),label:r.$t("common.apartmentNo"),rules:re,"error-messages":a(b).number??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:t(()=>[l(R,{modelValue:a(n).m2,"onUpdate:modelValue":e[7]||(e[7]=o=>a(n).m2=o),type:"number",min:"1",step:"0.01",label:"m2",rules:ie,"error-messages":a(b).m2??[]},null,8,["modelValue","error-messages"])]),_:1}),l(f,{cols:"12",md:"6"},{default:t(()=>[l(R,{modelValue:a(n).arsa_payi,"onUpdate:modelValue":e[8]||(e[8]=o=>a(n).arsa_payi=o),type:"number",min:"0",step:"0.000001",label:r.$t("common.landShare"),rules:ue,"error-messages":a(b).arsa_payi??[]},null,8,["modelValue","label","error-messages"])]),_:1}),l(f,{cols:"12"},{default:t(()=>[l(Se,{modelValue:a(n).is_active,"onUpdate:modelValue":e[9]||(e[9]=o=>a(n).is_active=o),label:r.$t("common.active"),color:"primary"},null,8,["modelValue","label"])]),_:1})]),_:1})]),_:1},512)]),_:1}),l(Re,{class:"px-6 pb-4"},{default:t(()=>[l(Ve),l(_,{variant:"outlined",disabled:a(S),onClick:e[10]||(e[10]=o=>c.value=!1)},{default:t(()=>[...e[28]||(e[28]=[p(" Iptal ",-1)])]),_:1},8,["disabled"]),l(_,{color:"primary",loading:a(S),disabled:a(S),onClick:Q},{default:t(()=>[...e[29]||(e[29]=[p(" Kaydet ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}});export{il as default};
