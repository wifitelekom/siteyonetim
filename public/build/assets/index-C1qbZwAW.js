import{u as N}from"./useAbortOnUnmount-D2zdVzb9.js";import{e as q,$ as b,T as x,x as f,q as C}from"./main-Btr01hqQ.js";import{V as T,a as m}from"./VRow-CRn_xzm0.js";import{V as S}from"./VCard-BmPLTxO3.js";import{V as U}from"./VCardText-H2SttjXr.js";import{V as z}from"./VSelect-DhbvR9Z1.js";import{V as D}from"./VTextField-pVQuWnMO.js";import{V as K}from"./VAlert-R8JWKysv.js";import{V as O}from"./VTable-5XBH4x9y.js";import{V as w}from"./VChip-DOrTqiUh.js";import{V as I}from"./VPagination-9yrd3TeG.js";import{j as L,h as r,D as P,Q as v,R as A,S as a,q as e,y as t,a8 as h,O as i,u as o,ad as F,V as k,F as Q,ab as G}from"./vendor-DfCbaU-T.js";import"./vuetify-DGZOXKNZ.js";import"./VAvatar-96oJdN2D.js";import"./VList-BYpc2SqC.js";import"./VDivider-DEGojtwS.js";import"./VCheckboxBtn-DaQGgEjM.js";import"./VSelectionControl-ClrOpdq3.js";const H={class:"d-flex align-center justify-space-between mb-2"},J={class:"d-flex gap-3 justify-end"},W={class:"font-weight-medium"},X={class:"text-caption text-medium-emphasis"},Y={class:"text-caption text-medium-emphasis"},Z={class:"text-right"},ee={key:0},te={colspan:"5",class:"text-center text-medium-emphasis py-6"},ae={class:"text-sm text-medium-emphasis"},ke=L({__name:"index",setup(le){N();const{user:R}=q(),g=r(!1),V=r(!1),_=r(null),d=r(""),y=r([]),$=r([]),c=r({current_page:1,last_page:1,per_page:20,total:0}),u=r({role:null,search:""}),B=async()=>{V.value=!0;try{const s=await b("/users/meta");$.value=s.data.roles}catch(s){d.value=x(s,"Filtre verileri alınamadı.")}finally{V.value=!1}},p=async(s=1)=>{g.value=!0,d.value="";try{const l=await b("/users",{query:{page:s,role:u.value.role||void 0,search:u.value.search||void 0}});y.value=l.data,c.value=l.meta}catch(l){d.value=x(l,"Kullanıcı listesi alınamadı.")}finally{g.value=!1}},E=async()=>{await p(1)},M=async()=>{u.value={role:null,search:""},await p(1)},j=async s=>{_.value=s.id,d.value="";try{await b(`/users/${s.id}`,{method:"DELETE"}),await p(c.value.current_page)}catch(l){d.value=x(l,"Kullanıcı silinemedi.")}finally{_.value=null}};return P(async()=>{await Promise.allSettled([B(),p(1)])}),(s,l)=>(v(),A(T,null,{default:a(()=>[e(m,{cols:"12"},{default:a(()=>[t("div",H,[l[2]||(l[2]=t("div",null,[t("h4",{class:"text-h4 mb-1"}," Kullanıcılar "),t("p",{class:"text-medium-emphasis mb-0"}," Site kullanıcılarini yönetin ")],-1)),e(f,{color:"primary","prepend-icon":"ri-user-add-line",to:"/management/users/create"},{default:a(()=>[h(i(s.$t("pages.users.newTitle")),1)]),_:1})])]),_:1}),e(m,{cols:"12"},{default:a(()=>[e(S,{loading:o(V)},{default:a(()=>[e(U,null,{default:a(()=>[e(T,null,{default:a(()=>[e(m,{cols:"12",md:"3"},{default:a(()=>[e(z,{modelValue:o(u).role,"onUpdate:modelValue":l[0]||(l[0]=n=>o(u).role=n),items:o($),"item-title":"label","item-value":"value",label:"Rol",clearable:""},null,8,["modelValue","items"])]),_:1}),e(m,{cols:"12",md:"9"},{default:a(()=>[e(D,{modelValue:o(u).search,"onUpdate:modelValue":l[1]||(l[1]=n=>o(u).search=n),label:s.$t("common.search"),placeholder:"Ad, e-posta, telefon, TC"},null,8,["modelValue","label"])]),_:1}),e(m,{cols:"12"},{default:a(()=>[t("div",J,[e(f,{variant:"outlined",onClick:M},{default:a(()=>[h(i(s.$t("common.clear")),1)]),_:1}),e(f,{color:"primary",onClick:E},{default:a(()=>[h(i(s.$t("common.filter")),1)]),_:1})])]),_:1})]),_:1})]),_:1})]),_:1},8,["loading"])]),_:1}),o(d)?(v(),A(m,{key:0,cols:"12"},{default:a(()=>[e(K,{type:"error",variant:"tonal"},{default:a(()=>[h(i(o(d)),1)]),_:1})]),_:1})):F("",!0),e(m,{cols:"12"},{default:a(()=>[e(S,{loading:o(g)},{default:a(()=>[e(O,{density:"comfortable"},{default:a(()=>[t("thead",null,[t("tr",null,[l[3]||(l[3]=t("th",null,"Ad Soyad",-1)),t("th",null,i(s.$t("common.contact")),1),l[4]||(l[4]=t("th",null,"Rol",-1)),t("th",null,i(s.$t("common.apartment")),1),l[5]||(l[5]=t("th",{class:"text-right"}," İşlemler ",-1))])]),t("tbody",null,[(v(!0),k(Q,null,G(o(y),n=>(v(),k("tr",{key:n.id},[t("td",null,[t("div",W,i(n.name),1),t("div",X,i(n.email||"-"),1)]),t("td",null,[t("div",null,i(n.phone||"-"),1),t("div",Y,i(n.tc_kimlik||"-"),1)]),t("td",null,[e(w,{size:"small",color:"primary",variant:"tonal"},{default:a(()=>[h(i(n.role_label),1)]),_:2},1024)]),t("td",null,i(n.apartment_count),1),t("td",Z,[e(f,{icon:"",size:"small",variant:"text",to:`/management/users/${n.id}/edit`},{default:a(()=>[e(C,{icon:"ri-edit-line"})]),_:1},8,["to"]),e(f,{icon:"",size:"small",variant:"text",color:"error",disabled:o(R)?.id===n.id||o(_)===n.id,loading:o(_)===n.id,onClick:se=>j(n)},{default:a(()=>[e(C,{icon:"ri-delete-bin-line"})]),_:1},8,["disabled","loading","onClick"])])]))),128)),o(y).length===0?(v(),k("tr",ee,[t("td",te,i(s.$t("common.noRecords")),1)])):F("",!0)])]),_:1}),e(U,{class:"d-flex justify-space-between align-center flex-wrap gap-3"},{default:a(()=>[t("span",ae,i(s.$t("common.totalRecords",{count:o(c).total})),1),e(I,{"model-value":o(c).current_page,length:o(c).last_page,"total-visible":7,"onUpdate:modelValue":p},null,8,["model-value","length"])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{ke as default};
