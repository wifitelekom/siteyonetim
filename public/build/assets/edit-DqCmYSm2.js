import{j as ue,f as me,h as d,D as pe,Q as U,R as M,S as r,Z as fe,ac as ce,q as a,y as n,O as f,a8 as T,u as e,ad as N,ag as z,V as L,F as ve,ab as ge}from"./vendor-qaEqcc9M.js";import{$ as V,T as y,x as _,q as j,U as q}from"./main-DUODoQpR.js";import{a as be}from"./formatters-BEv4aA23.js";import{V as P,r as k,e as Ve,a as ye,m as _e,b as ke}from"./VForm-AfrkaUJk.js";import{V as F,a as i}from"./VRow-dBMGxjTF.js";import{V as we}from"./VAlert-DIbLZTVg.js";import{V as Y,a as Re}from"./VCard-DEMyauu_.js";import{V as Q}from"./VCardText-lEnvPJxp.js";import{V as c}from"./VTextField-BgtisBQp.js";import{V as he}from"./VTextarea-BWwjO-LJ.js";import{V as D}from"./VSelect-BpDYXa0x.js";import{V as $e}from"./VTable-CDiDVqFm.js";import"./vuetify-CYvz9UpR.js";import"./VAvatar-DfdxhEHH.js";import"./VList-BpKoOtV6.js";import"./VDivider-CiCMqi-4.js";import"./VCheckboxBtn-B_mUIJHa.js";import"./VSelectionControl-DtdcpgRj.js";import"./VChip-CzUAJTHl.js";const Ue={class:"d-flex align-center justify-space-between mb-2"},Te={class:"text-h4 mb-1"},De={class:"text-medium-emphasis mb-0"},Ce={class:"d-flex gap-2"},xe={class:"d-flex justify-end"},Ee={class:"text-right"},Ae={key:0},Xe=ue({__name:"edit",setup(Se){const Z=fe(),G=ce(),v=me(()=>Number(Z.params.id)),C=d(!1),w=d(!1),x=d(!1),E=d(!1),g=d(null),b=d(null),u=d(""),m=d({}),R=d({}),O=d([]),h=d([]),B=d([]),A=d([]),H=[{value:"",label:"Seciniz"},{value:"ilkokul",label:"Ilkokul"},{value:"ortaokul",label:"Ortaokul"},{value:"lise",label:"Lise"},{value:"onlisans",label:"On Lisans"},{value:"lisans",label:"Lisans"},{value:"yuksek_lisans",label:"Yuksek Lisans"},{value:"doktora",label:"Doktora"}],s=d({name:"",email:"",phone:"",tc_kimlik:"",address:"",birth_date:"",occupation:"",education:"",password:"",password_confirmation:"",role:"owner"}),I=d(null),p=d({apartment_id:null,relation_type:"owner",start_date:new Date().toISOString().slice(0,10)}),K=d(null),J=[k()],W=[k(),Ve()],X=[o=>typeof o!="string"||o.length===0?!0:ye(11)(o)],ee=[o=>typeof o!="string"||o.length===0?!0:_e(8)(o)],le=[o=>s.value.password?k("Şifre tekrar zorunludur.")(o):!0,o=>s.value.password?ke(()=>s.value.password,"Şifreler eşleşmiyor.")(o):!0],ae=[k()],te=[k()],oe=[k()],$=async()=>{C.value=!0,u.value="";try{const o=await V(`/users/${v.value}`),l=o.data;s.value={name:l.name,email:l.email??"",phone:l.phone??"",tc_kimlik:l.tc_kimlik??"",address:l.address??"",birth_date:l.birth_date??"",occupation:l.occupation??"",education:l.education??"",password:"",password_confirmation:"",role:l.role??"owner"},A.value=l.apartments,B.value=o.meta.available_apartments,O.value=o.meta.roles,h.value=o.meta.relation_types,h.value.some(t=>t.value===p.value.relation_type)||(p.value.relation_type=h.value[0]?.value??"owner")}catch(o){u.value=y(o,"Kullanıcı detayı alınamadı.")}finally{C.value=!1}},se=async()=>{if(!(await I.value?.validate())?.valid)return;w.value=!0,u.value="",m.value={};const l={name:s.value.name,email:s.value.email,phone:s.value.phone||null,tc_kimlik:s.value.tc_kimlik||null,address:s.value.address||null,birth_date:s.value.birth_date||null,occupation:s.value.occupation||null,education:s.value.education||null,role:s.value.role};s.value.password&&(l.password=s.value.password,l.password_confirmation=s.value.password_confirmation);try{await V(`/users/${v.value}`,{method:"PUT",body:l}),await $()}catch(t){u.value=y(t,"Kullanıcı güncellenemedi."),m.value=q(t)}finally{w.value=!1}},re=async()=>{x.value=!0,u.value="";try{await V(`/users/${v.value}`,{method:"DELETE"}),await G.push("/management/users")}catch(o){u.value=y(o,"Kullanıcı silinemedi.")}finally{x.value=!1}},ie=async()=>{if((await K.value?.validate())?.valid){E.value=!0,u.value="",R.value={};try{await V(`/users/${v.value}/apartments`,{method:"POST",body:{apartment_id:p.value.apartment_id,relation_type:p.value.relation_type,start_date:p.value.start_date||null}}),p.value.apartment_id=null,await $()}catch(l){u.value=y(l,"Daire ilişkisi eklenemedi."),R.value=q(l)}finally{E.value=!1}}},ne=async o=>{g.value=o,u.value="";try{await V(`/users/${v.value}/apartments/${o}`,{method:"DELETE"}),await $()}catch(l){u.value=y(l,"Daire ilişkisi kaldırılamadı.")}finally{g.value=null}},de=async o=>{b.value=o.id,u.value="";try{await V(`/users/${v.value}/apartments/${o.id}`,{method:"PUT",body:{relation_type:o.relation_type,start_date:o.start_date||null}}),await $()}catch(l){u.value=y(l,"Daire iliskisi guncellenemedi.")}finally{b.value=null}};return pe($),(o,l)=>(U(),M(F,null,{default:r(()=>[a(i,{cols:"12"},{default:r(()=>[n("div",Ue,[n("div",null,[n("h4",Te,f(o.$t("pages.users.editTitle")),1),n("p",De,f(o.$t("pages.users.editSubtitle")),1)]),n("div",Ce,[a(_,{variant:"outlined",to:"/management/users"},{default:r(()=>[...l[14]||(l[14]=[T(" Listeye Don ",-1)])]),_:1}),a(_,{color:"error",variant:"outlined",loading:e(x),disabled:e(x),onClick:re},{default:r(()=>[...l[15]||(l[15]=[T(" Sil ",-1)])]),_:1},8,["loading","disabled"])])])]),_:1}),e(u)?(U(),M(i,{key:0,cols:"12"},{default:r(()=>[a(we,{type:"error",variant:"tonal"},{default:r(()=>[T(f(e(u)),1)]),_:1})]),_:1})):N("",!0),a(i,{cols:"12"},{default:r(()=>[a(Y,{loading:e(C)||e(w)},{default:r(()=>[a(Q,null,{default:r(()=>[a(P,{ref_key:"formRef",ref:I,onSubmit:z(se,["prevent"])},{default:r(()=>[a(F,null,{default:r(()=>[a(i,{cols:"12",md:"6"},{default:r(()=>[a(c,{modelValue:e(s).name,"onUpdate:modelValue":l[0]||(l[0]=t=>e(s).name=t),label:"Ad Soyad",rules:J,"error-messages":e(m).name??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"6"},{default:r(()=>[a(c,{modelValue:e(s).email,"onUpdate:modelValue":l[1]||(l[1]=t=>e(s).email=t),type:"email",label:"E-posta",rules:W,"error-messages":e(m).email??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"6"},{default:r(()=>[a(c,{modelValue:e(s).phone,"onUpdate:modelValue":l[2]||(l[2]=t=>e(s).phone=t),label:"Telefon","error-messages":e(m).phone??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"6"},{default:r(()=>[a(c,{modelValue:e(s).tc_kimlik,"onUpdate:modelValue":l[3]||(l[3]=t=>e(s).tc_kimlik=t),label:"TC Kimlik",maxlength:"11",rules:X,"error-messages":e(m).tc_kimlik??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12"},{default:r(()=>[a(he,{modelValue:e(s).address,"onUpdate:modelValue":l[4]||(l[4]=t=>e(s).address=t),label:"Adres",rows:"2","error-messages":e(m).address??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(c,{modelValue:e(s).birth_date,"onUpdate:modelValue":l[5]||(l[5]=t=>e(s).birth_date=t),type:"date",label:"Dogum Tarihi","error-messages":e(m).birth_date??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(c,{modelValue:e(s).occupation,"onUpdate:modelValue":l[6]||(l[6]=t=>e(s).occupation=t),label:"Meslek","error-messages":e(m).occupation??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(D,{modelValue:e(s).education,"onUpdate:modelValue":l[7]||(l[7]=t=>e(s).education=t),items:H,"item-title":"label","item-value":"value",label:"Ogrenim Durumu","error-messages":e(m).education??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(c,{modelValue:e(s).password,"onUpdate:modelValue":l[8]||(l[8]=t=>e(s).password=t),type:"password",label:"Yeni Şifre",rules:ee,"error-messages":e(m).password??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(c,{modelValue:e(s).password_confirmation,"onUpdate:modelValue":l[9]||(l[9]=t=>e(s).password_confirmation=t),type:"password",label:"Şifre Tekrar",rules:le,"error-messages":e(m).password_confirmation??[]},null,8,["modelValue","error-messages"])]),_:1}),a(i,{cols:"12",md:"4"},{default:r(()=>[a(D,{modelValue:e(s).role,"onUpdate:modelValue":l[10]||(l[10]=t=>e(s).role=t),items:e(O),"item-title":"label","item-value":"value",label:"Rol",rules:ae,"error-messages":e(m).role??[]},null,8,["modelValue","items","error-messages"])]),_:1}),a(i,{cols:"12"},{default:r(()=>[n("div",xe,[a(_,{color:"primary",type:"submit",loading:e(w),disabled:e(w)},{default:r(()=>[T(f(o.$t("common.update")),1)]),_:1},8,["loading","disabled"])])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["loading"])]),_:1}),a(i,{cols:"12"},{default:r(()=>[a(Y,{loading:e(C)},{default:r(()=>[a(Re,{title:"Bağlı Daireler"}),a(Q,null,{default:r(()=>[a(P,{ref_key:"apartmentFormRef",ref:K,onSubmit:z(ie,["prevent"])},{default:r(()=>[a(F,null,{default:r(()=>[a(i,{cols:"12",md:"5"},{default:r(()=>[a(D,{modelValue:e(p).apartment_id,"onUpdate:modelValue":l[11]||(l[11]=t=>e(p).apartment_id=t),items:e(B),"item-title":"label","item-value":"id",label:o.$t("common.apartment"),rules:te,"error-messages":e(R).apartment_id??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(i,{cols:"12",md:"3"},{default:r(()=>[a(D,{modelValue:e(p).relation_type,"onUpdate:modelValue":l[12]||(l[12]=t=>e(p).relation_type=t),items:e(h),"item-title":"label","item-value":"value",label:o.$t("common.type"),rules:oe,"error-messages":e(R).relation_type??[]},null,8,["modelValue","items","label","error-messages"])]),_:1}),a(i,{cols:"12",md:"2"},{default:r(()=>[a(c,{modelValue:e(p).start_date,"onUpdate:modelValue":l[13]||(l[13]=t=>e(p).start_date=t),type:"date",label:o.$t("common.startDate"),"error-messages":e(R).start_date??[]},null,8,["modelValue","label","error-messages"])]),_:1}),a(i,{cols:"12",md:"2",class:"d-flex align-end"},{default:r(()=>[a(_,{color:"primary",type:"submit",block:"",loading:e(E),disabled:e(E)},{default:r(()=>[...l[16]||(l[16]=[T(" Ekle ",-1)])]),_:1},8,["loading","disabled"])]),_:1})]),_:1})]),_:1},512)]),_:1}),a($e,{density:"comfortable"},{default:r(()=>[n("thead",null,[n("tr",null,[n("th",null,f(o.$t("common.apartment")),1),n("th",null,f(o.$t("common.type")),1),n("th",null,f(o.$t("common.startDate")),1),l[17]||(l[17]=n("th",{class:"text-right"}," Islem ",-1))])]),n("tbody",null,[(U(!0),L(ve,null,ge(e(A),t=>(U(),L("tr",{key:t.id},[n("td",null,f(t.label),1),n("td",null,[a(D,{modelValue:t.relation_type,"onUpdate:modelValue":S=>t.relation_type=S,items:e(h),"item-title":"label","item-value":"value",density:"compact","hide-details":"",disabled:e(b)===t.id||e(g)===t.id},null,8,["modelValue","onUpdate:modelValue","items","disabled"])]),n("td",null,f(e(be)(t.start_date)),1),n("td",Ee,[a(_,{icon:"",size:"small",variant:"text",color:"primary",loading:e(b)===t.id,disabled:e(b)===t.id||e(g)===t.id,onClick:S=>de(t)},{default:r(()=>[a(j,{icon:"ri-save-line"})]),_:1},8,["loading","disabled","onClick"]),a(_,{icon:"",size:"small",variant:"text",color:"error",loading:e(g)===t.id,disabled:e(g)===t.id||e(b)===t.id,onClick:S=>ne(t.id)},{default:r(()=>[a(j,{icon:"ri-close-line"})]),_:1},8,["loading","disabled","onClick"])])]))),128)),e(A).length===0?(U(),L("tr",Ae,[...l[18]||(l[18]=[n("td",{colspan:"4",class:"text-center text-medium-emphasis py-6"}," Bağlı daire yok. ",-1)])])):N("",!0)])]),_:1})]),_:1},8,["loading"])]),_:1})]),_:1}))}});export{Xe as default};
